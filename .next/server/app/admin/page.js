(()=>{var e={};e.id=3,e.ids=[3],e.modules={55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},57147:e=>{"use strict";e.exports=require("fs")},71017:e=>{"use strict";e.exports=require("path")},71267:e=>{"use strict";e.exports=require("worker_threads")},97779:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>h,originalPathname:()=>m,pages:()=>x,routeModule:()=>p,tree:()=>c});var a=s(73137),l=s(54647),r=s(4183),n=s.n(r),i=s(71775),d={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);s.d(t,d);let o=a.AppPageRouteModule,c=["",{children:["admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,78781)),"D:\\FYC\\FYC\\clinic_attendence\\clinic-attendance\\app\\admin\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,79958)),"D:\\FYC\\FYC\\clinic_attendence\\clinic-attendance\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,51918,23)),"next/dist/client/components/not-found-error"]}],x=["D:\\FYC\\FYC\\clinic_attendence\\clinic-attendance\\app\\admin\\page.tsx"],m="/admin/page",h={require:s,loadChunk:()=>Promise.resolve()},p=new o({definition:{kind:l.x.APP_PAGE,page:"/admin/page",pathname:"/admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},33550:(e,t,s)=>{Promise.resolve().then(s.bind(s,44429))},44429:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>e9});var a=s(60080),l=s(9885),r=s(57114),n=s(26823),i=s(92032),d=s(90092),o=s(517),c=s(73436),x=s(39546),m=s(66908),h=s(77974),p=s(9551),u=s(78937),b=s(3514),f=s(5987),g=s(23294),j=s(54352),N=s(51910),y=s(11922),v=s(15441),_=s(56206),w=s(52995);let k={M:"AM",A:"PM",N:"NIGHT"},S=[{id:"clinic",name:"è¨ºæ‰€"},{id:"pharmacy",name:"è—¥å±€"}];function C({authLevel:e}){let[t,s]=(0,l.useState)(!1),[r,n]=(0,l.useState)(new Date),[i,d]=(0,l.useState)(""),[o,c]=(0,l.useState)([]),[x,m]=(0,l.useState)({}),[h,p]=(0,l.useState)([]),[u,b]=(0,l.useState)({}),[C,$]=(0,l.useState)([]),[z,Z]=(0,l.useState)([]),[T,D]=(0,l.useState)(!1),[E,F]=(0,l.useState)({openDays:[1,2,3,4,5,6],shifts:{AM:{start:"08:00",end:"12:30"},PM:{start:"14:00",end:"17:30"},NIGHT:{start:"18:00",end:"21:30"}}}),[M,O]=(0,l.useState)(!1);(0,l.useEffect)(()=>{s(!0);let e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");d(`${t}-${a}-${l}`),P(),A()},[]),(0,l.useEffect)(()=>{H(),L(),J()},[r]);let P=async()=>{try{let e=await fetch("/api/settings?key=clinic_business_hours"),t=await e.json();if(t.data&&t.data.length>0&&t.data[0].value)try{let e=JSON.parse(t.data[0].value);F(e)}catch(e){console.error("è§£æç‡Ÿæ¥­æ™‚é–“å¤±æ•—",e)}}catch(e){console.error("Fetch global settings error:",e)}},A=async()=>{try{let e=await fetch("/api/settings"),t=await e.json();if(!t.data){Z([{name:"é†«å¸«",in_roster:!1},{name:"è­·ç†å¸«",in_roster:!0}]),$(S);return}let s=t.data.find(e=>"job_titles"===e.key),a=[];if(s)try{let e=JSON.parse(s.value);Array.isArray(e)&&e.length>0&&(a="string"==typeof e[0]?e.map(e=>({name:e,in_roster:"é†«å¸«"!==e})):e.map(e=>({name:e.name??"",in_roster:"boolean"==typeof e.in_roster?e.in_roster:"é†«å¸«"!==e.name})).filter(e=>e.name))}catch(e){console.error("Parse job_titles error:",e)}a&&0!==a.length||(a=[{name:"é†«å¸«",in_roster:!1},{name:"è­·ç†å¸«",in_roster:!0},{name:"è¡Œæ”¿",in_roster:!0},{name:"è—¥å¸«",in_roster:!0},{name:"æ¸…æ½”",in_roster:!1}]),Z(a);let l=t.data.find(e=>"org_entities"===e.key),r=[];if(l)try{let e=JSON.parse(l.value);Array.isArray(e)&&e.length>0&&(r=e.map(e=>({id:e.id??"",name:e.name??""})).filter(e=>e.id&&e.name))}catch(e){console.error("Parse org_entities error:",e)}r&&0!==r.length||(r=S),$(r)}catch(e){console.error("Fetch roster settings error:",e),Z([{name:"é†«å¸«",in_roster:!1},{name:"è­·ç†å¸«",in_roster:!0}]),$(S)}},I=async()=>{try{let e=await fetch("/api/settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:"clinic_business_hours",value:JSON.stringify(E)})}),t=await e.json();t.success?(alert("ç‡Ÿæ¥­æ™‚é–“å·²æ›´æ–°ï¼Œå¾ŒçºŒé»æ“Šæ’ç­å°‡å¥—ç”¨æ–°æ™‚é–“ã€‚"),D(!1)):alert("å„²å­˜å¤±æ•—: "+t.message)}catch(e){console.error("Save global time error:",e),alert("å„²å­˜å¤±æ•—")}},H=async()=>{try{let e=await fetch("/api/staff"),t=await e.json();t.data&&c(t.data)}catch(e){console.error("Fetch staff error:",e)}},J=async()=>{try{let e=r.getFullYear(),t=r.getMonth()+1,s=await fetch(`/api/roster/holidays?year=${e}&month=${t}`),a=await s.json();a.data&&p(a.data)}catch(e){console.error("Fetch holidays error:",e),p([])}},L=async()=>{try{let e=r.getFullYear(),t=r.getMonth()+1,s=await fetch(`/api/roster/staff?year=${e}&month=${t}`),a=await s.json(),l={};a.data&&a.data.forEach(e=>{let t=[];Array.isArray(e.shifts)&&(t=e.shifts.filter(e=>"string"==typeof e&&["M","A","N"].includes(e)));let s="normal";"rest"===e.day_type&&(s="rest"),"regular"===e.day_type&&(s="regular");let a=e.shift_details||{};l[`${e.staff_id}_${e.date}`]={shifts:t,day_type:s,shift_details:a}}),m(l)}catch(e){console.error("Fetch roster error:",e),m({})}},Y=()=>{let e=r.getFullYear(),t=r.getMonth(),s=new Date(e,t+1,0).getDate();return Array.from({length:s},(s,a)=>{let l=new Date(e,t,a+1),r=`${e}-${String(t+1).padStart(2,"0")}-${String(a+1).padStart(2,"0")}`;return{dateObj:l,dateStr:r,dayOfWeek:l.getDay()}})},B=(e,t)=>{if(!e||!t)return 0;let[s,a]=e.split(":").map(Number),[l,r]=t.split(":").map(Number);return(60*l+r-(60*s+a))/60},R=()=>{let e={},t=Y();o.forEach(s=>{let a=[],l=s.work_rule||"normal";if("none"===l)return;let r=0,n="4week"===l?12:6;t.forEach(e=>{let t=`${s.id}_${e.dateStr}`,l=x[t]||{shifts:[],day_type:"normal"};l.shifts.length>0?(r++,"regular"!==l.day_type||a.includes(`ä¾‹å‡æ’ç­`)||a.push(`ä¾‹å‡æ’ç­`)):r=0,r>n&&!a.includes(`é€£ä¸Š>${n}å¤©`)&&a.push(`é€£ä¸Š>${n}å¤©`)}),a.length>0&&(e[s.id]=a)}),b(e)};(0,l.useEffect)(()=>{R()},[x,o]);let q=async t=>{if("boss"===e)try{if(h.includes(t)){let e=await fetch(`/api/roster/holidays?date=${t}`,{method:"DELETE"}),s=await e.json();s.success&&p(e=>e.filter(e=>e!==t))}else{let e=await fetch("/api/roster/holidays",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:t,name:"åœ‹å®šå‡æ—¥"})}),s=await e.json();s.success&&p(e=>[...e,t])}}catch(e){console.error("Toggle holiday error:",e)}},G=async(e,t)=>{let s=`${e}_${t}`,a=x[s]||{shifts:[],day_type:"normal"},l="normal";l="normal"===a.day_type?"rest":"rest"===a.day_type?"regular":"normal";let r="regular"===l?[]:a.shifts;W(e,t,r,l,a.shift_details)},U=async(e,t,s)=>{let a=`${e}_${t}`,l=x[a]||{shifts:[],day_type:"normal",shift_details:{}};if("regular"===l.day_type){alert("ã€Œä¾‹å‡æ—¥ã€ä¸å¯æ’ç­ï¼");return}let r=l.shifts.includes(s),n=[],i={...l.shift_details};if(M&&"M"===s){let e=["M","A","N"],t=e.every(e=>l.shifts.includes(e));t?(n=[],i={}):(n=e,i={...i},e.forEach(e=>{let t=k[e],s=E.shifts[t];i[e]={start:s.start,end:s.end}}))}else if(r)n=l.shifts.filter(e=>e!==s),delete i[s];else{n=[...l.shifts,s];let e=k[s],t=E.shifts[e];i[s]={start:t.start,end:t.end}}W(e,t,n,l.day_type,i)},W=async(e,t,s,a,l={})=>{let r=`${e}_${t}`,n="23:59",i="00:00";s.length>0?Object.values(l).forEach(e=>{e.start&&e.start<n&&(n=e.start),e.end&&e.end>i&&(i=e.end)}):(n=null,i=null),m(e=>({...e,[r]:{shifts:s,day_type:a,shift_details:l}}));try{let r=await fetch("/api/roster/staff",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({staff_id:e,date:t,shifts:s,day_type:a,shift_details:l})}),n=await r.json();n.success||console.error("Update roster error:",n.message)}catch(e){console.error("Update roster error:",e)}},V=e=>{let t=0,s=0,a=Y();return a.forEach(a=>{let l=`${e}_${a.dateStr}`,r=x[l];r&&r.shifts.length>0&&(t++,r.shift_details&&Object.keys(r.shift_details).length>0?r.shifts.forEach(e=>{let t=r.shift_details?.[e];if(t)s+=B(t.start,t.end);else{let t=k[e],a=E.shifts[t];s+=B(a.start,a.end)}}):r.shifts.forEach(e=>{let t=k[e],a=E.shifts[t];s+=B(a.start,a.end)}))}),{totalDays:t,totalHours:Math.round(10*s)/10}},X=Y(),Q=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],K=new Set(z.map(e=>e.name)),ee=new Set(z.filter(e=>e.in_roster).map(e=>e.name)),et=(e,t,s)=>{let l=t.slice().sort((e,t)=>e.role.localeCompare(t.role)||e.display_order-t.display_order);return 0===l.length?null:(0,a.jsxs)("div",{className:"mb-8 overflow-hidden rounded-lg shadow-sm border border-slate-200",children:[a.jsx("h3",{className:`font-bold text-lg p-2 border-b bg-white border-l-4 ${s}`,children:e}),a.jsx("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full border-collapse bg-white",children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"p-2 border bg-slate-50 sticky left-0 z-30 min-w-[150px] text-left shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:"å“¡å·¥"}),X.map(e=>{let t=e.dateStr===i,s=h.includes(e.dateStr),l="bg-slate-50",r="text-slate-800";return s?(l="bg-red-100",r="text-red-700"):t?l="bg-yellow-100":(0===e.dayOfWeek||6===e.dayOfWeek)&&(l="bg-red-50",r="text-red-600"),(0,a.jsxs)("th",{onClick:()=>q(e.dateStr),className:`p-1 border text-center min-w-[40px] h-10 ${l} ${r} ${t?"border-b-4 border-b-yellow-400":""} cursor-default select-none`,children:[a.jsx("div",{className:"text-xs font-bold",children:e.dateObj.getDate()}),(0,a.jsxs)("div",{className:"text-[10px] flex items-center justify-center gap-0.5",children:[s&&a.jsx(g.Z,{size:8})," ",s?"åœ‹å®š":Q[e.dayOfWeek]]})]},e.dateStr)}),a.jsx("th",{className:"p-2 border bg-slate-50 sticky right-0 z-30 min-w-[80px]",children:"çµ±è¨ˆ"})]})}),a.jsx("tbody",{children:l.map(e=>{let t=V(e.id);return(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{className:"p-2 border font-bold text-slate-700 sticky left-0 z-20 bg-white shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)] align-top",children:[(0,a.jsxs)("div",{children:[e.name,a.jsx("div",{className:"text-[10px] text-slate-400",children:e.role})]}),u[e.id]&&(0,a.jsxs)("div",{className:"text-[10px] text-red-600 bg-red-50 p-0.5 rounded flex items-center gap-1",children:[a.jsx(j.Z,{size:10})," é•è¦"]})]}),X.map(t=>{let s=`${e.id}_${t.dateStr}`,l=x[s]||{shifts:[],day_type:"normal"},r=t.dateStr===i,n=r?"bg-yellow-50":"";return"rest"===l.day_type?n="bg-emerald-50":"regular"===l.day_type&&(n="bg-red-50 bg-[linear-gradient(45deg,transparent_25%,rgba(255,0,0,0.05)_50%,transparent_75%,transparent_100%)] bg-[length:10px_10px]"),(0,a.jsxs)("td",{className:`border p-0.5 text-center align-top h-16 relative min-w-[45px] ${n}`,children:[a.jsx("button",{onClick:()=>G(e.id,t.dateStr),className:`w-full h-5 rounded-sm text-[10px] font-bold mb-1 ${"rest"===l.day_type?"bg-emerald-200 text-emerald-800":"regular"===l.day_type?"bg-red-200 text-red-800":"text-transparent hover:text-slate-300"}`,children:"rest"===l.day_type?"ä¼‘":"regular"===l.day_type?"ä¾‹":"â€¢"}),"regular"!==l.day_type&&a.jsx("div",{className:"flex flex-col gap-[2px]",children:["M","A","N"].map(s=>{let r=l.shifts.includes(s),n="M"===s?"bg-orange-400":"A"===s?"bg-blue-400":"bg-purple-400";return a.jsx("button",{onClick:()=>U(e.id,t.dateStr,s),className:`h-2.5 w-full rounded-[2px] transition ${r?n:"bg-slate-200/50 hover:bg-slate-300"}`,title:r?`${s}ç­ (${l.shift_details?.[s]?.start}-${l.shift_details?.[s]?.end})`:`æ’${s}ç­`},s)})})]},t.dateStr)}),a.jsx("td",{className:"p-2 border sticky right-0 z-20 bg-white text-center align-middle",children:(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsxs)("div",{className:"font-bold text-slate-800 text-xs",children:[t.totalDays," å¤©"]}),(0,a.jsxs)("div",{className:"text-slate-500 font-mono text-[10px]",children:[t.totalHours," hr"]})]})})]},e.id)})})]})})]})};return t?(0,a.jsxs)("div",{className:"w-full p-4 animate-fade-in pb-20",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between mb-4 items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 bg-slate-100 p-1 rounded-full shadow-inner",children:[a.jsx("button",{onClick:()=>n(new Date(r.getFullYear(),r.getMonth()-1,1)),className:"p-2 hover:bg-white rounded-full transition",children:a.jsx(N.Z,{size:16})}),(0,a.jsxs)("h2",{className:"text-lg font-bold min-w-[120px] text-center text-slate-700",children:[r.getFullYear(),"å¹´ ",r.getMonth()+1,"æœˆ"]}),a.jsx("button",{onClick:()=>n(new Date(r.getFullYear(),r.getMonth()+1,1)),className:"p-2 hover:bg-white rounded-full transition",children:a.jsx(y.Z,{size:16})})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 items-center justify-end",children:[(0,a.jsxs)("button",{onClick:()=>O(!M),className:`flex items-center gap-2 px-3 py-2 rounded-lg text-xs font-bold border ${M?"bg-emerald-50 text-emerald-700 border-emerald-400":"bg-white text-slate-600 border-slate-300 hover:bg-slate-50"}`,children:[a.jsx(f.Z,{size:14}),"ä¸€éµæ’æ•´å¤© (æ—©ç­)"]}),(0,a.jsxs)("button",{onClick:()=>D(!0),className:"flex items-center gap-2 bg-slate-800 text-white px-4 py-2 rounded-lg text-sm font-bold shadow hover:bg-black transition",children:[a.jsx(v.Z,{size:16})," ç­åˆ¥æ™‚é–“è¨­å®š"]}),(0,a.jsxs)("div",{className:"hidden md:flex flex-wrap gap-2 text-xs items-center bgç™½ p-2 rounded-lg border shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"w-3 h-3 rounded-sm bg-orange-400"}),"æ—©"]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"w-3 h-3 rounded-sm bg-blue-400"}),"åˆ"]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"w-3 h-3 rounded-sm bg-purple-400"}),"æ™š"]})]})]})]}),C.map((e,t)=>{let s=o.filter(t=>{if(t.entity!==e.id)return!1;let s=t.role||"";return!(0!==K.size&&K.has(s))||ee.has(s)});return et(`ğŸ‘¥ ${e.name}äººå“¡`,s,t%3==0?"border-blue-500 text-blue-700":t%3==1?"border-green-500 text-green-700":"border-purple-500 text-purple-700")}),T&&a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md animate-in fade-in zoom-in duration-200 overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-slate-900 text-white p-4 flex justify-between items-center",children:[(0,a.jsxs)("h3",{className:"font-bold flex items-center gap-2",children:[a.jsx(v.Z,{size:18})," è¨­å®šç­è¡¨é è¨­æ™‚é–“"]}),a.jsx("button",{onClick:()=>D(!1),className:"hover:bg-white/20 p-1 rounded-full",children:a.jsx(_.Z,{size:18})})]}),(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[a.jsx("div",{className:"bg-blue-50 p-3 rounded-lg text-xs text-blue-800 mb-4",children:"\uD83D\uDCA1 ä¿®æ”¹æ­¤è™•æœƒæ›´æ–°ç³»çµ±é è¨­å€¼ã€‚é»æ“Šæ’ç­æ ¼å­æ™‚ï¼Œå°‡å¯«å…¥ç•¶ä¸‹è¨­å®šçš„æ™‚é–“ (Snapshot)ï¼Œé¿å…æ—¥å¾Œä¿®æ”¹è¨­å®šå½±éŸ¿èˆŠç­è¡¨ã€‚"}),["AM","PM","NIGHT"].map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:`w-12 text-center text-xs font-bold py-1 rounded text-white ${"AM"===e?"bg-orange-400":"PM"===e?"bg-blue-400":"bg-purple-400"}`,children:"AM"===e?"æ—©ç­":"PM"===e?"åˆç­":"æ™šç­"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-1",children:[a.jsx("input",{type:"time",value:E.shifts[e].start,onChange:t=>F({...E,shifts:{...E.shifts,[e]:{...E.shifts[e],start:t.target.value}}}),className:"border rounded p-2 text-sm font-mono flex-1 text-center bg-slate-50 focus:bg-white transition outline-none focus:ring-2 focus:ring-blue-200"}),a.jsx("span",{className:"text-slate-400",children:"-"}),a.jsx("input",{type:"time",value:E.shifts[e].end,onChange:t=>F({...E,shifts:{...E.shifts,[e]:{...E.shifts[e],end:t.target.value}}}),className:"border rounded p-2 text-sm font-mono flex-1 text-center bg-slate-50 focus:bg-white transition outline-none focus:ring-2 focus:ring-blue-200"})]})]},e)),(0,a.jsxs)("button",{onClick:I,className:"w-full bg-slate-800 text-white py-3 rounded-lg font-bold hover:bg-black transition flex justify-center items-center gap-2",children:[a.jsx(w.Z,{size:18})," å„²å­˜ä¸¦å¥—ç”¨"]})]})]})})]}):null}var $=s(80443),z=s(22385),Z=s(94409),T=s(26303),D=s(4678),E=s(19458),F=s(56388),M=s(1264),O=s(85574),P=s(53257),A=s.n(P),I=s(79067),H=s(24754);let J=["æ˜ŸæœŸä¸€","æ˜ŸæœŸäºŒ","æ˜ŸæœŸä¸‰","æ˜ŸæœŸå››","æ˜ŸæœŸäº”","æ˜ŸæœŸå…­","æ˜ŸæœŸæ—¥"],L=[{id:"AM",label:"æ—© è¨º",time:"08:00 - 12:30"},{id:"PM",label:"åˆ è¨º",time:"15:00 - 18:00"},{id:"NIGHT",label:"æ™š è¨º",time:"18:00 - 21:00"}];function Y({onClose:e}){let[t,s]=(0,l.useState)(new Date),[r,n]=(0,l.useState)([]),[i,d]=(0,l.useState)([]),[o,c]=(0,l.useState)([]),[m,h]=(0,l.useState)(!0),[p,u]=(0,l.useState)("å¤æš‰è¨ºæ‰€"),[b,g]=(0,l.useState)(7),[j,v]=(0,l.useState)(!0),[w,k]=(0,l.useState)(!0),S=(0,l.useRef)(null),C=e=>{let t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${s}-${a}`},$=(e,t)=>{let s=new Date(e),a=s.getDay(),l=new Date(s);l.setDate(s.getDate()-(0===a?6:a-1));let r=[],n=Math.ceil(t/7);for(let e=0;e<n;e++){let t=new Date(l);t.setDate(l.getDate()+7*e);let s=[];for(let e=0;e<7;e++){let a=new Date(t);a.setDate(t.getDate()+e),s.push(a)}r.push(s)}return r},z=async()=>{try{let e=$(t,b),s=e.flat(),a=C(s[0]),l=C(s[s.length-1]),r=await fetch("/api/staff?role=é†«å¸«"),i=await r.json();i.data&&d(i.data.filter(e=>"é†«å¸«"===e.role).map(e=>({id:e.id,name:e.name})));let o=await fetch(`/api/roster/doctor?startDate=${a}&endDate=${l}`),x=await o.json();x.error?(console.error("Error:",x.error),n([])):n(x.data||[]);let m=await fetch(`/api/roster/closed-days?startDate=${a}&endDate=${l}`),h=await m.json();h.error?(console.error("Error:",h.error),c([])):c(h.data||[])}catch(e){console.error("Fetch data error:",e),alert("è¼‰å…¥è³‡æ–™å¤±æ•—")}};(0,l.useEffect)(()=>{z()},[t,b]);let Z=$(t,b),T=Z.flat(),D=C(T[0]),E=C(T[T.length-1]),F=async()=>{if(S.current)try{let e=await A()(S.current,{scale:2,backgroundColor:"#ffffff",useCORS:!0});e.toBlob(e=>{e&&(0,I.saveAs)(e,`${p}_é–€è¨ºè¡¨_${D}.png`)})}catch(e){alert("åœ–ç‰‡è£½ä½œå¤±æ•—")}},M=async()=>{if(S.current)try{let e=await A()(S.current,{scale:2,backgroundColor:"#ffffff",useCORS:!0,logging:!1}),t=e.toDataURL("image/png"),s=new H.ZP("landscape","mm","a4"),a=s.internal.pageSize.getWidth(),l=s.internal.pageSize.getHeight(),r=e.width,n=e.height,i=a/r,d=n*i;if(d>l){let e=d,r=0;for(s.addImage(t,"PNG",0,r,a,d),e-=l;e>0;)r=e-d,s.addPage(),s.addImage(t,"PNG",0,r,a,d),e-=l}else{let e=(l-d)/2;s.addImage(t,"PNG",0,e,a,d)}s.save(`${p}_é–€è¨ºè¡¨_${D}.pdf`)}catch(e){console.error(e),alert("PDF è£½ä½œå¤±æ•—")}},P=e=>e?e.startsWith("0")?e.slice(1):e:"";return(0,a.jsxs)("div",{className:"fixed inset-0 bg-black/80 z-50 flex flex-col items-center justify-center p-4 backdrop-blur-sm",children:[(0,a.jsxs)("div",{className:"bg-white w-full max-w-5xl p-4 rounded-t-xl border-b flex flex-wrap justify-between items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("h3",{className:"font-bold text-lg flex items-center gap-2",children:[a.jsx(f.Z,{})," é–€è¨ºè¡¨è¨­å®š"]}),(0,a.jsxs)("div",{className:"flex items-center bg-slate-100 rounded-lg p-1",children:[a.jsx("button",{onClick:()=>{let e=new Date(t);e.setDate(e.getDate()-b),s(e)},className:"p-1 hover:bg-white rounded shadow-sm",children:a.jsx(N.Z,{})}),(0,a.jsxs)("span",{className:"px-3 font-mono text-sm font-bold",children:[D," ~ ",E]}),a.jsx("button",{onClick:()=>{let e=new Date(t);e.setDate(e.getDate()+b),s(e)},className:"p-1 hover:bg-white rounded shadow-sm",children:a.jsx(y.Z,{})})]}),(0,a.jsxs)("select",{value:b,onChange:e=>g(Number(e.target.value)),className:"border rounded px-2 py-1 text-sm font-bold bg-white",children:[a.jsx("option",{value:7,children:"1 é€± (7 å¤©)"}),a.jsx("option",{value:14,children:"2 é€± (14 å¤©)"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,a.jsxs)("label",{className:"flex items-center gap-1 text-sm cursor-pointer select-none",children:[a.jsx("input",{type:"checkbox",checked:m,onChange:e=>h(e.target.checked),className:"w-4 h-4"}),"é¡¯ç¤ºæ—¥æœŸ"]}),(0,a.jsxs)("label",{className:"flex items-center gap-1 text-sm cursor-pointer select-none",children:[a.jsx("input",{type:"checkbox",checked:j,onChange:e=>v(e.target.checked),className:"w-4 h-4"}),"é¡¯ç¤ºç‰¹æ®Šé–€è¨º"]}),(0,a.jsxs)("label",{className:"flex items-center gap-1 text-sm cursor-pointer select-none",children:[a.jsx("input",{type:"checkbox",checked:w,onChange:e=>k(e.target.checked),className:"w-4 h-4"}),"é¡¯ç¤ºç•°å‹•è³‡è¨Š"]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-sm",children:"æ¨™é¡Œ:"}),a.jsx("input",{value:p,onChange:e=>u(e.target.value),className:"border rounded px-2 py-1 text-sm w-32"})]}),(0,a.jsxs)("button",{onClick:F,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2",children:[a.jsx(O.Z,{size:16})," ä¸‹è¼‰åœ–ç‰‡"]}),(0,a.jsxs)("button",{onClick:M,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2",children:[a.jsx(x.Z,{size:16})," ä¸‹è¼‰ PDF"]}),a.jsx("button",{onClick:e,className:"p-2 hover:bg-slate-100 rounded-full",children:a.jsx(_.Z,{})})]})]}),a.jsx("div",{className:"flex-1 overflow-auto bg-gray-500/50 w-full max-w-5xl p-8 flex justify-center items-start",children:(0,a.jsxs)("div",{ref:S,className:"bg-white p-10 shadow-2xl min-w-[1000px]",children:[(0,a.jsxs)("div",{className:"text-center mb-8 border-b-4 border-teal-600 pb-4",children:[(0,a.jsxs)("h1",{className:"text-5xl font-black text-slate-800 tracking-widest mb-2",children:[p," é–€è¨ºæ™‚é–“è¡¨"]}),a.jsx("p",{className:"text-xl text-slate-500 font-bold tracking-widest mt-2",children:m?`${D.replace(/-/g,".")} - ${E.replace(/-/g,".")}`:"é–€è¨ºæ™‚åˆ»è¡¨"})]}),Z.map((e,t)=>{let s=C(e[0]),l=C(e[6]);return(0,a.jsxs)("div",{className:t>0?"mt-12":"",children:[Z.length>1&&a.jsx("div",{className:"text-center mb-4",children:(0,a.jsxs)("h2",{className:"text-2xl font-bold text-teal-700",children:["ç¬¬ ",t+1," é€± (",s.replace(/-/g,".")," - ",l.replace(/-/g,"."),")"]})}),(0,a.jsxs)("table",{className:"w-full border-collapse border-2 border-slate-800 text-center",children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{className:"bg-teal-700 text-white h-16",children:[a.jsx("th",{className:"border border-slate-400 w-32 text-xl font-bold",children:"æ™‚æ®µ"}),e.map((e,t)=>{let s=0===e.getDay()?6:e.getDay()-1;return(0,a.jsxs)("th",{className:"border border-slate-400 w-32",children:[a.jsx("div",{className:"text-xl font-bold",children:J[s]}),m&&(0,a.jsxs)("div",{className:"text-sm opacity-80 mt-1",children:[e.getMonth()+1,"/",e.getDate()]})]},t)})]})}),a.jsx("tbody",{children:L.map(t=>(0,a.jsxs)("tr",{className:"h-40",children:[(0,a.jsxs)("td",{className:"border border-slate-400 align-middle",children:[a.jsx("div",{className:"text-2xl font-black text-teal-800 mb-2",children:t.label}),a.jsx("div",{className:"text-sm font-bold text-slate-500",children:t.time})]}),e.map((e,s)=>{let l=C(e),n=o.includes(l);if(n)return a.jsx("td",{className:"border border-slate-400 bg-gray-100 align-middle",children:a.jsx("div",{className:"text-3xl font-black text-gray-300 tracking-widest rotate-[-15deg] border-4 border-gray-300 inline-block p-2 rounded-xl",children:"ä¼‘è¨º"})},s);let d=r.filter(e=>e.date===l&&e.shift_code===t.id).sort((e,t)=>e.start_time.localeCompare(t.start_time));return a.jsx("td",{className:"border border-slate-400 align-middle p-2 hover:bg-slate-50/10",children:a.jsx("div",{className:"flex flex-col gap-3 h-full justify-center",children:d.map(e=>{let t=i.find(t=>t.id===e.doctor_id);return(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[a.jsx("span",{className:`text-xl font-bold leading-tight ${e.is_dedicated?"text-purple-700":"text-slate-800"}`,children:t?.name}),(0,a.jsxs)("span",{className:"text-xs font-mono text-slate-500 px-1.5 py-0.5 mt-1 whitespace-nowrap",children:[P(e.start_time),"-",P(e.end_time)]}),j&&e.special_tags&&e.special_tags.length>0&&a.jsx("div",{className:"flex flex-col items-center gap-0.5 mt-1",children:e.special_tags.map((t,s)=>a.jsx("span",{className:`text-[10px] font-bold whitespace-nowrap scale-90 origin-center ${e.is_dedicated?"text-pink-600":"text-orange-600"}`,children:e.is_dedicated?`${t}å°ˆè¨º`:`æš¨ ${t}`},s))}),w&&e.is_substitution&&a.jsx("span",{className:"text-xs font-bold text-purple-600 mt-0.5",children:"é–€è¨ºç•°å‹•"})]},e.id)})})},s)})]},t.id))})]})]},t)}),a.jsx("div",{className:"mt-6 text-center font-bold text-slate-500",children:"â€» è«‹æ–¼é–€è¨ºçµæŸå‰ 15 åˆ†é˜å®Œæˆæ›è™Ÿæ‰‹çºŒ"})]})})]})}let B=["ä¸€","äºŒ","ä¸‰","å››","äº”","å…­","æ—¥"],R=e=>{if(!e)return new Date;let[t,s,a]=e.split("-").map(Number);return new Date(t,s-1,a)};function q(){let[e,t]=(0,l.useState)(new Date),[s,r]=(0,l.useState)([]),[n,i]=(0,l.useState)([]),[d,o]=(0,l.useState)([]),[x,m]=(0,l.useState)([]),[h,p]=(0,l.useState)(!1),[u,b]=(0,l.useState)(null),[g,j]=(0,l.useState)({}),[w,k]=(0,l.useState)({openDays:[1,2,3,4,5,6],shifts:{AM:{start:"08:00",end:"12:30"},PM:{start:"14:00",end:"17:30"},NIGHT:{start:"18:00",end:"21:30"}}}),[S,C]=(0,l.useState)(!1),[O,P]=(0,l.useState)(!1),[A,I]=(0,l.useState)(!1),[H,J]=(0,l.useState)(null),[L,q]=(0,l.useState)(null),[G,U]=(0,l.useState)({doctorId:"",startTime:"",endTime:"",specialTags:[],isDedicated:!1,isSubstitution:!1}),W=e=>{let t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${s}-${a}`},V=e=>e?e.startsWith("0")?e.slice(1):e:"";(0,l.useEffect)(()=>{X(),Q()},[]),(0,l.useEffect)(()=>{K(),ee()},[e]),(0,l.useEffect)(()=>{es()},[n,e]);let X=async()=>{try{let e=await fetch("/api/staff?role=é†«å¸«"),t=await e.json();t.data&&r(t.data.filter(e=>"é†«å¸«"===e.role))}catch(e){console.error("Fetch doctors error:",e)}},Q=async()=>{try{let e=await fetch("/api/settings"),t=await e.json();t.data&&t.data.forEach(e=>{if("special_clinic_types"===e.key)try{m(JSON.parse(e.value))}catch(e){}if("clinic_business_hours"===e.key)try{k(JSON.parse(e.value))}catch(e){}})}catch(e){console.error("Fetch settings error:",e)}},K=async()=>{p(!0);try{let t=e.getFullYear(),s=e.getMonth()+1,a=await fetch(`/api/roster/doctor?year=${t}&month=${s}`),l=await a.json();l.error?(console.error("Error:",l.error),i([])):i(l.data||[])}catch(e){console.error("Fetch roster error:",e),i([])}finally{p(!1)}},ee=async()=>{try{let t=e.getFullYear(),s=e.getMonth()+1,a=await fetch(`/api/roster/closed-days?year=${t}&month=${s}`),l=await a.json();l.error?(console.error("Error:",l.error),o([])):o(l.data||[])}catch(e){console.error("Fetch closed days error:",e),o([])}},et=async e=>{let t=d.includes(e);try{if(t){let t=await fetch(`/api/roster/closed-days?date=${e}`,{method:"DELETE"}),s=await t.json();s.success?o(t=>t.filter(t=>t!==e)):alert("åˆªé™¤å¤±æ•—: "+s.message)}else{let t=prompt("è«‹è¼¸å…¥ä¼‘è¨ºåŸå› ","ä¼‘è¨º");if(null===t)return;let s=await fetch("/api/roster/closed-days",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:e,reason:t})}),a=await s.json();a.success?o(t=>[...t,e]):alert("æ–°å¢å¤±æ•—: "+a.message)}}catch(e){console.error("Toggle closed day error:",e),alert("æ“ä½œå¤±æ•—")}},es=()=>{let e={};s.forEach(t=>{e[t.id]={total:0,weekly:[0,0,0,0,0,0]}}),n.forEach(t=>{if(t.start_time&&t.end_time){let[s,a]=t.start_time.split(":").map(Number),[l,r]=t.end_time.split(":").map(Number),n=Math.max(0,60*l+r-(60*s+a))/60;e[t.doctor_id]||(e[t.doctor_id]={total:0,weekly:[0,0,0,0,0,0]}),e[t.doctor_id].total+=n;let i=R(t.date),d=new Date(i.getFullYear(),i.getMonth(),1),o=d.getDay(),c=Math.floor((i.getDate()+o-1)/7);c>=0&&c<6&&(e[t.doctor_id].weekly[c]+=n)}}),j(e)},ea=(e,t)=>{let s=w.shifts[t];return!!s&&("AM"===t?e.start_time<s.start||e.end_time>"13:30":"PM"===t?e.start_time<"13:00":"NIGHT"===t&&e.end_time>"23:00")},el=(e,t,a,l=null)=>{J({date:e,shiftId:t,shiftName:a});let r=w.shifts[t],n=r?.start||"08:00",i=r?.end||"12:00";if(l)q(l.id),U({doctorId:String(l.doctor_id),startTime:l.start_time,endTime:l.end_time,specialTags:l.special_tags||[],isDedicated:l.is_dedicated||!1,isSubstitution:l.is_substitution||!1});else{q(null);let e=s.length>0?String(s[0].id):"";U({doctorId:e,startTime:n,endTime:i,specialTags:[],isDedicated:!1,isSubstitution:!1})}C(!0)},er=e=>{G.specialTags.includes(e)?U(t=>({...t,specialTags:t.specialTags.filter(t=>t!==e)})):U(t=>({...t,specialTags:[...t.specialTags,e]}))},en=async()=>{if(!H||!G.doctorId)return;let e=Number(G.doctorId),t={id:L||void 0,doctor_id:e,date:H.date,shift_code:H.shiftId,start_time:G.startTime,end_time:G.endTime,special_tags:G.specialTags,is_dedicated:G.isDedicated,is_substitution:G.isSubstitution};try{if(L){let e=await fetch("/api/roster/doctor",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),s=await e.json();s.success?(C(!1),K()):alert("æ›´æ–°å¤±æ•—: "+s.message)}else{let s=n.find(t=>t.date===H.date&&t.shift_code===H.shiftId&&t.doctor_id===e);if(s&&!confirm("è¦†è“‹ï¼Ÿ"))return;let a=await fetch("/api/roster/doctor",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),l=await a.json();l.success?(C(!1),K()):alert("å¯«å…¥å¤±æ•—: "+l.message)}}catch(e){console.error("Submit assign error:",e),alert("æ“ä½œå¤±æ•—")}},ei=async e=>{if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ"))try{i(t=>t.filter(t=>t.id!==e));let t=await fetch(`/api/roster/doctor?id=${e}`,{method:"DELETE"}),s=await t.json();s.success?(C(!1),K()):alert("åˆªé™¤å¤±æ•—: "+s.message)}catch(e){console.error("Remove roster error:",e),alert("åˆªé™¤å¤±æ•—")}},ed=async(e,t)=>{if(confirm(`åˆªé™¤ ${e} åˆ° ${t} ?`)){p(!0);try{let s=await fetch(`/api/roster/doctor?start=${e}&end=${t}`,{method:"DELETE"}),a=await s.json();a.success?(P(!1),K()):alert("åˆªé™¤å¤±æ•—: "+a.message)}catch(e){console.error("Batch delete error:",e),alert("åˆªé™¤å¤±æ•—")}finally{p(!1)}}},eo=async(e,t,s)=>{p(!0);try{let a=await fetch("/api/roster/doctor",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourceStart:e,targetStart:t,days:s})}),l=await a.json();l.success?(P(!1),K(),alert(l.message||"å·²è¤‡è£½")):alert("è¤‡è£½å¤±æ•—: "+l.message)}catch(e){console.error("Batch copy error:",e),alert("è¤‡è£½å¤±æ•—")}finally{p(!1)}},ec=(()=>{let t=e.getFullYear(),s=e.getMonth(),a=new Date(t,s,1),l=a.getDay(),r=(l+6)%7,n=new Date(t,s+1,0).getDate(),i=[],d=1,o=[];for(let e=0;e<r;e++)o.push(null);for(;d<=n;)o.push(new Date(t,s,d)),d++;for(;o.length>0;)i.push(o.splice(0,7));return i})(),ex=[{id:"AM",label:"æ—©è¨º",color:"text-blue-600 bg-blue-50 border-blue-100"},{id:"PM",label:"åˆè¨º",color:"text-orange-600 bg-orange-50 border-orange-100"},{id:"NIGHT",label:"æ™šè¨º",color:"text-purple-600 bg-purple-50 border-purple-100"}];return(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6 h-full animate-fade-in p-2 relative",children:[(0,a.jsxs)("div",{className:"flex-1 bg-white rounded-2xl shadow-sm border border-teal-200 flex flex-col overflow-hidden h-[88vh]",children:[(0,a.jsxs)("div",{className:"p-4 flex justify-between items-center bg-teal-50 border-b border-teal-100 shrink-0",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-teal-800 flex items-center gap-2",children:[a.jsx(c.Z,{})," ",e.getFullYear()," å¹´ ",e.getMonth()+1," æœˆ é†«å¸«ç¸½ç­è¡¨"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:()=>P(!0),className:"flex items-center gap-1 text-xs bg-white border border-orange-300 text-orange-700 px-3 py-1.5 rounded hover:bg-orange-50 transition shadow-sm",children:[a.jsx(f.Z,{size:14})," æ‰¹æ¬¡"]}),(0,a.jsxs)("button",{onClick:()=>I(!0),className:"flex items-center gap-1 text-xs bg-white border border-purple-300 text-purple-700 px-3 py-1.5 rounded hover:bg-purple-50 transition shadow-sm",children:[a.jsx($.Z,{size:14})," é–€è¨ºè¡¨"]}),a.jsx("div",{className:"w-px h-6 bg-teal-200 mx-1"}),a.jsx("button",{onClick:()=>{let s=new Date(e);s.setMonth(s.getMonth()-1),t(s)},className:"p-2 hover:bg-white rounded-full border border-teal-200 text-teal-600",children:a.jsx(N.Z,{})}),a.jsx("button",{onClick:()=>{let s=new Date(e);s.setMonth(s.getMonth()+1),t(s)},className:"p-2 hover:bg-white rounded-full border border-teal-200 text-teal-600",children:a.jsx(y.Z,{})})]})]}),a.jsx("div",{className:"grid grid-cols-7 bg-teal-50/50 border-b border-teal-100 text-center font-bold text-teal-600 py-2 text-sm shrink-0",children:B.map(e=>a.jsx("div",{className:"æ—¥"===e||"å…­"===e?"text-orange-500":"",children:e},e))}),a.jsx("div",{className:"flex-1 overflow-y-auto bg-slate-50",children:ec.map((e,t)=>a.jsx("div",{className:"grid grid-cols-7 border-b border-slate-200 min-h-[160px] bg-white",children:e.map((e,t)=>{if(!e)return a.jsx("div",{className:"bg-slate-50/30 border-r border-slate-100 last:border-r-0"},t);let l=W(e),r=W(new Date)===l,i=d.includes(l);return(0,a.jsxs)("div",{className:`border-r border-slate-100 last:border-r-0 p-1 flex flex-col group transition hover:bg-teal-50/5 ${r?"bg-yellow-50":i?"bg-gray-100":""}`,children:[(0,a.jsxs)("div",{className:"text-right mb-1 px-1 flex justify-between items-center",children:[a.jsx("button",{onClick:()=>et(l),className:"text-[10px] text-slate-300 hover:text-red-500 p-1 rounded hover:bg-red-50",title:i?"å–æ¶ˆä¼‘è¨º":"è¨­å®šä¼‘è¨º",children:a.jsx(_.Z,{size:12})}),a.jsx("span",{className:`text-xs font-bold ${r?"bg-red-500 text-white px-1.5 py-0.5 rounded-full":"text-slate-400"}`,children:e.getDate()})]}),i?a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsx("span",{className:"text-red-300 font-bold text-xl tracking-widest select-none rotate-[-15deg] border-2 border-red-200 p-2 rounded opacity-50",children:"ä¼‘è¨º"})}):a.jsx("div",{className:"flex-1 flex flex-col gap-1",children:ex.map(e=>{let t=n.filter(t=>t.date===l&&t.shift_code===e.id).sort((e,t)=>e.start_time.localeCompare(t.start_time));return(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsxs)("div",{className:`text-[10px] font-bold px-1 flex justify-between items-center rounded cursor-pointer transition ${e.color} opacity-60 hover:opacity-100`,onClick:()=>el(l,e.id,e.label),children:[e.label," ",a.jsx(z.Z,{size:10,className:"opacity-0 group-hover:opacity-100"})]}),a.jsx("div",{className:"flex flex-col gap-1 pl-1",children:t.map(t=>{let r=s.find(e=>e.id===t.doctor_id),n=t.special_tags&&t.special_tags.length>0,i=u&&u!==t.doctor_id,d=ea(t,e.id),o=t.is_dedicated?"bg-purple-100 border-purple-300":t.is_substitution?"bg-orange-100 border-orange-300":n?"bg-pink-50 border-pink-200":"bg-white border-slate-200",c=t.is_dedicated?"text-purple-800":t.is_substitution?"text-orange-800":"text-slate-700";return(0,a.jsxs)("div",{onClick:s=>{s.stopPropagation(),el(l,e.id,e.label,t)},className:`relative px-2 py-1.5 rounded-md border shadow-sm text-xs group cursor-pointer hover:shadow-md transition ${o} ${i?"opacity-20 grayscale":"opacity-100"}`,children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[a.jsx("span",{className:`font-bold ${c}`,children:r?.name.slice(0,3)}),d&&a.jsx(Z.Z,{size:12,className:"text-red-500"}),a.jsx("button",{onClick:e=>{e.stopPropagation(),ei(t.id)},className:"text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition absolute top-1 right-1 bg-white/50 rounded-full p-0.5",children:a.jsx(T.Z,{size:12})})]}),(0,a.jsxs)("div",{className:`text-[10px] font-mono mt-0.5 ${d?"text-red-600 font-bold":"text-slate-500"}`,children:[V(t.start_time),"-",V(t.end_time)]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-0.5 mt-1",children:[t.is_dedicated&&a.jsx("span",{className:"bg-purple-600 text-white text-[9px] px-1 rounded-sm scale-90 origin-left",children:"å°ˆè¨º"}),t.is_substitution&&a.jsx("span",{className:"bg-orange-500 text-white text-[9px] px-1 rounded-sm scale-90 origin-left",children:"ç•°å‹•"}),t.special_tags?.map(e=>a.jsx("span",{className:"bg-pink-200 text-pink-800 text-[9px] px-1 rounded-sm scale-90 origin-left",children:e},e))]})]},t.id)})})]},e.id)})})]},t)})},t))})]}),a.jsx("div",{className:"w-full lg:w-72 flex-shrink-0 flex flex-col gap-4",children:(0,a.jsxs)("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-teal-200",children:[(0,a.jsxs)("h3",{className:"font-bold text-teal-800 mb-4 flex items-center gap-2 border-b border-teal-100 pb-2",children:[a.jsx(v.Z,{size:18})," æœ¬æœˆå·¥æ™‚çµ±è¨ˆ"]}),a.jsx("div",{className:"space-y-2 max-h-[70vh] overflow-y-auto pr-1",children:s.map(e=>{let t=g[e.id]||{total:0,weekly:[]},s=u===e.id;return(0,a.jsxs)("div",{className:`rounded border transition overflow-hidden ${s?"bg-teal-50 border-teal-300 ring-2 ring-teal-100":"bg-white border-transparent hover:bg-slate-50"}`,children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-2 cursor-pointer",onClick:()=>b(s?null:e.id),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:`w-7 h-7 rounded-full flex items-center justify-center font-bold text-xs shadow-sm ${s?"bg-teal-600 text-white":"bg-slate-100 text-slate-600"}`,children:e.name.slice(0,1)}),a.jsx("span",{className:`font-bold text-sm ${s?"text-teal-800":"text-slate-700"}`,children:e.name})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"font-mono font-bold text-teal-600 text-sm",children:[t.total.toFixed(1)," ",a.jsx("span",{className:"text-[10px] text-slate-400",children:"hr"})]}),s?a.jsx(D.Z,{size:14,className:"text-teal-500"}):a.jsx(E.Z,{size:14,className:"text-slate-300"})]})]}),s&&a.jsx("div",{className:"px-2 pb-2 bg-teal-50/50 border-t border-teal-100",children:a.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2",children:t.weekly.map((e,t)=>0===e&&t>4?null:(0,a.jsxs)("div",{className:"bg-white rounded p-1 text-center border border-teal-100",children:[(0,a.jsxs)("div",{className:"text-[10px] text-slate-400",children:["ç¬¬ ",t+1," é€±"]}),a.jsx("div",{className:"font-bold text-teal-700 text-xs",children:e.toFixed(1)})]},t))})})]},e.id)})})]})}),A&&a.jsx(Y,{onClose:()=>I(!1)}),O&&a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-orange-600 text-white p-4 flex justify-between items-center",children:[(0,a.jsxs)("h3",{className:"font-bold flex items-center gap-2",children:[a.jsx(f.Z,{size:20})," æ‰¹æ¬¡ç®¡ç†ä¸­å¿ƒ"]}),a.jsx("button",{onClick:()=>P(!1),children:a.jsx(_.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"p-6 space-y-8",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h4",{className:"font-bold text-slate-700 flex items-center gap-2",children:[a.jsx(F.Z,{size:16})," æ‰¹æ¬¡è¤‡è£½ç­è¡¨"]}),(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-lg border text-sm space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500",children:"ä¾†æºèµ·å§‹æ—¥"}),a.jsx("input",{type:"date",id:"copySrc",className:"w-full border p-1 rounded",defaultValue:W(new Date(Date.now()-6048e5))})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500",children:"ç›®æ¨™èµ·å§‹æ—¥"}),a.jsx("input",{type:"date",id:"copyTgt",className:"w-full border p-1 rounded",defaultValue:W(new Date)})]})]}),a.jsx("button",{onClick:()=>{let e=document.getElementById("copySrc").value,t=document.getElementById("copyTgt").value;eo(e,t,7)},className:"w-full bg-blue-600 text-white py-2 rounded font-bold hover:bg-blue-700",children:"è¤‡è£½ä¸€é€± (7å¤©)"})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h4",{className:"font-bold text-red-700 flex items-center gap-2",children:[a.jsx(T.Z,{size:16})," æ‰¹æ¬¡åˆªé™¤ç­è¡¨"]}),(0,a.jsxs)("div",{className:"bg-red-50 p-4 rounded-lg border border-red-100 text-sm space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500",children:"é–‹å§‹æ—¥æœŸ"}),a.jsx("input",{type:"date",id:"delStart",className:"w-full border p-1 rounded"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500",children:"çµæŸæ—¥æœŸ"}),a.jsx("input",{type:"date",id:"delEnd",className:"w-full border p-1 rounded"})]})]}),a.jsx("button",{onClick:()=>{let e=document.getElementById("delStart").value,t=document.getElementById("delEnd").value;ed(e,t)},className:"w-full bg-red-600 text-white py-2 rounded font-bold hover:bg-red-700",children:"ç¢ºèªåˆªé™¤å€é–“"})]})]})]})]})}),S&&H&&a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden border-2 border-teal-500",children:[(0,a.jsxs)("div",{className:"bg-teal-700 text-white p-4 flex justify-between items-center",children:[(0,a.jsxs)("h3",{className:"font-bold",children:[L?"ç·¨è¼¯":"æ–°å¢"," - ",H.date," ",H.shiftName]}),a.jsx("button",{onClick:()=>C(!1),className:"hover:bg-white/20 p-1 rounded",children:a.jsx(_.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"åŸ·æ¥­é†«å¸«"}),(0,a.jsxs)("select",{className:"w-full border p-2 rounded bg-slate-50 font-bold text-slate-700",value:G.doctorId,onChange:e=>U({...G,doctorId:e.target.value}),children:[a.jsx("option",{value:"",disabled:!0,children:"è«‹é¸æ“‡..."}),s.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"é–‹å§‹"}),a.jsx("input",{type:"time",className:"w-full border p-2 rounded font-mono text-center bg-slate-50",value:G.startTime,onChange:e=>U({...G,startTime:e.target.value})})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"çµæŸ"}),a.jsx("input",{type:"time",className:"w-full border p-2 rounded font-mono text-center bg-slate-50",value:G.endTime,onChange:e=>U({...G,endTime:e.target.value})})]})]}),(0,a.jsxs)("div",{className:"flex gap-4 border-t border-b py-3",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:G.isDedicated,onChange:e=>U({...G,isDedicated:e.target.checked}),className:"w-4 h-4 text-purple-600"}),a.jsx("span",{className:"text-sm font-bold text-purple-700",children:"å°ˆè¨º"})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:G.isSubstitution,onChange:e=>U({...G,isSubstitution:e.target.checked}),className:"w-4 h-4 text-orange-600"}),a.jsx("span",{className:"text-sm font-bold text-orange-700",children:"ç•°å‹•/ä»£è¨º"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2",children:"ç‰¹æ®Šé–€è¨º"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:x.map(e=>(0,a.jsxs)("button",{onClick:()=>er(e),className:`text-xs px-3 py-1.5 rounded-full border transition flex items-center gap-1 ${G.specialTags.includes(e)?"bg-pink-100 border-pink-300 text-pink-700 font-bold":"bg-white border-slate-200 text-slate-500 hover:bg-slate-50"}`,children:[G.specialTags.includes(e)&&a.jsx(M.Z,{size:12})," ",e]},e))})]}),(0,a.jsxs)("div",{className:"pt-4 flex gap-2",children:[L&&a.jsx("button",{onClick:()=>ei(L),className:"bg-red-50 text-red-600 py-3 px-4 rounded-lg font-bold hover:bg-red-100 transition",children:a.jsx(T.Z,{size:20})}),a.jsx("button",{onClick:en,className:"flex-1 bg-teal-600 text-white py-3 rounded-lg font-bold hover:bg-teal-700 transition shadow-md",children:L?"æ›´æ–°å„²å­˜":"ç¢ºèªæ’ç­"})]})]})]})})]})}var G=s(6867),U=s(22631);function W(){return(0,a.jsxs)("div",{className:"max-w-6xl mx-auto p-4 animate-fade-in text-slate-800",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-slate-800 to-slate-700 text-white p-6 rounded-2xl shadow-lg mb-8",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold flex items-center gap-3",children:[a.jsx(u.Z,{className:"text-yellow-400"}),"å‹å‹•åŸºæº–æ³• è€ƒå‹¤èˆ‡è–ªè³‡è¦ç¯„ (è¨ºæ‰€ç‰ˆ)"]}),a.jsx("p",{className:"text-slate-300 mt-2 text-sm",children:"æœ¬é é¢ä¾æ“šå°ç£ã€Šå‹å‹•åŸºæº–æ³•ã€‹ç·¨çº‚ï¼Œåƒ…ä¾›æ’ç­èˆ‡ç®—è–ªåƒè€ƒã€‚"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-200",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold flex items-center gap-2 mb-4 text-blue-700",children:[a.jsx(v.Z,{size:20})," 1. åŸºç¤å·¥æ™‚å®šç¾©"]}),(0,a.jsxs)("ul",{className:"space-y-4 text-sm text-slate-600",children:[(0,a.jsxs)("li",{className:"flex justify-between border-b pb-2",children:[(0,a.jsxs)("div",{children:[a.jsx("div",{className:"font-bold text-slate-800",children:"æ­£å¸¸å·¥æ™‚"}),a.jsx("div",{className:"text-xs text-slate-400",children:"å‹åŸºæ³•ç¬¬ 30 æ¢ç¬¬ 1 é …"})]}),a.jsx("span",{className:"font-bold text-slate-800",children:"æ¯æ—¥ 8H / æ¯é€± 40H"})]}),(0,a.jsxs)("li",{className:"flex justify-between border-b pb-2",children:[(0,a.jsxs)("div",{children:[a.jsx("div",{className:"font-bold text-slate-800",children:"ä¼‘æ¯æ™‚é–“"}),a.jsx("div",{className:"text-xs text-slate-400",children:"å‹åŸºæ³•ç¬¬ 35 æ¢"})]}),a.jsx("span",{className:"font-bold text-slate-800",children:"é€£çºŒå·¥ä½œ 4H éœ€ä¼‘ 30åˆ†"})]}),(0,a.jsxs)("li",{className:"flex justify-between border-b pb-2",children:[(0,a.jsxs)("div",{children:[a.jsx("div",{className:"font-bold text-slate-800",children:"è¼ªç­é–“éš”"}),a.jsx("div",{className:"text-xs text-slate-400",children:"å‹åŸºæ³•ç¬¬ 34 æ¢ç¬¬ 2 é …"})]}),a.jsx("span",{className:"font-bold text-red-600",children:"æ›´æ›ç­æ¬¡æ™‚ï¼Œè‡³å°‘ä¼‘æ¯ 11 å°æ™‚"})]}),(0,a.jsxs)("li",{className:"flex justify-between pb-2",children:[(0,a.jsxs)("div",{children:[a.jsx("div",{className:"font-bold text-slate-800",children:"å·¥è³‡è¨ˆç®—åŸºç¤ (å¹³æ—¥æ¯å°æ™‚)"}),a.jsx("div",{className:"text-xs text-slate-400",children:"å‹åŸºæ³•ç¬¬ 24 æ¢ (æ¨ç®—)"})]}),a.jsx("span",{className:"font-bold text-slate-800",children:"æœˆè–ªç¸½é¡ \xf7 30 \xf7 8"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-200",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold flex items-center gap-2 mb-4 text-green-700",children:[a.jsx(h.Z,{size:20})," 2. åŠ ç­è²»å€ç‡è¨ˆç®—"]}),(0,a.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,a.jsxs)("div",{className:"bg-slate-50 p-3 rounded-lg border-l-4 border-blue-500",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[a.jsx("div",{className:"font-bold text-slate-800",children:"A. å¹³æ—¥å»¶é•·å·¥æ™‚"}),a.jsx("div",{className:"text-[10px] text-slate-400",children:"å‹åŸºæ³•ç¬¬ 24 æ¢ç¬¬ 1 é …"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{children:"å‰ 2 å°æ™‚"})," ",a.jsx("span",{className:"font-mono font-bold text-blue-600",children:"\xd7 1.34 (4/3)"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{children:"ç¬¬ 3 å°æ™‚èµ·"})," ",a.jsx("span",{className:"font-mono font-bold text-blue-600",children:"\xd7 1.67 (5/3)"})]})]}),(0,a.jsxs)("div",{className:"bg-slate-50 p-3 rounded-lg border-l-4 border-orange-500",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,a.jsxs)("div",{className:"font-bold text-slate-800",children:["B. ä¼‘æ¯æ—¥å‡ºå‹¤ ",a.jsx("span",{className:"text-xs font-normal text-orange-600",children:"(åšå¤šå°‘ç®—å¤šå°‘)"})]}),a.jsx("div",{className:"text-[10px] text-slate-400",children:"å‹åŸºæ³•ç¬¬ 24 æ¢ç¬¬ 2 é …"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{children:"å‰ 2 å°æ™‚"})," ",a.jsx("span",{className:"font-mono font-bold text-orange-600",children:"\xd7 1.34"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{children:"ç¬¬ 3-8 å°æ™‚"})," ",a.jsx("span",{className:"font-mono font-bold text-orange-600",children:"\xd7 1.67"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{children:"ç¬¬ 9 å°æ™‚èµ·"})," ",a.jsx("span",{className:"font-mono font-bold text-orange-600",children:"\xd7 2.67"})]})]}),(0,a.jsxs)("div",{className:"bg-slate-50 p-3 rounded-lg border-l-4 border-red-500",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[a.jsx("div",{className:"font-bold text-slate-800",children:"C. åœ‹å®šå‡æ—¥/ä¾‹å‡å‡ºå‹¤"}),a.jsx("div",{className:"text-[10px] text-slate-400",children:"å‹åŸºæ³•ç¬¬ 39 æ¢"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{children:"8 å°æ™‚å…§"})," ",a.jsx("span",{className:"font-mono font-bold text-red-600",children:"åŠ ç™¼ 1 æ—¥å·¥è³‡"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{children:"è¶…é 8 å°æ™‚"})," ",a.jsx("span",{className:"font-mono font-bold text-red-600",children:"æ¯”ç…§å¹³æ—¥åŠ ç­ (1.34/1.67)"})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-200 lg:col-span-2",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold flex items-center gap-2 mb-4 text-purple-700",children:[a.jsx(o.Z,{size:20})," 3. è®Šå½¢å·¥æ™‚æ’ç­è¦å‰‡ ",a.jsx("span",{className:"text-sm font-normal text-gray-400 ml-2",children:"(å‹åŸºæ³•ç¬¬ 30 æ¢ä¹‹ 1)"})]}),a.jsx("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm text-left",children:[a.jsx("thead",{className:"bg-slate-100 text-slate-600 font-bold",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"p-3 rounded-tl-lg",children:"åˆ¶åº¦"}),a.jsx("th",{className:"p-3",children:"é©ç”¨å°è±¡"}),a.jsx("th",{className:"p-3",children:"æ¯æ—¥/ç¸½å·¥æ™‚ä¸Šé™"}),a.jsx("th",{className:"p-3 rounded-tr-lg",children:"ä¼‘å‡èˆ‡é€£é–é™åˆ¶ (ä¾‹å‡+ä¼‘æ¯æ—¥)"})]})}),(0,a.jsxs)("tbody",{className:"divide-y divide-slate-100",children:[(0,a.jsxs)("tr",{children:[a.jsx("td",{className:"p-3 font-bold text-slate-800",children:"æ­£å¸¸å·¥æ™‚"}),a.jsx("td",{className:"p-3",children:"ä¸€èˆ¬å“¡å·¥"}),a.jsx("td",{className:"p-3",children:"8H / 40H (é€±)"}),(0,a.jsxs)("td",{className:"p-3",children:[a.jsx("span",{className:"text-red-600 font-bold",children:"ä¸å¾—é€£çºŒå·¥ä½œ > 6 å¤©"})," (æ¯7æ—¥è‡³å°‘1ä¾‹1ä¼‘)"]})]}),(0,a.jsxs)("tr",{children:[a.jsx("td",{className:"p-3 font-bold text-slate-800",children:"2é€±è®Šå½¢"}),a.jsx("td",{className:"p-3",children:"é©ç”¨å‹åŸºæ³•è¡Œæ¥­"}),a.jsx("td",{className:"p-3",children:"10H / 80H (2é€±)"}),(0,a.jsxs)("td",{className:"p-3",children:[a.jsx("span",{className:"text-red-600 font-bold",children:"ä¸å¾—é€£çºŒå·¥ä½œ > 6 å¤©"})," (æ¯2é€±è‡³å°‘2ä¾‹2ä¼‘)"]})]}),(0,a.jsxs)("tr",{className:"bg-purple-50",children:[a.jsx("td",{className:"p-3 font-bold text-purple-900",children:"4é€±è®Šå½¢"}),a.jsx("td",{className:"p-3 font-bold",children:"é†«ç™‚ä¿å¥æ¥­ (è¨ºæ‰€)"}),a.jsx("td",{className:"p-3",children:"10H / 160H (4é€±)"}),(0,a.jsxs)("td",{className:"p-3",children:[a.jsx("span",{className:"text-red-600 font-bold",children:"ä¸å¾—é€£çºŒå·¥ä½œ > 12 å¤©"})," (æ¯2é€±è‡³å°‘2ä¾‹å‡)"]})]}),(0,a.jsxs)("tr",{className:"bg-indigo-50",children:[a.jsx("td",{className:"p-3 font-bold text-indigo-900",children:"8é€±è®Šå½¢"}),a.jsx("td",{className:"p-3 font-bold",children:"é†«ç™‚ä¿å¥æ¥­ (è¨ºæ‰€)"}),a.jsx("td",{className:"p-3",children:"8H / 320H (8é€±)"}),(0,a.jsxs)("td",{className:"p-3",children:[a.jsx("span",{className:"text-red-600 font-bold",children:"ä¸å¾—é€£çºŒå·¥ä½œ > 6 å¤©"})," (æ¯8é€±è‡³å°‘8ä¾‹8ä¼‘)"]})]})]})]})}),(0,a.jsxs)("div",{className:"mt-4 bg-indigo-50 p-4 rounded-lg text-sm text-indigo-900 border border-indigo-200",children:[(0,a.jsxs)("h4",{className:"font-bold flex items-center gap-2 mb-2",children:[a.jsx(u.Z,{size:16})," å…«é€±è®Šå½¢å·¥æ™‚é‡é»èªªæ˜ (å‹åŸºæ³•ç¬¬ 30 æ¢ç¬¬ 3 é …)"]}),(0,a.jsxs)("ul",{className:"list-disc pl-5 space-y-1",children:[(0,a.jsxs)("li",{children:[a.jsx("span",{className:"font-bold",children:"é©ç”¨è¡Œæ¥­ï¼š"}),"ç¶“ä¸­å¤®ä¸»ç®¡æ©Ÿé—œæŒ‡å®šä¹‹è¡Œæ¥­ï¼ˆå¦‚é†«ç™‚ä¿å¥æœå‹™æ¥­ï¼‰ã€‚"]}),(0,a.jsxs)("li",{children:[a.jsx("span",{className:"font-bold",children:"å·¥æ™‚æŒªç§»ï¼š"}),"å¯å°‡8é€±å…§ä¹‹æ­£å¸¸å·¥ä½œæ™‚æ•¸åŠ ä»¥åˆ†é…ã€‚ä½†æ¯æ—¥æ­£å¸¸å·¥æ™‚ä¸å¾—è¶…é8å°æ™‚ï¼Œæ¯é€±æ­£å¸¸å·¥æ™‚ä¸å¾—è¶…é48å°æ™‚ã€‚"]}),(0,a.jsxs)("li",{children:[a.jsx("span",{className:"font-bold",children:"ä¼‘å‡è¦å®šï¼š"}),"æ¯7æ—¥ä¸­è‡³å°‘æ‡‰æœ‰1æ—¥ä¹‹ä¾‹å‡ï¼Œæ¯8é€±å…§ä¹‹ä¾‹å‡åŠä¼‘æ¯æ—¥è‡³å°‘æ‡‰æœ‰16æ—¥ã€‚"]}),(0,a.jsxs)("li",{children:[a.jsx("span",{className:"font-bold",children:"æ’ç­å½ˆæ€§ï¼š"}),"é›–ç„¶æ¯æ—¥æ­£å¸¸å·¥æ™‚ç¶­æŒ8å°æ™‚ä¸Šé™ï¼Œä½†å¯é€é8é€±é€±æœŸä¾†èª¿é…æ¯é€±å·¥æ™‚ï¼Œé©åˆæ·¡æ—ºå­£æ˜é¡¯æˆ–éœ€é•·é€±æœŸæ’ç­ä¹‹å–®ä½ã€‚"]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-200 lg:col-span-2",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold flex items-center gap-2 mb-4 text-teal-700",children:[a.jsx(G.Z,{size:20})," 4. ç‰¹åˆ¥ä¼‘å‡è¦å®š (Annual Leave) ",a.jsx("span",{className:"text-sm font-normal text-gray-400 ml-2",children:"(å‹åŸºæ³•ç¬¬ 38 æ¢)"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-200",children:(0,a.jsxs)("table",{className:"w-full text-sm text-left",children:[a.jsx("thead",{className:"bg-teal-50 text-teal-900 font-bold",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"p-3",children:"å·¥ä½œå¹´è³‡ (ç¹¼çºŒå·¥ä½œæ»¿)"}),a.jsx("th",{className:"p-3 text-right",children:"ç‰¹ä¼‘å¤©æ•¸"})]})}),(0,a.jsxs)("tbody",{className:"divide-y divide-slate-100 bg-white",children:[(0,a.jsxs)("tr",{children:[a.jsx("td",{className:"p-3",children:"6å€‹æœˆ ä»¥ä¸Š ï½ æœªæ»¿ 1å¹´"}),a.jsx("td",{className:"p-3 text-right font-bold",children:"3 æ—¥"})]}),(0,a.jsxs)("tr",{children:[a.jsx("td",{className:"p-3",children:"1å¹´ ä»¥ä¸Š ï½ æœªæ»¿ 2å¹´"}),a.jsx("td",{className:"p-3 text-right font-bold",children:"7 æ—¥"})]}),(0,a.jsxs)("tr",{children:[a.jsx("td",{className:"p-3",children:"2å¹´ ä»¥ä¸Š ï½ æœªæ»¿ 3å¹´"}),a.jsx("td",{className:"p-3 text-right font-bold",children:"10 æ—¥"})]}),(0,a.jsxs)("tr",{children:[a.jsx("td",{className:"p-3",children:"3å¹´ ä»¥ä¸Š ï½ æœªæ»¿ 5å¹´"}),a.jsx("td",{className:"p-3 text-right font-bold",children:"14 æ—¥"})]}),(0,a.jsxs)("tr",{children:[a.jsx("td",{className:"p-3",children:"5å¹´ ä»¥ä¸Š ï½ æœªæ»¿ 10å¹´"}),a.jsx("td",{className:"p-3 text-right font-bold",children:"15 æ—¥"})]}),(0,a.jsxs)("tr",{children:[a.jsx("td",{className:"p-3",children:"10å¹´ ä»¥ä¸Š"}),a.jsx("td",{className:"p-3 text-right font-bold",children:"æ¯1å¹´åŠ 1æ—¥ (ä¸Šé™30æ—¥)"})]})]})]})}),(0,a.jsxs)("div",{className:"space-y-4 text-sm text-slate-700",children:[(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-lg",children:[(0,a.jsxs)("div",{className:"font-bold text-slate-900 mb-2 flex items-center gap-2",children:[a.jsx(U.Z,{size:16})," æœªä¼‘æŠ˜ç®—å·¥è³‡ (ç¬¬ 38 æ¢ç¬¬ 4 é …)"]}),(0,a.jsxs)("p",{children:["å¹´åº¦çµ‚çµæˆ–å¥‘ç´„çµ‚æ­¢è€Œæœªä¼‘ä¹‹æ—¥æ•¸ï¼Œé›‡ä¸»æ‡‰ç™¼çµ¦å·¥è³‡ã€‚",a.jsx("br",{}),a.jsx("br",{}),a.jsx("span",{className:"text-xs text-slate-500",children:"* ç¶“å‹é›‡é›™æ–¹å”å•†éå»¶è‡³æ¬¡ä¸€å¹´åº¦å¯¦æ–½è€…ï¼Œæ–¼æ¬¡ä¸€å¹´åº¦çµ‚çµæˆ–å¥‘ç´„çµ‚æ­¢ä»æœªä¼‘ä¹‹æ—¥æ•¸ï¼Œé›‡ä¸»æ‡‰ç™¼çµ¦å·¥è³‡ã€‚"})]})]}),(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-lg",children:[(0,a.jsxs)("div",{className:"font-bold text-slate-900 mb-2 flex items-center gap-2",children:[a.jsx(U.Z,{size:16})," å¹´è³‡è¨ˆç®— (ç¬¬ 84-2 æ¢)"]}),(0,a.jsxs)("p",{children:["å‹å·¥å·¥ä½œå¹´è³‡è‡ªå—åƒ±ä¹‹æ—¥èµ·ç®—ã€‚",a.jsx("br",{}),"ç•™è·åœè–ªæœŸé–“ï¼Œå¾—ä¸ä½µå…¥å·¥ä½œå¹´è³‡è¨ˆç®— (é™¤éå‹è³‡é›™æ–¹å¦æœ‰ç´„å®š)ã€‚"]})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-200 lg:col-span-2",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold flex items-center gap-2 mb-4 text-red-600",children:[a.jsx(Z.Z,{size:20})," 5. ç³»çµ±æ’ç­è‡ªå‹•æª¢æ¸¬é‚è¼¯"]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{className:"border p-3 rounded-lg bg-red-50 border-red-100",children:[a.jsx("div",{className:"font-bold text-red-800 mb-1",children:"éŒ¯èª¤ (Error) - ç¦æ­¢æ’ç­"}),(0,a.jsxs)("ul",{className:"list-disc list-inside text-red-700 space-y-1",children:[a.jsx("li",{children:"å–®æ—¥ç¸½å·¥æ™‚ > 12 å°æ™‚ (å‹åŸºæ³•ç¬¬ 32 æ¢)"}),a.jsx("li",{children:"æ¯æœˆåŠ ç­ç¸½æ™‚æ•¸ > 46 å°æ™‚ (å‹åŸºæ³•ç¬¬ 32 æ¢)"}),a.jsx("li",{children:"é€£çºŒå·¥ä½œå¤©æ•¸é•è¦ (ç¬¬ 36 æ¢: 7ä¼‘1 / 14ä¼‘2 / 4é€±è®Šå½¢)"})]})]}),(0,a.jsxs)("div",{className:"border p-3 rounded-lg bg-yellow-50 border-yellow-100",children:[a.jsx("div",{className:"font-bold text-yellow-800 mb-1",children:"è­¦å‘Š (Warning) - éœ€æ³¨æ„"}),(0,a.jsxs)("ul",{className:"list-disc list-inside text-yellow-700 space-y-1",children:[a.jsx("li",{children:"è¼ªç­é–“éš” < 11 å°æ™‚ (å‹åŸºæ³•ç¬¬ 34 æ¢)"}),a.jsx("li",{children:"é€£çºŒå·¥ä½œ 4 å°æ™‚ç„¡ä¼‘æ¯ç´€éŒ„ (å‹åŸºæ³•ç¬¬ 35 æ¢)"}),a.jsx("li",{children:"åœ‹å®šå‡æ—¥å‡ºå‹¤æœªåŠ å€è–ªè³‡ (å‹åŸºæ³•ç¬¬ 39 æ¢)"})]})]})]})]})]})]})}var V=s(85335),X=s(40834),Q=s(20987),K=s(93680),ee=s(95196),et=s(51831);let es=()=>{let e=new Date,t=new Date(e.getFullYear(),0,1),s=new Date(e.getFullYear(),11,31),a=e=>e.toISOString().split("T")[0];return{start:a(t),end:a(s)}};function ea(){let e=es(),[t,s]=(0,l.useState)([]),[r,n]=(0,l.useState)([]),[d,c]=(0,l.useState)(!0),[x,m]=(0,l.useState)(!1),[h,u]=(0,l.useState)(e.start),[b,f]=(0,l.useState)(e.end),[g,j]=(0,l.useState)("all"),[N,y]=(0,l.useState)("all"),[k,S]=(0,l.useState)(!1),[C,$]=(0,l.useState)(!1),[Z,D]=(0,l.useState)(null),[E,F]=(0,l.useState)({staffId:"",workType:"æ­£å¸¸ç­",date:new Date().toISOString().split("T")[0],startTime:"08:00",endTime:"17:00",note:""});(0,l.useEffect)(()=>{M()},[]),(0,l.useEffect)(()=>{A()},[x,h,b,N,g]);let M=async()=>{try{let e=await fetch("/api/staff"),t=await e.json();t.data&&(n(t.data),t.data.length>0&&!E.staffId&&F(e=>({...e,staffId:String(t.data[0].id)})))}catch(e){console.error("Fetch staff error:",e),alert("è¼‰å…¥å“¡å·¥åˆ—è¡¨å¤±æ•—")}},O=Array.from(new Set(r.map(e=>e.role||"æœªåˆ†é¡"))).filter(Boolean),P="all"===g?r:r.filter(e=>(e.role||"æœªåˆ†é¡")===g),A=async()=>{c(!0);try{let e=new URLSearchParams({useDateFilter:String(x),selectedStaffId:N,selectedRole:g});x&&(e.append("startDate",h),e.append("endDate",b));let t=await fetch(`/api/attendance?${e.toString()}`),a=await t.json();a.error?(console.error("Error fetching logs:",a.error),alert("è¼‰å…¥è€ƒå‹¤ç´€éŒ„å¤±æ•—: "+a.error),s([])):s(a.data||[])}catch(e){console.error("Fetch logs error:",e),alert("è¼‰å…¥è€ƒå‹¤ç´€éŒ„å¤±æ•—"),s([])}finally{c(!1)}},H=async(e,t)=>{if(confirm(`ç¢ºå®šè¦${"approved"===t?"æ ¸å‡†":"é§å›"}é€™ç­†åŠ ç­ç”³è«‹å—ï¼Ÿ`))try{let s=await fetch("/api/attendance",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,overtime_status:t})}),a=await s.json();a.success?(alert(`åŠ ç­ç”³è«‹å·²${"approved"===t?"æ ¸å‡†":"é§å›"}`),A()):alert("æ“ä½œå¤±æ•—: "+(a.message||a.error))}catch(e){console.error("Overtime approval error:",e),alert("æ“ä½œå¤±æ•—: "+e.message)}},J=async e=>{if(confirm("ç¢ºå®šè¦æ°¸ä¹…åˆªé™¤é€™ç­†æ‰“å¡ç´€éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚"))try{let t=await fetch(`/api/attendance?id=${e}`,{method:"DELETE"}),s=await t.json();s.success?(alert(s.message||"åˆªé™¤æˆåŠŸ"),A()):alert(s.message||"åˆªé™¤å¤±æ•—")}catch(e){alert("åˆªé™¤å¤±æ•—: "+e.message)}},L=e=>{D(e.id);let t=e.clock_in_time?e.clock_in_time.split("T")[0]:new Date().toISOString().split("T")[0],s="08:00",a="17:00";if(e.clock_in_time){let t=new Date(e.clock_in_time),a=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0");s=`${a}:${l}`}if(e.clock_out_time){let t=new Date(e.clock_out_time),s=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0");a=`${s}:${l}`}let l=e.staff_id;if(!l){let t=r.find(t=>t.name===e.staff_name);t&&(l=t.id)}F({staffId:l?String(l):"",workType:e.work_type||"æ­£å¸¸ç­",date:t,startTime:s,endTime:a,note:e.note||""}),S(!0)},Y=async()=>{if(!E.staffId||!E.date||!E.startTime){alert("è«‹å¡«å¯«å®Œæ•´è³‡è¨Š");return}$(!0);try{let e=r.find(e=>String(e.id)===E.staffId);if(!e){alert("æ‰¾ä¸åˆ°å“¡å·¥è³‡æ–™"),$(!1);return}if(E.endTime){let e=new Date(`${E.date}T${E.endTime}:00`),t=new Date(`${E.date}T${E.startTime}:00`);if(e<t&&!confirm("ä¸‹ç­æ™‚é–“æ—©æ–¼ä¸Šç­æ™‚é–“ï¼Œç¢ºèªè¦é€å‡ºå—ï¼Ÿ")){$(!1);return}}let t={id:Z||void 0,staffId:Number(E.staffId),staffName:e.name,date:E.date,startTime:E.startTime,endTime:E.endTime||void 0,workType:E.workType,note:E.note||void 0},s=await fetch("/api/attendance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await s.json();a.success?(alert(a.message||(Z?"ä¿®æ”¹æˆåŠŸï¼":"è£œæ‰“å¡æˆåŠŸï¼")),S(!1),A()):alert(a.message||"è™•ç†å¤±æ•—")}catch(e){console.error(e),alert(`è™•ç†å¤±æ•—: ${e.message}`)}finally{$(!1)}},B=t.reduce((e,t)=>e+(Number(t.work_hours)||0),0);return(0,a.jsxs)("div",{className:"w-full animate-fade-in space-y-6 relative",children:[(0,a.jsxs)("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex flex-wrap justify-between items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-slate-800 flex items-center gap-2 shrink-0",children:[a.jsx(v.Z,{className:"text-blue-600"})," è€ƒå‹¤ç´€éŒ„"]}),a.jsx("div",{className:"h-8 w-px bg-slate-200 mx-2 hidden md:block"}),(0,a.jsxs)("button",{onClick:()=>m(!x),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border text-sm font-bold transition ${x?"bg-blue-50 border-blue-200 text-blue-700":"bg-slate-50 border-slate-200 text-slate-500"}`,children:[x?a.jsx(V.Z,{size:20,className:"text-blue-600"}):a.jsx(X.Z,{size:20,className:"text-slate-400"}),"æ—¥æœŸç¯©é¸"]}),x&&(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-slate-50 p-1.5 rounded-lg border text-sm animate-fade-in",children:[a.jsx(o.Z,{size:16,className:"text-slate-400 ml-1"}),a.jsx("input",{type:"date",value:h,onChange:e=>u(e.target.value),className:"bg-transparent font-bold text-slate-700 outline-none"}),a.jsx("span",{className:"text-slate-400",children:"~"}),a.jsx("input",{type:"date",value:b,onChange:e=>f(e.target.value),className:"bg-transparent font-bold text-slate-700 outline-none"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-slate-50 p-1.5 rounded-lg border text-sm w-40",children:[a.jsx(Q.Z,{size:16,className:"text-slate-400 ml-1"}),(0,a.jsxs)("select",{value:g,onChange:e=>{j(e.target.value),y("all")},className:"bg-transparent font-bold text-slate-700 outline-none w-full",children:[a.jsx("option",{value:"all",children:"æ‰€æœ‰è·ä½"}),O.map(e=>a.jsx("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-slate-50 p-1.5 rounded-lg border text-sm w-40",children:[a.jsx(K.Z,{size:16,className:"text-slate-400 ml-1"}),(0,a.jsxs)("select",{value:N,onChange:e=>y(e.target.value),className:"bg-transparent font-bold text-slate-700 outline-none w-full",children:[a.jsx("option",{value:"all",children:"æ‰€æœ‰å“¡å·¥"}),P.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})]})]}),(0,a.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,a.jsxs)("button",{onClick:()=>{D(null),F({staffId:r.length>0?String(r[0].id):"",workType:"æ­£å¸¸ç­",date:new Date().toISOString().split("T")[0],startTime:"08:00",endTime:"17:00",note:""}),S(!0)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2 transition text-sm shadow-sm",children:[a.jsx(z.Z,{size:18})," è£œç™»æ‰“å¡"]}),(0,a.jsxs)("div",{className:"text-right hidden sm:block",children:[a.jsx("span",{className:"block text-xs text-slate-400",children:"ç¸½å·¥æ™‚åˆè¨ˆ"}),(0,a.jsxs)("span",{className:"text-xl font-bold text-blue-600 font-mono",children:[B.toFixed(1)," ",a.jsx("span",{className:"text-sm",children:"hr"})]})]}),(0,a.jsxs)("button",{onClick:()=>{if(0===t.length)return alert("ç„¡è³‡æ–™å¯åŒ¯å‡º");let e=t.map(e=>[e.staff_name,"overtime"===e.work_type?"åŠ ç­":"ä¸Šç­",e.clock_in_time?.slice(0,10)||"",e.clock_in_time?new Date(e.clock_in_time).toLocaleTimeString():"",e.clock_out_time?new Date(e.clock_out_time).toLocaleTimeString():"",e.work_hours?Number(e.work_hours).toFixed(2):"0",e.note||""]),s="\uFEFF"+["å“¡å·¥å§“å,æ‰“å¡é¡å‹,æ—¥æœŸ,ä¸Šç­æ™‚é–“,ä¸‹ç­æ™‚é–“,å·¥æ™‚(hr),å‚™è¨»",...e.map(e=>e.join(","))].join("\n"),a=new Blob([s],{type:"text/csv;charset=utf-8;"});(0,I.saveAs)(a,`è€ƒå‹¤ç´€éŒ„_${x?h+"_"+b:"å…¨éƒ¨"}.csv`)},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2 transition text-sm",children:[a.jsx(p.Z,{size:18})," åŒ¯å‡º CSV"]})]})]}),k&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-4 border-b bg-slate-50 flex justify-between items-center",children:[(0,a.jsxs)("h3",{className:"font-bold text-lg text-slate-800 flex items-center gap-2",children:[Z?a.jsx(ee.Z,{className:"text-orange-600",size:20}):a.jsx(z.Z,{className:"text-blue-600",size:20}),Z?"ä¿®æ”¹æ‰“å¡ç´€éŒ„":"è£œç™»æ‰“å¡ç´€éŒ„"]}),a.jsx("button",{onClick:()=>S(!1),className:"text-slate-400 hover:text-slate-600 p-1",children:a.jsx(_.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[Z&&(0,a.jsxs)("div",{className:"bg-orange-50 text-orange-700 px-3 py-2 rounded-lg text-xs flex items-center gap-2",children:[a.jsx(et.Z,{size:14})," è‹¥æ˜¯å¿˜è¨˜æ‰“å¡ä¸‹ç­ï¼Œè«‹å¡«å¯«æ­£ç¢ºä¸‹ç­æ™‚é–“ä¸¦å„²å­˜ã€‚"]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-600 mb-1",children:"å“¡å·¥å§“å"}),(0,a.jsxs)("select",{value:E.staffId,onChange:e=>F({...E,staffId:e.target.value}),className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white",disabled:!!Z,children:[a.jsx("option",{value:"",disabled:!0,children:"è«‹é¸æ“‡å“¡å·¥"}),r.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," (",e.role||"ç„¡",")"]},e.id))]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-600 mb-1",children:"æ—¥æœŸ"}),a.jsx("input",{type:"date",value:E.date,onChange:e=>F({...E,date:e.target.value}),className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-600 mb-1",children:"ç­åˆ¥é¡å‹"}),(0,a.jsxs)("select",{value:E.workType,onChange:e=>F({...E,workType:e.target.value}),className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white",children:[a.jsx("option",{value:"æ­£å¸¸ç­",children:"æ­£å¸¸ç­"}),a.jsx("option",{value:"åŠ ç­",children:"åŠ ç­"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-600 mb-1",children:"ä¸Šç­æ™‚é–“"}),a.jsx("input",{type:"time",value:E.startTime,onChange:e=>F({...E,startTime:e.target.value}),className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none font-mono"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-600 mb-1",children:"ä¸‹ç­æ™‚é–“"}),a.jsx("input",{type:"time",value:E.endTime,onChange:e=>F({...E,endTime:e.target.value}),className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none font-mono"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-600 mb-1",children:"å‚™è¨» (Note)"}),a.jsx("input",{type:"text",value:E.note,onChange:e=>F({...E,note:e.target.value}),placeholder:"ä¾‹ï¼šå¿˜è¨˜å¸¶æ‰‹æ©Ÿè£œç™»ã€è£œä¼‘èª¿æ•´...",className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),(0,a.jsxs)("div",{className:"p-4 border-t bg-slate-50 flex justify-end gap-3",children:[a.jsx("button",{onClick:()=>S(!1),className:"px-4 py-2 text-slate-600 font-bold hover:bg-slate-200 rounded-lg transition",children:"å–æ¶ˆ"}),(0,a.jsxs)("button",{onClick:Y,disabled:C,className:"px-4 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition flex items-center gap-2 disabled:opacity-50",children:[a.jsx(w.Z,{size:18}),C?"è™•ç†ä¸­...":Z?"æ›´æ–°ç´€éŒ„":"ç¢ºèªæ–°å¢"]})]})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:a.jsx("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-left border-collapse",children:[a.jsx("thead",{className:"bg-slate-50 text-slate-500 font-bold text-sm border-b",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"p-4",children:"å“¡å·¥å§“å"}),a.jsx("th",{className:"p-4",children:"æ—¥æœŸ"}),a.jsx("th",{className:"p-4",children:"ç­åˆ¥"}),a.jsx("th",{className:"p-4",children:"ä¸Šç­æ™‚é–“"}),a.jsx("th",{className:"p-4",children:"ä¸‹ç­æ™‚é–“"}),a.jsx("th",{className:"p-4 text-right",children:"å·¥æ™‚ (hr)"}),a.jsx("th",{className:"p-4",children:"ç‹€æ…‹"}),a.jsx("th",{className:"p-4 text-center",children:"å‚™è¨»"}),a.jsx("th",{className:"p-4 text-center",children:"æ“ä½œ"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-100 text-sm",children:d?a.jsx("tr",{children:a.jsx("td",{colSpan:9,className:"p-8 text-center text-slate-400",children:"è¼‰å…¥ä¸­..."})}):0===t.length?a.jsx("tr",{children:a.jsx("td",{colSpan:9,className:"p-8 text-center text-slate-400",children:"ç„¡ç¬¦åˆè³‡æ–™"})}):t.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-slate-50 transition group",children:[(0,a.jsxs)("td",{className:"p-4 font-bold text-slate-700 flex items-center gap-2",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-slate-500 text-xs",children:e.staff_name?.slice(0,1)}),(0,a.jsxs)("div",{children:[a.jsx("div",{children:e.staff_name}),a.jsx("div",{className:"text-[10px] text-slate-400 font-normal",children:r.find(t=>t.name===e.staff_name)?.role})]})]}),a.jsx("td",{className:"p-4 text-slate-500 font-mono",children:e.clock_in_time?.slice(0,10)}),a.jsx("td",{className:"p-4",children:(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[a.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${"overtime"===e.work_type?"bg-orange-100 text-orange-700":"bg-blue-100 text-blue-700"}`,children:"overtime"===e.work_type?"åŠ ç­":"æ­£å¸¸ç­"}),e.is_overtime&&a.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold ${"approved"===e.overtime_status?"bg-green-100 text-green-700":"rejected"===e.overtime_status?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:"approved"===e.overtime_status?"å·²æ ¸å‡†":"rejected"===e.overtime_status?"å·²é§å›":"å¾…å¯©æ ¸"})]})}),a.jsx("td",{className:"p-4 font-mono text-slate-700 font-bold",children:e.clock_in_time?new Date(e.clock_in_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"-"}),a.jsx("td",{className:"p-4 font-mono text-slate-700 font-bold",children:e.clock_out_time?new Date(e.clock_out_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"-"}),a.jsx("td",{className:"p-4 text-right font-bold font-mono text-blue-600",children:e.work_hours?Number(e.work_hours).toFixed(1):"-"}),a.jsx("td",{className:"p-4",children:e.clock_out_time?(0,a.jsxs)("span",{className:"text-green-600 flex items-center gap-1 text-xs",children:[a.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"})," å®Œæˆ"]}):(0,a.jsxs)("span",{className:"text-red-500 flex items-center gap-1 text-xs animate-pulse",children:[a.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"})," å·¥ä½œä¸­"]})}),a.jsx("td",{className:"p-4 text-center text-xs text-slate-500 max-w-[150px] truncate",children:e.note||e.anomaly_reason||"-"}),(0,a.jsxs)("td",{className:"p-4 text-center flex items-center justify-center gap-2",children:[e.is_overtime&&"pending"===e.overtime_status&&(0,a.jsxs)(a.Fragment,{children:[a.jsx("button",{onClick:()=>H(e.id,"approved"),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition",title:"æ ¸å‡†åŠ ç­",children:a.jsx(i.Z,{size:16})}),a.jsx("button",{onClick:()=>H(e.id,"rejected"),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition",title:"é§å›åŠ ç­",children:a.jsx(_.Z,{size:16})})]}),a.jsx("button",{onClick:()=>L(e),className:"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition",title:"ä¿®æ”¹",children:a.jsx(ee.Z,{size:16})}),a.jsx("button",{onClick:()=>J(e.id),className:"p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition",title:"åˆªé™¤",children:a.jsx(T.Z,{size:16})})]})]},e.id))})]})})})]})}var el=s(21861),er=s(68178),en=s(20644),ei=s(52156),ed=s(57359),eo=s(62015),ec=s(89320),ex=s(59680),em=s(85048),eh=s(65599),ep=s(17106);function eu(){let[e,t]=(0,l.useState)("calculator"),[s,r]=(0,l.useState)((0,eo.ZP)(new Date,"yyyy-MM")),[n,i]=(0,l.useState)([]),[d,c]=(0,l.useState)([]),[x,h]=(0,l.useState)({}),[p,u]=(0,l.useState)(!1),[b,f]=(0,l.useState)(null),[g,j]=(0,l.useState)(null),[v,_]=(0,l.useState)([]);(0,l.useEffect)(()=>{k(),S()},[]),(0,l.useEffect)(()=>{s&&(C(),$(),"calculator"===e?z():F())},[s,e]),(0,l.useEffect)(()=>{"calculator"===e&&n.length>0&&s&&z()},[n,x]);let k=async()=>{try{let e=await fetch("/api/settings?key=org_entities"),t=await e.json();t.data&&t.data.length>0&&t.data[0]?.value&&_(JSON.parse(t.data[0].value))}catch(e){console.error("Error fetching system settings:",e)}},S=async()=>{try{let e=await fetch("/api/staff"),t=await e.json();if(t.data&&(t.data=t.data.filter(e=>"é†«å¸«"!==e.role)),t.data){let e=t.data.map(e=>({...e,entity:e.entity||"clinic",salary_mode:e.salary_mode||"hourly",base_salary:e.base_salary||183,work_rule:e.work_rule||"normal",clock_in_calc_mode:e.clock_in_calc_mode||"actual",bonuses:Array.isArray(e.bonuses)?e.bonuses:[],default_deductions:Array.isArray(e.default_deductions)?e.default_deductions:[],insurance_labor:e.insurance_labor||0,insurance_health:e.insurance_health||0}));i(e)}}catch(e){console.error("Error fetching staff settings:",e)}},C=async()=>{try{let e=await fetch(`/api/salary/adjustments?year_month=${s}`),t=await e.json(),a={};t.data?.forEach(e=>{a[e.staff_id]||(a[e.staff_id]=[]),a[e.staff_id].push(e)}),h(a)}catch(e){console.error("Error fetching adjustments:",e)}},$=async()=>{try{let e=await fetch(`/api/salary/history?year_month=${s}`),t=await e.json();u(!!t.data&&t.data.length>0)}catch(e){console.error("Error checking archive status:",e)}},z=async()=>{if(s)try{let e=await fetch(`/api/salary/calculate?month=${s}`),t=await e.json();if(t.error){console.error("Error fetching calculation data:",t.error);return}let{logs:a,roster:l,holidays:r,leaves:i,monthlyStandardHours:d}=t,o=new Set((r||[]).map(e=>String(e.date))),m={};l?.forEach(e=>{m[`${e.staff_id}_${e.date}`]={day_type:e.day_type,shift_details:e.shift_details}});let h=[];n.forEach(e=>{let t=a?.filter(t=>t.staff_name===e.name)||[],s=i?.filter(t=>t.staff_id===e.id)||[],l=(0,ep.H)(e,t,m,o,d,s),r=e.bonuses.reduce((e,t)=>e+Number(t.amount),0),n=e.default_deductions.reduce((e,t)=>e+Number(t.amount),0),c=x[e.id]||[],p=c.filter(e=>"bonus"===e.type).reduce((e,t)=>e+Number(t.amount),0),u=c.filter(e=>"deduction"===e.type).reduce((e,t)=>e+Number(t.amount),0),b=l.base_pay+l.ot_pay+l.holiday_pay+r+p+l.leave_addition,f=e.insurance_labor+e.insurance_health+n+u+l.leave_deduction;h.push({...l,staff_entity:e.entity,staff_name:e.name,salary_mode:e.salary_mode,work_rule:e.work_rule,fixed_bonus_pay:r,temp_bonus_pay:p,insurance_labor:e.insurance_labor,insurance_health:e.insurance_health,fixed_deduction_pay:n,temp_deduction_pay:u,gross_pay:b,total_deduction:f,net_pay:b-f,bonus_details:[...e.bonuses,...c.filter(e=>"bonus"===e.type)],deduction_details:[...e.default_deductions,...c.filter(e=>"deduction"===e.type)]})}),c(h)}catch(e){console.error("Error performing calculation:",e)}},Z=async(e,t,a,l,r,n)=>{let i=x[e]||[],d=[...i];"add"===a?d.push({id:-1,staff_id:e,year_month:s,type:t,name:"bonus"===t?"æœ¬æœˆçé‡‘":"æœ¬æœˆæ‰£æ¬¾",amount:0}):"update"===a&&l?d=d.map(e=>e.id===l?{...e,[r]:n}:e):"remove"===a&&l&&(d=d.filter(e=>e.id!==l)),h(t=>({...t,[e]:d}));try{if("add"===a){let a=await fetch("/api/salary/adjustments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({staff_id:e,year_month:s,type:t,name:"bonus"===t?"æœ¬æœˆçé‡‘":"æœ¬æœˆæ‰£æ¬¾",amount:0})});a.ok&&C()}else"update"===a&&l?await fetch("/api/salary/adjustments",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:l,field:r,value:n})}):"remove"===a&&l&&await fetch(`/api/salary/adjustments?id=${l}`,{method:"DELETE"})}catch(e){console.error("Error modifying adjustment:",e),alert("æ“ä½œå¤±æ•—: "+e.message)}},T=async(e,t,s)=>{let a=n.map(a=>a.id===e?{...a,[t]:s}:a);i(a);try{await fetch("/api/staff",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,[t]:s})})}catch(e){console.error("Error updating staff:",e),alert("æ›´æ–°å¤±æ•—: "+e.message)}},D=async()=>{if(confirm(`ç¢ºå®šè¦å°å­˜ ${s} çš„è–ªè³‡è³‡æ–™å—ï¼Ÿ`))try{let e=d.map(e=>({year_month:s,staff_id:n.find(t=>t.name===e.staff_name)?.id,staff_name:e.staff_name,snapshot:e})),t=await fetch("/api/salary/history",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({records:e})}),a=await t.json();a.error?alert("å°å­˜å¤±æ•—: "+a.error):(alert("å°å­˜æˆåŠŸï¼"),u(!0))}catch(e){alert("å°å­˜å¤±æ•—: "+e.message)}},E=async()=>{if(confirm(`âš ï¸ è­¦å‘Šï¼šè§£é™¤å°å­˜å°‡åˆªé™¤ ${s} çš„æ­·å²ç´€éŒ„ã€‚

ç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ`))try{let e=await fetch(`/api/salary/history?year_month=${s}`,{method:"DELETE"}),a=await e.json();a.error?alert("è§£é™¤å¤±æ•—: "+a.error):(alert("å·²è§£é™¤å°å­˜ã€‚"),u(!1),t("calculator"),C())}catch(e){alert("è§£é™¤å¤±æ•—: "+e.message)}},F=async()=>{try{let e=await fetch(`/api/salary/history?year_month=${s}`),t=await e.json();t.data&&t.data.length>0?(c(t.data.map(e=>({...e.snapshot,is_archived:!0,history_id:e.id}))),u(!0)):(c([]),u(!1))}catch(e){console.error("Error loading history:",e)}},M=e=>{let t=new Date(`${s}-01`),a=e>0?(0,ed.Z)(t,1):(0,ec.Z)(t,1);r((0,eo.ZP)(a,"yyyy-MM"))};return(0,a.jsxs)("div",{className:"w-full animate-fade-in relative space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-center bg-white p-5 rounded-2xl shadow-sm border border-slate-200 gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold flex items-center gap-2 text-slate-800",children:[a.jsx(m.Z,{className:"text-green-600",size:28}),"calculator"===e?"è–ªè³‡çµç®—ç³»çµ±":"æ­·å²è–ªè³‡æŸ¥è©¢"]}),(0,a.jsxs)("div",{className:"flex bg-slate-100 p-1.5 rounded-xl",children:[a.jsx("button",{onClick:()=>t("calculator"),className:`px-4 py-1.5 text-sm font-bold rounded-lg transition ${"calculator"===e?"bg-white shadow text-blue-600":"text-slate-500 hover:text-slate-700"}`,children:"æœ¬æœˆè©¦ç®—"}),a.jsx("button",{onClick:()=>t("history"),className:`px-4 py-1.5 text-sm font-bold rounded-lg transition ${"history"===e?"bg-white shadow text-purple-600":"text-slate-500 hover:text-slate-700"}`,children:"æ­·å²ç´€éŒ„"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:["calculator"===e&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-slate-400 mr-2 animate-pulse",children:[a.jsx(el.Z,{size:12})," è‡ªå‹•å­˜æª”ä¸­"]}),(0,a.jsxs)("div",{className:"flex items-center bg-slate-50 rounded-xl border border-slate-200 p-1",children:[a.jsx("button",{onClick:()=>M(-1),className:"p-2 hover:bg-white hover:shadow-sm rounded-lg text-slate-500",children:a.jsx(N.Z,{size:16})}),(0,a.jsxs)("div",{className:"flex items-center gap-2 px-2",children:[a.jsx(o.Z,{size:16,className:"text-slate-400"}),a.jsx("input",{type:"month",value:s,onChange:e=>r(e.target.value),className:"bg-transparent font-bold text-slate-700 outline-none w-32 text-center"})]}),a.jsx("button",{onClick:()=>M(1),className:"p-2 hover:bg-white hover:shadow-sm rounded-lg text-slate-500",children:a.jsx(y.Z,{size:16})})]}),"calculator"===e&&!p&&(0,a.jsxs)("button",{onClick:D,className:"flex items-center gap-2 bg-slate-800 text-white px-5 py-2.5 rounded-xl font-bold hover:bg-black transition shadow-lg hover:shadow-xl active:scale-95",children:[a.jsx(w.Z,{size:18})," çµç®—ä¸¦å°å­˜"]}),p&&(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-green-50 text-green-700 px-4 py-2 rounded-xl font-bold border border-green-200",children:[a.jsx(er.Z,{size:16})," ","calculator"===e?"æœ¬æœˆå·²å°å­˜":"å·²èª¿é–±å°å­˜æª”"]}),"history"===e&&(0,a.jsxs)("button",{onClick:E,className:"flex items-center gap-2 bg-red-50 text-red-600 px-4 py-2 rounded-xl font-bold hover:bg-red-100 transition border border-red-100",children:[a.jsx(en.Z,{size:16})," è§£é™¤å°å­˜"]})]})]})]}),a.jsx(ex.Z,{reports:d,isArchived:"history"===e||p,adjustments:x,modifyAdjustment:Z,staffList:n,onOpenSettings:e=>f(e),onPrint:e=>j(e)}),0===d.length&&(0,a.jsxs)("div",{className:"text-center py-20 text-slate-400 bg-white rounded-2xl border border-dashed border-slate-300",children:[a.jsx(ei.Z,{size:48,className:"mx-auto mb-4 opacity-20"}),a.jsx("p",{children:"æ­¤æœˆä»½å°šç„¡è³‡æ–™æˆ–å°šæœªçµç®—"})]}),null!==b&&a.jsx(em.Z,{staff:n.find(e=>e.id===b),updateStaff:T,entityList:v,onClose:()=>f(null)}),g&&a.jsx(eh.Z,{report:g,yearMonth:s,clinicName:v.find(e=>e.id===g.staff_entity)?.name||"è¨ºæ‰€",onClose:()=>j(null)})]})}var eb=s(93804),ef=s(28626),eg=s(43250),ej=s(55131),eN=s(52778);let ey=[{name:"é†«å¸«",in_roster:!1},{name:"è­·ç†å¸«",in_roster:!0},{name:"è¡Œæ”¿",in_roster:!0},{name:"è—¥å¸«",in_roster:!0},{name:"æ¸…æ½”",in_roster:!1}],ev=[{id:"clinic",name:"è¨ºæ‰€"},{id:"pharmacy",name:"è—¥å±€"}];function e_({isOpen:e,onClose:t,initialData:s,onSave:r}){let[n,i]=(0,l.useState)(null),[d,o]=(0,l.useState)(ey),[c,x]=(0,l.useState)([]);(0,l.useEffect)(()=>{if(e){let e=async()=>{try{let e=await fetch("/api/settings"),t=await e.json(),a=ey,l=[];if(t.data){let e=t.data.find(e=>"job_titles"===e.key);if(e)try{let t=JSON.parse(e.value);Array.isArray(t)&&t.length>0?"string"==typeof t[0]?a=t.map(e=>({name:e,in_roster:"é†«å¸«"!==e})):(a=t.map(e=>({name:e.name??"",in_roster:"boolean"==typeof e.in_roster?e.in_roster:"é†«å¸«"!==e.name})).filter(e=>e.name),0===a.length&&(a=ey)):a=ey}catch(e){console.error("Parse job_titles error:",e),a=ey}else a=ey;let s=t.data.find(e=>"org_entities"===e.key);if(s)try{let e=JSON.parse(s.value);Array.isArray(e)&&e.length>0&&(l=e.map(e=>({id:e.id??"",name:e.name??""})).filter(e=>e.id&&e.name))}catch(e){console.error("Parse org_entities error:",e)}}if(l&&0!==l.length||(l=ev),o(a),x(l),s){let e=a[0]?.name||"è­·ç†å¸«",t=l[0]?.id||"clinic";i({...s,role:s.role||e,entity:s.entity||t})}else{let e=a[0]?.name||"è­·ç†å¸«",t=l[0]?.id||"clinic";i({name:"",role:e,entity:t,is_active:!0,start_date:new Date().toISOString().slice(0,10),salary_mode:"hourly",base_salary:0,insurance_labor:0,insurance_health:0,phone:"",address:"",emergency_contact:"",bank_account:"",id_number:""})}}catch(e){console.error("Fetch staff edit settings error:",e),o(ey),x(ev),s?i({...s}):i({name:"",role:ey[0].name,entity:ev[0].id,is_active:!0,start_date:new Date().toISOString().slice(0,10),salary_mode:"hourly",base_salary:0,insurance_labor:0,insurance_health:0,phone:"",address:"",emergency_contact:"",bank_account:"",id_number:""})}};e()}else i(null)},[e,s]);let m=async()=>{if(!n?.name){alert("è«‹è¼¸å…¥å§“å");return}let e={name:n.name,role:n.role,entity:n.entity,is_active:n.is_active,start_date:n.start_date||null,salary_mode:n.salary_mode||"hourly",base_salary:Number(n.base_salary)||0,insurance_labor:Number(n.insurance_labor)||0,insurance_health:Number(n.insurance_health)||0,phone:n.phone||null,address:n.address||null,emergency_contact:n.emergency_contact||null,bank_account:n.bank_account||null,id_number:n.id_number||null};try{let s;s=n.id?await fetch("/api/staff",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:n.id,...e})}):await fetch("/api/staff",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});let a=await s.json();a.success?(alert("å„²å­˜æˆåŠŸï¼"),r(),t()):alert("å„²å­˜å¤±æ•—: "+a.message)}catch(e){console.error("Save staff error:",e),alert("å„²å­˜å¤±æ•—")}};return e&&n?a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-hidden animate-in fade-in zoom-in duration-200",children:[(0,a.jsxs)("div",{className:"bg-slate-900 text-white p-4 flex justify-between items-center",children:[(0,a.jsxs)("h3",{className:"font-bold text-lg flex items-center gap-2",children:[n.id?a.jsx(f.Z,{size:18}):a.jsx(z.Z,{size:18}),n.id?"ç·¨è¼¯äººå“¡è³‡æ–™":"æ–°å¢äººå“¡"]}),a.jsx("button",{onClick:t,className:"hover:bg-white/20 p-1 rounded-full",children:a.jsx(f.Z,{size:18,className:"rotate-45"})})]}),(0,a.jsxs)("div",{className:"p-6 space-y-4 max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"col-span-1",children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"å§“å"}),a.jsx("input",{type:"text",value:n.name,onChange:e=>i({...n,name:e.target.value}),className:"w-full border p-2 rounded focus:ring-2 ring-blue-200 outline-none",placeholder:"çœŸå¯¦å§“å"})]}),(0,a.jsxs)("div",{className:"col-span-1",children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"è·ç¨±"}),a.jsx("select",{value:n.role,onChange:e=>i({...n,role:e.target.value}),className:"w-full border p-2 rounded bg-white",children:d.map(e=>a.jsx("option",{value:e.name,children:e.name},e.name))})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"æ‰€å±¬å–®ä½"}),0===c.length?a.jsx("div",{className:"text-xs text-slate-400 bg-slate-50 border border-dashed border-slate-200 rounded p-2",children:"å°šæœªè¨­å®šçµ„ç¹”å–®ä½ï¼Œè«‹å…ˆè‡³ã€Œç³»çµ±è¨­å®š > çµ„ç¹”å–®ä½ç®¡ç†ã€æ–°å¢å–®ä½ã€‚"}):a.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(e=>a.jsx("button",{onClick:()=>i({...n,entity:e.id}),className:`px-3 py-2 rounded border text-xs md:text-sm font-bold transition ${n.entity===e.id?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-slate-300 text-slate-600 hover:bg-slate-50"}`,children:e.name},e.id))})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"åˆ°è·æ—¥æœŸ"}),a.jsx("input",{type:"date",value:n.start_date||"",onChange:e=>i({...n,start_date:e.target.value}),className:"w-full border p-2 rounded"})]})]}),(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-100",children:[(0,a.jsxs)("h4",{className:"text-xs font-bold text-slate-700 mb-3 flex items-center gap-2",children:[a.jsx(K.Z,{size:14}),"åŸºæœ¬å€‹è³‡"]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"é›»è©±"}),a.jsx("input",{type:"text",value:n.phone||"",onChange:e=>i({...n,phone:e.target.value}),className:"w-full border p-2 rounded bg-white",placeholder:"ä¾‹ï¼š0912-345-678"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"èº«åˆ†è­‰å­—è™Ÿ"}),a.jsx("input",{type:"text",value:n.id_number||"",onChange:e=>i({...n,id_number:e.target.value}),className:"w-full border p-2 rounded bg-white",placeholder:"ä¾‹ï¼šA123456789",maxLength:10})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"åœ°å€"}),a.jsx("input",{type:"text",value:n.address||"",onChange:e=>i({...n,address:e.target.value}),className:"w-full border p-2 rounded bg-white",placeholder:"ä¾‹ï¼šå°åŒ—å¸‚ä¿¡ç¾©å€..."})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"ç·Šæ€¥è¯çµ¡äºº"}),a.jsx("input",{type:"text",value:n.emergency_contact||"",onChange:e=>i({...n,emergency_contact:e.target.value}),className:"w-full border p-2 rounded bg-white",placeholder:"å§“å + é›»è©±"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"éŠ€è¡Œå¸³è™Ÿ"}),a.jsx("input",{type:"text",value:n.bank_account||"",onChange:e=>i({...n,bank_account:e.target.value}),className:"w-full border p-2 rounded bg-white",placeholder:"ä¾‹ï¼š123-456-7890123"})]})]})]}),"é†«å¸«"!==n.role&&(0,a.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-100 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-xs font-bold text-yellow-800 mb-2 flex items-center gap-1",children:[a.jsx(Q.Z,{size:12})," è–ªè³‡è¨ˆç®—æ¨¡å¼"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>i({...n,salary_mode:"monthly"}),className:`flex-1 py-2 rounded border text-sm font-bold transition ${"monthly"===n.salary_mode?"bg-slate-800 text-white border-slate-800":"bg-white text-slate-500 border-slate-300 hover:bg-slate-50"}`,children:"æœˆè–ªåˆ¶"}),a.jsx("button",{onClick:()=>i({...n,salary_mode:"hourly"}),className:`flex-1 py-2 rounded border text-sm font-bold transition ${"hourly"===n.salary_mode?"bg-slate-800 text-white border-slate-800":"bg-white text-slate-500 border-slate-300 hover:bg-slate-50"}`,children:"æ™‚è–ªåˆ¶"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-xs font-bold text-yellow-800 mb-1",children:["åŸºç¤è–ªè³‡ ","monthly"===n.salary_mode?"(æœˆè–ª)":"(æ™‚è–ª)"]}),a.jsx("input",{type:"number",value:n.base_salary,onChange:e=>i({...n,base_salary:e.target.value}),className:"w-full border p-2 rounded font-mono font-bold text-right"}),(0,a.jsxs)("p",{className:"text-[10px] text-yellow-600 mt-1",children:["* ","monthly"===n.salary_mode?"æœˆè–ªåˆ¶ï¼šç”¨æ–¼è¨ˆç®—æ¯æ—¥è–ªè³‡ (æœˆè–ª \xf7 30)":"æ™‚è–ªåˆ¶ï¼šç”¨æ–¼è¨ˆç®—å·¥æ™‚è–ªè³‡"]})]})]}),(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200",children:[a.jsx("h4",{className:"text-xs font-bold text-slate-500 mb-3 border-b pb-1",children:"ä¿éšªè¨­å®š (æ¯æœˆå›ºå®šæ‰£é™¤)"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"å‹ä¿è‡ªä»˜é¡"}),a.jsx("input",{type:"number",value:n.insurance_labor,onChange:e=>i({...n,insurance_labor:e.target.value}),className:"w-full border p-2 rounded text-right text-red-500 font-bold"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"å¥ä¿è‡ªä»˜é¡"}),a.jsx("input",{type:"number",value:n.insurance_health,onChange:e=>i({...n,insurance_health:e.target.value}),className:"w-full border p-2 rounded text-right text-red-500 font-bold"})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[a.jsx("button",{onClick:t,className:"px-5 py-2.5 rounded-lg text-slate-500 hover:bg-slate-100 font-bold text-sm",children:"å–æ¶ˆ"}),(0,a.jsxs)("button",{onClick:m,className:"px-6 py-2.5 rounded-lg bg-slate-900 text-white hover:bg-black font-bold text-sm shadow-lg flex items-center gap-2",children:[a.jsx(w.Z,{size:16})," å„²å­˜è³‡æ–™"]})]})]})]})}):null}function ew(){let[e,t]=(0,l.useState)([]),[s,r]=(0,l.useState)(!1),[n,i]=(0,l.useState)(!1),[d,o]=(0,l.useState)(!1),[x,m]=(0,l.useState)(null);(0,l.useEffect)(()=>{h()},[]);let h=async()=>{r(!0);try{let e=await fetch("/api/staff"),s=await e.json();s.data&&t(s.data||[])}catch(e){console.error("Fetch staff error:",e)}finally{r(!1)}},p=e=>{m(e),o(!0)},u=async e=>{let t=!e.is_active;if(confirm(`ç¢ºå®šè¦å°‡ ${e.name} è¨­å®šç‚ºã€Œ${t?"å¾©è·":"é›¢è·"}ã€å—ï¼Ÿ`))try{let s=await fetch("/api/staff",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id,is_active:t})}),a=await s.json();a.success?h():alert("æ›´æ–°å¤±æ•—: "+a.message)}catch(e){console.error("Toggle staff status error:",e),alert("æ›´æ–°å¤±æ•—")}},b=e.filter(e=>!!n||e.is_active);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden animate-fade-in",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50",children:[a.jsx("div",{className:"flex items-center gap-4",children:(0,a.jsxs)("button",{onClick:()=>i(!n),className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-bold transition border ${n?"bg-gray-200 text-gray-700 border-gray-300":"bg-white text-slate-400 border-dashed border-slate-300 hover:border-slate-400"}`,children:[n?a.jsx(ef.Z,{size:14}):a.jsx(eg.Z,{size:14}),n?"éš±è—é›¢è·äººå“¡":"é¡¯ç¤ºé›¢è·äººå“¡"]})}),(0,a.jsxs)("button",{onClick:()=>{m(null),o(!0)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2 text-sm transition shadow-sm",children:[a.jsx(z.Z,{size:16})," æ–°å¢äººå“¡"]})]}),a.jsx("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-left text-sm",children:[a.jsx("thead",{className:"bg-slate-50 text-slate-600 font-bold border-b border-slate-200",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"p-4 w-20 text-center",children:"ç‹€æ…‹"}),a.jsx("th",{className:"p-4",children:"å§“å"}),a.jsx("th",{className:"p-4",children:"è·ç¨±"}),a.jsx("th",{className:"p-4",children:"åˆ°è·æ—¥"}),a.jsx("th",{className:"p-4 text-right",children:"åŸºæœ¬è–ªè³‡/æ™‚è–ª"}),a.jsx("th",{className:"p-4 text-right",children:"å‹å¥ä¿è‡ªä»˜é¡"}),a.jsx("th",{className:"p-4 text-center",children:"æ“ä½œ"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-100",children:s?a.jsx("tr",{children:a.jsx("td",{colSpan:7,className:"p-8 text-center text-slate-400",children:"è¼‰å…¥ä¸­..."})}):b.map(e=>(0,a.jsxs)("tr",{className:`hover:bg-slate-50 transition ${e.is_active?"":"bg-gray-100/80 grayscale opacity-70"}`,children:[a.jsx("td",{className:"p-4 text-center",children:e.is_active?a.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-bold bg-green-100 text-green-700",children:"åœ¨è·"}):a.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-bold bg-gray-200 text-gray-500",children:"é›¢è·"})}),(0,a.jsxs)("td",{className:"p-4 font-bold text-slate-800 flex items-center gap-2",children:["é†«å¸«"===e.role?a.jsx(c.Z,{size:16,className:"text-teal-600"}):a.jsx(K.Z,{size:16,className:"text-blue-400"}),e.name]}),a.jsx("td",{className:"p-4 text-slate-600",children:e.role}),a.jsx("td",{className:"p-4 font-mono text-slate-500",children:e.start_date||"-"}),a.jsx("td",{className:"p-4 text-right font-mono",children:"é†«å¸«"===e.role?"-":`$${e.base_salary?.toLocaleString()}`}),(0,a.jsxs)("td",{className:"p-4 text-right font-mono text-xs text-slate-500",children:["å‹ $",e.insurance_labor," / å¥ $",e.insurance_health]}),(0,a.jsxs)("td",{className:"p-4 flex justify-center gap-2",children:[a.jsx("button",{onClick:()=>p(e),className:"px-3 py-1.5 border border-blue-200 text-blue-600 rounded hover:bg-blue-50 text-xs font-bold transition",children:"ç·¨è¼¯"}),a.jsx("button",{onClick:()=>u(e),className:`px-3 py-1.5 border rounded text-xs font-bold transition flex items-center gap-1 ${e.is_active?"border-gray-200 text-gray-400 hover:bg-gray-100 hover:text-gray-600":"border-green-200 text-green-600 hover:bg-green-50"}`,children:e.is_active?(0,a.jsxs)(a.Fragment,{children:[a.jsx(eN.Z,{size:12})," é›¢è·"]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(ej.Z,{size:12})," å¾©è·"]})})]})]},e.id))})]})})]}),a.jsx(e_,{isOpen:d,onClose:()=>{o(!1),m(null)},initialData:x,onSave:()=>{h()}})]})}var ek=s(9),eS=s(83728);let eC=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],e$=[{name:"é†«å¸«",in_roster:!1},{name:"è­·ç†å¸«",in_roster:!0},{name:"è¡Œæ”¿",in_roster:!0},{name:"è—¥å¸«",in_roster:!0},{name:"æ¸…æ½”",in_roster:!1}];function ez(){let[e,t]=(0,l.useState)([]),[s,r]=(0,l.useState)([]),[n,i]=(0,l.useState)([]),[d,o]=(0,l.useState)({openDays:[1,2,3,4,5,6],shifts:{AM:{start:"08:00",end:"12:30"},PM:{start:"14:00",end:"17:30"},NIGHT:{start:"18:00",end:"21:30"}}}),[x,m]=(0,l.useState)("anniversary"),[h,p]=(0,l.useState)(!1),[u,b]=(0,l.useState)(""),[f,g]=(0,l.useState)(9),[j,N]=(0,l.useState)(!0);(0,l.useEffect)(()=>{y()},[]);let y=async()=>{try{let e=await fetch("/api/settings"),s=await e.json();if(s.data){s.data.forEach(e=>{if("org_entities"===e.key)try{t(JSON.parse(e.value))}catch(e){}if("job_titles"===e.key)try{let t=JSON.parse(e.value);if(Array.isArray(t)&&t.length>0){if("string"==typeof t[0]){let e=t.map(e=>({name:e,in_roster:"é†«å¸«"!==e}));r(e)}else{let e=t.map(e=>({name:e.name??"",in_roster:"boolean"==typeof e.in_roster?e.in_roster:"é†«å¸«"!==e.name})).filter(e=>e.name);r(e.length>0?e:e$)}}else r(e$)}catch(e){r(e$)}if("special_clinic_types"===e.key)try{i(JSON.parse(e.value))}catch(e){}if("clinic_business_hours"===e.key)try{o(JSON.parse(e.value))}catch(e){}"leave_calculation_system"===e.key&&m("calendar"===e.value?"calendar":"anniversary")});let e=s.data.some(e=>"job_titles"===e.key);e||r(e$)}else r(e$);let a=await fetch("/api/settings?type=clinic"),l=await a.json();l.data&&(g(l.data.overtime_threshold??9),N(!1!==l.data.overtime_approval_required))}catch(e){console.error("Fetch system settings error:",e)}},_=async()=>{p(!0);try{let t=[{key:"org_entities",value:JSON.stringify(e)},{key:"job_titles",value:JSON.stringify(s.length>0?s:e$)},{key:"special_clinic_types",value:JSON.stringify(n)},{key:"clinic_business_hours",value:JSON.stringify(d)},{key:"leave_calculation_system",value:x}],a=await fetch("/api/settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),l=await a.json(),r=await fetch("/api/settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"clinic",settings:{overtime_threshold:f,overtime_approval_required:j}})}),i=await r.json();l.success&&i.success?(b("âœ… è¨­å®šå·²æ›´æ–°ï¼Œæ’ç­è¡¨å°‡å¥—ç”¨æ–°æ™‚é–“"),setTimeout(()=>b(""),3e3)):b("âŒ å„²å­˜å¤±æ•—: "+(l.message||i.message))}catch(e){console.error("Save system settings error:",e),b("âŒ å„²å­˜å¤±æ•—")}finally{p(!1)}},k=s=>{if(e.length<=1)return alert("è‡³å°‘ä¿ç•™ä¸€å€‹å–®ä½");let a=[...e];a.splice(s,1),t(a)},S=(s,a)=>{let l=[...e];l[s].name=a,t(l)},C=e=>{if(s.length<=1)return alert("è‡³å°‘ä¿ç•™ä¸€å€‹è·ç¨±");let t=[...s];t.splice(e,1),r(t)},$=(e,t)=>{let a=[...s];a[e]={...a[e],name:t},r(a)},Z=(e,t)=>{let a=[...s];a[e]={...a[e],in_roster:t},r(a)},D=e=>{let t=[...n];t.splice(e,1),i(t)},E=(e,t)=>{let s=[...n];s[e]=t,i(s)},F=e=>{let t=d.openDays.includes(e)?d.openDays.filter(t=>t!==e):[...d.openDays,e].sort();o({...d,openDays:t})},M=(e,t,s)=>{o({...d,shifts:{...d.shifts,[e]:{...d.shifts[e],[t]:s}}})};return(0,a.jsxs)("div",{className:"bg-white p-8 rounded-2xl shadow-sm border border-slate-200 animate-fade-in",children:[(0,a.jsxs)("div",{className:"space-y-10",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-bold text-slate-700 border-b pb-2 mb-4 flex items-center gap-2",children:[a.jsx(ek.Z,{size:20})," çµ„ç¹”å–®ä½ç®¡ç†"]}),(0,a.jsxs)("div",{className:"space-y-3",children:[e.map((e,t)=>(0,a.jsxs)("div",{className:"flex gap-3 items-center",children:[(0,a.jsxs)("div",{className:"bg-slate-100 px-3 py-2 rounded text-xs font-mono text-slate-400 w-24 text-center",children:["ID: ",e.id]}),a.jsx("input",{type:"text",value:e.name,onChange:e=>S(t,e.target.value),className:"flex-1 p-3 border rounded-lg text-lg font-bold outline-none focus:ring-2 focus:ring-blue-200",placeholder:"å–®ä½åç¨±"}),a.jsx("button",{onClick:()=>k(t),className:"p-3 text-red-400 hover:bg-red-50 rounded-lg",children:a.jsx(T.Z,{size:20})})]},e.id)),(0,a.jsxs)("button",{onClick:()=>t([...e,{id:"unit_"+Date.now(),name:""}]),className:"w-full py-3 border-2 border-dashed border-slate-300 text-slate-500 rounded-xl hover:bg-blue-50 font-bold flex items-center justify-center gap-2",children:[a.jsx(z.Z,{size:20})," æ–°å¢å–®ä½"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-bold text-slate-700 border-b pb-2 mb-4 flex items-center gap-2",children:[a.jsx(K.Z,{size:20})," äººå“¡è·é¡è¨­å®š (Job Titles)"]}),(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-100 mb-4 space-y-1",children:[a.jsx("p",{className:"text-sm text-blue-800",children:"è¨­å®šç³»çµ±ä¸­å¯ç”¨çš„è·ç¨±é¸é …ã€‚é€™äº›è·ç¨±å°‡å‡ºç¾åœ¨å“¡å·¥è³‡æ–™ç·¨è¼¯è¡¨å–®çš„ä¸‹æ‹‰é¸å–®ä¸­ã€‚"}),a.jsx("p",{className:"text-xs text-blue-700",children:"å‹¾é¸ã€ŒåŠ å…¥æ’ç­è¡¨ã€çš„è·ç¨±ï¼Œæœƒå‡ºç¾åœ¨å“¡å·¥æ’ç­ç•«é¢ä¸­ï¼›ä¾‹å¦‚ã€Œé†«å¸«ã€é€šå¸¸ä½¿ç”¨ç¨ç«‹é†«å¸«ç­è¡¨ï¼Œå› æ­¤é è¨­ä¸åŠ å…¥ä¸€èˆ¬å“¡å·¥æ’ç­ã€‚"})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[s.map((e,t)=>(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center gap-3 bg-slate-50 p-3 rounded-lg border border-slate-200",children:[(0,a.jsxs)("div",{className:"flex-1 flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-xs text-slate-400 px-2 py-1 bg-white rounded border",children:["#",t+1]}),a.jsx("input",{type:"text",value:e.name,onChange:e=>$(t,e.target.value),className:"flex-1 p-2 border rounded-lg font-bold outline-none focus:ring-2 focus:ring-blue-200",placeholder:"è·ç¨±åç¨±ï¼Œä¾‹å¦‚ï¼šè­·ç†å¸«"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("input",{id:`job-title-roster-${t}`,type:"checkbox",checked:e.in_roster,onChange:e=>Z(t,e.target.checked),className:"w-4 h-4"}),a.jsx("label",{htmlFor:`job-title-roster-${t}`,className:"text-xs md:text-sm text-slate-700 select-none",children:"åŠ å…¥æ’ç­è¡¨"}),a.jsx("button",{onClick:()=>C(t),className:"ml-2 p-2 text-red-400 hover:bg-red-50 rounded-lg",children:a.jsx(T.Z,{size:18})})]})]},t)),(0,a.jsxs)("button",{onClick:()=>r([...s,{name:"æ–°è·ç¨±",in_roster:!0}]),className:"w-full py-2 border-2 border-dashed border-slate-300 text-slate-500 rounded-xl hover:bg-blue-50 font-bold flex items-center justify-center gap-2",children:[a.jsx(z.Z,{size:18})," æ–°å¢è·ç¨±"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-bold text-slate-700 border-b pb-2 mb-4 flex items-center gap-2",children:[a.jsx(v.Z,{size:20})," è¨ºæ‰€ç‡Ÿæ¥­æ™‚é–“è¨­å®š (å…¨åŸŸé è¨­å€¼)"]}),a.jsx("div",{className:"bg-yellow-50 p-4 mb-4 rounded-lg text-sm text-yellow-800 border border-yellow-200",children:"âš ï¸ æ³¨æ„ï¼šä¿®æ”¹æ­¤è™•åƒ…æœƒå½±éŸ¿ã€Œæœªä¾†ã€æ’å…¥çš„ç­è¡¨ã€‚å·²ç¶“æ’å¥½çš„ç­è¡¨ä¸æœƒè‡ªå‹•æ›´æ–°æ™‚é–“ï¼Œä»¥ä¿éšœæ­·å²å·¥æ™‚è¨ˆç®—çš„æ­£ç¢ºæ€§ã€‚"}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-bold text-slate-500 mb-2 flex items-center gap-2",children:[a.jsx(eS.Z,{size:16})," æ¯é€±ç‡Ÿæ¥­æ—¥"]}),a.jsx("div",{className:"flex gap-2",children:eC.map((e,t)=>a.jsx("button",{onClick:()=>F(t),className:`w-10 h-10 rounded-full font-bold transition ${d.openDays.includes(t)?"bg-blue-600 text-white shadow-md":"bg-slate-100 text-slate-400 hover:bg-slate-200"}`,children:e},t))})]}),a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:["AM","PM","NIGHT"].map(e=>(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200",children:[(0,a.jsxs)("h4",{className:"font-bold text-slate-700 mb-3 flex justify-between",children:["AM"===e?"æ—©è¨º":"PM"===e?"åˆè¨º":"æ™šè¨º",a.jsx("span",{className:"text-xs text-slate-400 bg-white px-2 py-0.5 rounded border",children:e})]}),(0,a.jsxs)("div",{className:"flex gap-1 items-center",children:[a.jsx("input",{type:"time",value:d.shifts[e].start,onChange:t=>M(e,"start",t.target.value),className:"w-full border p-1 rounded text-center font-mono text-sm"}),a.jsx("span",{className:"text-slate-400",children:"-"}),a.jsx("input",{type:"time",value:d.shifts[e].end,onChange:t=>M(e,"end",t.target.value),className:"w-full border p-1 rounded text-center font-mono text-sm"})]})]},e))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-bold text-slate-700 border-b pb-2 mb-4 flex items-center gap-2",children:[a.jsx(c.Z,{size:20})," ç‰¹æ®Šé–€è¨ºé¡å‹"]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[n.map((e,t)=>(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[a.jsx("input",{type:"text",value:e,onChange:e=>E(t,e.target.value),className:"flex-1 p-2 border rounded-lg font-bold outline-none focus:ring-2 focus:ring-purple-200",placeholder:"é–€è¨ºåç¨±"}),a.jsx("button",{onClick:()=>D(t),className:"p-2 text-red-400 hover:bg-red-50 rounded-lg",children:a.jsx(T.Z,{size:18})})]},t)),(0,a.jsxs)("button",{onClick:()=>i([...n,"æ–°é–€è¨º"]),className:"py-2 border-2 border-dashed border-slate-300 text-slate-500 rounded-xl hover:bg-purple-50 font-bold flex items-center justify-center gap-2",children:[a.jsx(z.Z,{size:18})," æ–°å¢é¡å‹"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-bold text-slate-700 border-b pb-2 mb-4 flex items-center gap-2",children:[a.jsx(eS.Z,{size:20})," ç‰¹ä¼‘è¨ˆç®—åˆ¶ (Annual Leave Calculation System)"]}),(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-100 mb-4",children:[(0,a.jsxs)("p",{className:"text-sm text-blue-800 mb-2",children:[a.jsx("strong",{children:"é€±å¹´åˆ¶ (Anniversary)"}),"ï¼šä»¥å“¡å·¥åˆ°è·æ—¥ç‚ºåŸºæº–ï¼Œæ¯å¹´é€±å¹´æ—¥é‡æ–°è¨ˆç®—ç‰¹ä¼‘å¤©æ•¸ã€‚"]}),(0,a.jsxs)("p",{className:"text-sm text-blue-800",children:[a.jsx("strong",{children:"æ›†å¹´åˆ¶ (Calendar)"}),"ï¼šä»¥æ—¥æ›†å¹´åº¦ç‚ºåŸºæº–ï¼Œæ¯å¹´1æœˆ1æ—¥é‡æ–°è¨ˆç®—ç‰¹ä¼‘å¤©æ•¸ï¼ŒæŒ‰æ¯”ä¾‹åˆ†é…ã€‚"]})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("button",{onClick:()=>m("anniversary"),className:`flex-1 p-4 rounded-xl border-2 transition ${"anniversary"===x?"bg-blue-50 border-blue-500 text-blue-700 font-bold":"bg-white border-slate-200 text-slate-600 hover:border-blue-300"}`,children:[a.jsx("div",{className:"text-lg font-bold mb-1",children:"é€±å¹´åˆ¶"}),a.jsx("div",{className:"text-xs opacity-80",children:"Anniversary System"})]}),(0,a.jsxs)("button",{onClick:()=>m("calendar"),className:`flex-1 p-4 rounded-xl border-2 transition ${"calendar"===x?"bg-blue-50 border-blue-500 text-blue-700 font-bold":"bg-white border-slate-200 text-slate-600 hover:border-blue-300"}`,children:[a.jsx("div",{className:"text-lg font-bold mb-1",children:"æ›†å¹´åˆ¶"}),a.jsx("div",{className:"text-xs opacity-80",children:"Calendar System"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-bold text-slate-700 border-b pb-2 mb-4 flex items-center gap-2",children:[a.jsx(v.Z,{size:20})," åŠ ç­è¨­å®š (Overtime Settings)"]}),a.jsx("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-100 mb-4",children:a.jsx("p",{className:"text-sm text-orange-800",children:"ç•¶å“¡å·¥æ¯æ—¥å·¥æ™‚è¶…éè¨­å®šé–€æª»æ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•æç¤ºå“¡å·¥ç¢ºèªæ˜¯å¦ç”³è«‹åŠ ç­ã€‚"})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"åŠ ç­é–€æª» (å°æ™‚)"}),a.jsx("input",{type:"number",min:"1",max:"24",step:"0.5",value:f,onChange:e=>g(Number(e.target.value)),className:"w-full border p-3 rounded-lg bg-white text-lg font-bold"}),a.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"ç•¶æ—¥å·¥æ™‚è¶…éæ­¤é–€æª»æ™‚ï¼Œç³»çµ±æœƒæç¤ºå“¡å·¥ç¢ºèªæ˜¯å¦ç”³è«‹åŠ ç­"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"checkbox",id:"overtime_approval",checked:j,onChange:e=>N(e.target.checked),className:"w-5 h-5"}),a.jsx("label",{htmlFor:"overtime_approval",className:"text-sm font-bold text-slate-700",children:"éœ€è¦ä¸»ç®¡å¯©æ ¸"})]}),a.jsx("p",{className:"text-xs text-slate-400",children:j?"âœ“ åŠ ç­ç”³è«‹éœ€è¦ä¸»ç®¡å¯©æ ¸å¾Œæ‰æœƒç”Ÿæ•ˆ":"âœ“ åŠ ç­ç”³è«‹å°‡è‡ªå‹•æ ¸å‡†ï¼Œç„¡éœ€å¯©æ ¸"})]})]})]}),(0,a.jsxs)("div",{className:"mt-10 pt-6 border-t flex justify-between items-center",children:[a.jsx("span",{className:"text-sm font-bold text-green-600",children:u}),(0,a.jsxs)("button",{onClick:_,disabled:h,className:"flex items-center gap-2 bg-slate-800 text-white px-6 py-3 rounded-xl font-bold hover:bg-black transition disabled:opacity-50",children:[a.jsx(w.Z,{size:20})," ",h?"å„²å­˜ä¸­...":"å„²å­˜è¨­å®š"]})]})]})}function eZ(){let[e,t]=(0,l.useState)("staff");return(0,a.jsxs)("div",{className:"w-full animate-fade-in space-y-6 pb-20",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between bg-white p-4 rounded-xl shadow-sm border border-slate-200",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-slate-800 flex items-center gap-2",children:[a.jsx(f.Z,{className:"text-gray-600"}),"staff"===e?"äººå“¡æª”æ¡ˆç®¡ç†":"ç³»çµ±è¨­å®šä¸­å¿ƒ"]}),(0,a.jsxs)("div",{className:"flex bg-slate-100 p-1 rounded-lg",children:[(0,a.jsxs)("button",{onClick:()=>t("staff"),className:`flex items-center gap-2 px-6 py-2 text-sm font-bold rounded-md transition ${"staff"===e?"bg-white shadow text-blue-700":"text-slate-500 hover:text-slate-700"}`,children:[a.jsx(K.Z,{size:16})," äººå“¡ç®¡ç†"]}),(0,a.jsxs)("button",{onClick:()=>t("system"),className:`flex items-center gap-2 px-6 py-2 text-sm font-bold rounded-md transition ${"system"===e?"bg-white shadow text-purple-700":"text-slate-500 hover:text-slate-700"}`,children:[a.jsx(eb.Z,{size:16})," ç³»çµ±è¨­å®š"]})]})]}),"staff"===e&&a.jsx(ew,{}),"system"===e&&a.jsx(ez,{})]})}var eT=s(50007),eD=s(12029);function eE({requests:e,staffList:t,loading:s,onDelete:l,onAddClick:r,filters:n,setFilters:i}){let{useDateFilter:d,startDate:o,endDate:c,selectedStaffId:x,statusFilter:m}=n,h=e=>{i({useDateFilter:d,startDate:o,endDate:c,selectedStaffId:x,statusFilter:m,...e})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-wrap justify-between items-center mb-6 bg-white p-4 rounded-xl shadow-sm border gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,a.jsxs)("button",{onClick:()=>h({useDateFilter:!d}),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border text-sm font-bold transition ${d?"bg-blue-50 border-blue-200 text-blue-700":"bg-slate-50 border-slate-200 text-slate-500"}`,children:[d?a.jsx(V.Z,{size:20,className:"text-blue-600"}):a.jsx(X.Z,{size:20,className:"text-slate-400"}),"æ—¥æœŸç¯©é¸"]}),d&&(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-slate-50 p-1.5 rounded-lg border text-sm animate-fade-in",children:[a.jsx("span",{className:"text-slate-500 pl-1",children:"å€é–“:"}),a.jsx("input",{type:"date",value:o,onChange:e=>h({startDate:e.target.value}),className:"bg-transparent font-bold text-slate-700 outline-none"}),a.jsx("span",{className:"text-slate-400",children:"~"}),a.jsx("input",{type:"date",value:c,onChange:e=>h({endDate:e.target.value}),className:"bg-transparent font-bold text-slate-700 outline-none"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-slate-50 p-1.5 rounded-lg border text-sm",children:[a.jsx(K.Z,{size:16,className:"text-slate-400 ml-1"}),(0,a.jsxs)("select",{value:x,onChange:e=>h({selectedStaffId:e.target.value}),className:"bg-transparent font-bold text-slate-700 outline-none w-32",children:[a.jsx("option",{value:"all",children:"æ‰€æœ‰å“¡å·¥"}),t.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-slate-50 p-1.5 rounded-lg border text-sm",children:[a.jsx(eD.Z,{size:16,className:"text-slate-400 ml-1"}),(0,a.jsxs)("select",{value:m,onChange:e=>h({statusFilter:e.target.value}),className:"bg-transparent font-bold text-slate-700 outline-none w-24",children:[a.jsx("option",{value:"all",children:"ä¸é™ç‹€æ…‹"}),a.jsx("option",{value:"pending",children:"å¾…å¯©æ ¸"}),a.jsx("option",{value:"approved",children:"å·²é€šé"}),a.jsx("option",{value:"rejected",children:"å·²é§å›"})]})]})]}),(0,a.jsxs)("button",{onClick:r,className:"flex items-center gap-2 bg-orange-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-orange-600 transition shrink-0",children:[a.jsx(z.Z,{size:18})," æ–°å¢è«‹å‡"]})]}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border overflow-hidden",children:a.jsx("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-left border-collapse",children:[a.jsx("thead",{className:"bg-slate-50 text-slate-600 text-sm",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"p-4",children:"æ—¥æœŸ"}),a.jsx("th",{className:"p-4",children:"å“¡å·¥"}),a.jsx("th",{className:"p-4",children:"å‡åˆ¥"}),a.jsx("th",{className:"p-4",children:"æ™‚æ•¸"}),a.jsx("th",{className:"p-4",children:"äº‹ç”±"}),a.jsx("th",{className:"p-4 text-center",children:"ç‹€æ…‹"}),a.jsx("th",{className:"p-4"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-100 text-sm",children:s?a.jsx("tr",{children:a.jsx("td",{colSpan:7,className:"p-8 text-center text-slate-400",children:"è¼‰å…¥ä¸­..."})}):0===e.length?a.jsx("tr",{children:a.jsx("td",{colSpan:7,className:"p-8 text-center text-slate-400",children:"ç„¡ç¬¦åˆæ¢ä»¶çš„ç´€éŒ„"})}):e.map(e=>{let s=t.find(t=>t.id===e.staff_id),r=s?.name||e.staff_name||"æœªçŸ¥",n="pending"===e.status,i="rejected"===e.status;return(0,a.jsxs)("tr",{className:"hover:bg-slate-50 transition",children:[(0,a.jsxs)("td",{className:"p-4 font-mono text-slate-600",children:[e.start_time?.slice(0,10),a.jsx("br",{}),(0,a.jsxs)("span",{className:"text-xs text-slate-400",children:[e.start_time?.slice(11,16)," ~ ",e.end_time?.slice(11,16)]})]}),a.jsx("td",{className:"p-4 font-bold text-slate-800",children:r}),a.jsx("td",{className:"p-4",children:(0,a.jsxs)("span",{className:`px-2 py-1 rounded text-xs font-bold ${"è£œæ‰“å¡"===e.type?"bg-blue-100 text-blue-600":"äº‹å‡"===e.type?"bg-slate-200 text-slate-600":"bg-purple-100 text-purple-600"}`,children:[e.type," ",e.leave_type&&`(${e.leave_type})`]})}),(0,a.jsxs)("td",{className:"p-4 font-mono font-bold",children:[e.hours," hr"]}),a.jsx("td",{className:"p-4 text-slate-500 max-w-xs truncate",title:e.reason,children:e.reason||"-"}),a.jsx("td",{className:"p-4 text-center",children:n?a.jsx("span",{className:"bg-yellow-100 text-yellow-700 px-2 py-1 rounded text-xs font-bold",children:"å¾…å¯©æ ¸"}):i?a.jsx("span",{className:"bg-red-100 text-red-700 px-2 py-1 rounded text-xs font-bold",children:"å·²é§å›"}):a.jsx("span",{className:"bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-bold",children:"å·²é€šé"})}),a.jsx("td",{className:"p-4 text-right",children:a.jsx("button",{onClick:()=>l(e.id),className:"p-2 text-red-300 hover:text-red-500 hover:bg-red-50 rounded-full transition",children:a.jsx(T.Z,{size:18})})})]},e.id)})})]})})})]})}function eF({stats:e,loading:t,onOpenHistory:s,onOpenSettle:l,onRefresh:r}){return(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-4 border-b bg-slate-50 flex justify-between items-center",children:[(0,a.jsxs)("h3",{className:"font-bold text-slate-700 flex items-center gap-2",children:[a.jsx(eT.Z,{size:18})," ç‰¹ä¼‘çµ±è¨ˆèˆ‡çµç®—"]}),r&&a.jsx("button",{onClick:r,className:"px-3 py-1.5 bg-blue-50 text-blue-600 rounded-lg text-sm font-bold hover:bg-blue-100 transition",children:"é‡æ–°æ•´ç†"})]}),a.jsx("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-left border-collapse",children:[a.jsx("thead",{className:"bg-slate-50 text-slate-600 text-sm font-bold",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"p-4",children:"å“¡å·¥"}),a.jsx("th",{className:"p-4",children:"åˆ°è·æ—¥"}),a.jsx("th",{className:"p-4 text-center",children:"å¹´è³‡"}),a.jsx("th",{className:"p-4 text-center",children:"åˆ¶åº¦"}),a.jsx("th",{className:"p-4 text-center",children:"çµç®—å€é–“"}),a.jsx("th",{className:"p-4 text-right",children:"æ³•å®šå¤©æ•¸"}),a.jsx("th",{className:"p-4 text-right",children:"å·²ä¼‘"}),a.jsx("th",{className:"p-4 text-right",children:"å·²çµç®—"}),a.jsx("th",{className:"p-4 text-right font-bold text-green-600",children:"å‰©é¤˜"}),a.jsx("th",{className:"p-4 text-center",children:"æ“ä½œ"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-100 text-sm",children:t?a.jsx("tr",{children:a.jsx("td",{colSpan:10,className:"p-8 text-center text-slate-400",children:"è¼‰å…¥ä¸­..."})}):0===e.length?a.jsx("tr",{children:a.jsx("td",{colSpan:10,className:"p-8 text-center text-slate-400",children:"ç„¡è³‡æ–™"})}):e.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-slate-50 transition",children:[a.jsx("td",{className:"p-4 font-bold text-slate-800",children:e.staff_name}),a.jsx("td",{className:"p-4 font-mono text-slate-600",children:e.start_date||"-"}),(0,a.jsxs)("td",{className:"p-4 text-center font-mono",children:[e.years_of_service.toFixed(1)," å¹´"]}),a.jsx("td",{className:"p-4 text-center",children:a.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${"calendar"===e.calculation_system?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:"calendar"===e.calculation_system?"æ›†å¹´åˆ¶":"é€±å¹´åˆ¶"})}),a.jsx("td",{className:"p-4 text-center text-xs font-mono text-slate-500",children:e.period_start&&e.period_end?(0,a.jsxs)("div",{children:[e.period_start,a.jsx("br",{}),a.jsx("span",{className:"text-slate-400",children:"~"}),a.jsx("br",{}),e.period_end]}):"-"}),a.jsx("td",{className:"p-4 text-right font-mono font-bold",children:e.entitlement.toFixed(1)}),a.jsx("td",{className:"p-4 text-right font-mono",children:e.used.toFixed(1)}),a.jsx("td",{className:"p-4 text-right font-mono text-orange-600",children:e.settled.toFixed(1)}),a.jsx("td",{className:"p-4 text-right font-mono font-bold text-green-600 text-lg",children:e.remaining.toFixed(1)}),a.jsx("td",{className:"p-4 text-center",children:(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,a.jsxs)("button",{onClick:()=>s(e),className:"px-3 py-1.5 bg-blue-600 text-white rounded-lg text-xs font-bold hover:bg-blue-700 transition flex items-center gap-1",title:"æŸ¥çœ‹æ­·å¹´è©³æƒ…èˆ‡è¨­å®š",children:[a.jsx(x.Z,{size:14})," æ­·å¹´è©³æƒ…"]}),e.remaining>0&&(0,a.jsxs)("button",{onClick:()=>l(e),className:"px-3 py-1.5 bg-green-600 text-white rounded-lg text-xs font-bold hover:bg-green-700 transition flex items-center gap-1",children:[a.jsx(m.Z,{size:14})," çµç®—å…Œç¾"]})]})})]},e.staff_id))})]})})]})}let eM=["äº‹å‡","ç—…å‡","ç‰¹ä¼‘","è£œä¼‘","å…¬å‡","å–ªå‡","å©šå‡","ç”¢å‡"];function eO({isOpen:e,onClose:t,staffList:s,onSubmit:r}){let[n,i]=(0,l.useState)({staff_id:"",type:"äº‹å‡",date:new Date().toISOString().slice(0,10),start_time:"09:00",end_time:"18:00",hours:8,reason:""});if((0,l.useEffect)(()=>{if(n.start_time&&n.end_time){let e=new Date(`2000-01-01T${n.start_time}`),t=new Date(`2000-01-01T${n.end_time}`),s=(t.getTime()-e.getTime())/36e5;s>0&&i(e=>({...e,hours:s}))}},[n.start_time,n.end_time]),(0,l.useEffect)(()=>{e&&i({staff_id:"",type:"äº‹å‡",date:new Date().toISOString().slice(0,10),start_time:"09:00",end_time:"18:00",hours:8,reason:""})},[e]),!e)return null;let d=async()=>{if(!n.staff_id){alert("è«‹é¸æ“‡å“¡å·¥");return}await r(n)};return a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6",children:[a.jsx("h3",{className:"text-xl font-bold mb-4",children:"æ–°å¢è«‹å‡å–® (ç®¡ç†å“¡ä»£å¡«)"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-600 mb-1",children:"å“¡å·¥"}),(0,a.jsxs)("select",{className:"w-full p-2 border rounded",value:n.staff_id,onChange:e=>i({...n,staff_id:e.target.value}),children:[a.jsx("option",{value:"",children:"è«‹é¸æ“‡..."}),s.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," (","pharmacy"===e.entity?"è—¥å±€":"è¨ºæ‰€",")"]},e.id))]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-600 mb-1",children:"æ—¥æœŸ"}),a.jsx("input",{type:"date",className:"w-full p-2 border rounded",value:n.date,onChange:e=>i({...n,date:e.target.value})})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-600 mb-1",children:"å‡åˆ¥"}),a.jsx("select",{className:"w-full p-2 border rounded",value:n.type,onChange:e=>i({...n,type:e.target.value}),children:eM.map(e=>a.jsx("option",{value:e,children:e},e))})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-600 mb-1",children:"é–‹å§‹"}),a.jsx("input",{type:"time",className:"w-full p-2 border rounded text-sm",value:n.start_time,onChange:e=>i({...n,start_time:e.target.value})})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-600 mb-1",children:"çµæŸ"}),a.jsx("input",{type:"time",className:"w-full p-2 border rounded text-sm",value:n.end_time,onChange:e=>i({...n,end_time:e.target.value})})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-600 mb-1",children:"æ™‚æ•¸"}),a.jsx("input",{type:"number",step:"0.5",className:"w-full p-2 border rounded font-bold",value:n.hours,onChange:e=>i({...n,hours:Number(e.target.value)||0})})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-600 mb-1",children:"äº‹ç”±"}),a.jsx("input",{type:"text",className:"w-full p-2 border rounded",placeholder:"é¸å¡«",value:n.reason,onChange:e=>i({...n,reason:e.target.value})})]})]}),(0,a.jsxs)("div",{className:"mt-6 flex justify-end gap-3 border-t pt-4",children:[a.jsx("button",{onClick:t,className:"px-4 py-2 text-slate-500 hover:bg-slate-100 rounded",children:"å–æ¶ˆ"}),a.jsx("button",{onClick:d,className:"px-4 py-2 bg-slate-800 text-white rounded hover:bg-black font-bold",children:"é€å‡º"})]})]})})}function eP({isOpen:e,onClose:t,staff:s,onSubmit:r}){let[n,i]=(0,l.useState)({days:0,pay_month:new Date().toISOString().slice(0,7),notes:""});if((0,l.useEffect)(()=>{e&&s&&i({days:Math.min(s.remaining??0,1)||0,pay_month:new Date().toISOString().slice(0,7),notes:""})},[e,s]),!e||!s)return null;let d=async()=>{if(n.days<=0){alert("çµç®—å¤©æ•¸å¿…é ˆå¤§æ–¼0");return}if(n.days>(s.remaining??0)){alert(`å‰©é¤˜ç‰¹ä¼‘ä¸è¶³ (å‰©é¤˜: ${s.remaining?.toFixed(1)??0} å¤©)`);return}await r(n)};return a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("h3",{className:"text-xl font-bold flex items-center gap-2",children:[a.jsx(m.Z,{className:"text-green-600"})," ç‰¹ä¼‘çµç®—å…Œç¾"]}),a.jsx("button",{onClick:t,className:"p-1 hover:bg-slate-100 rounded",children:a.jsx(_.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-lg border",children:[a.jsx("div",{className:"text-sm text-slate-600 mb-2",children:"å“¡å·¥"}),a.jsx("div",{className:"text-lg font-bold text-slate-800",children:s.staff_name})]}),(0,a.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[a.jsx("div",{className:"text-sm text-green-700 mb-1",children:"å‰©é¤˜ç‰¹ä¼‘"}),(0,a.jsxs)("div",{className:"text-2xl font-bold text-green-700",children:[s.remaining?.toFixed(1)," å¤©"]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-600 mb-1",children:"æ¬²çµç®—å¤©æ•¸"}),a.jsx("input",{type:"number",step:"0.5",min:"0.5",max:s.remaining,className:"w-full p-3 border rounded-lg font-bold text-lg text-center",value:n.days,onChange:e=>i({...n,days:Number(e.target.value)||0})}),(0,a.jsxs)("p",{className:"text-xs text-slate-400 mt-1",children:["æœ€å¤šå¯çµç®— ",s.remaining?.toFixed(1)," å¤©"]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-600 mb-1",children:"ç™¼æ”¾æœˆä»½"}),a.jsx("input",{type:"month",className:"w-full p-3 border rounded-lg font-bold",value:n.pay_month,onChange:e=>i({...n,pay_month:e.target.value})})]}),(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[a.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"è©¦ç®—é‡‘é¡"}),(0,a.jsxs)("div",{className:"text-2xl font-bold text-blue-700",children:["$",(()=>{let e=s.base_salary||0,t=s.salary_mode||"hourly";return"monthly"===t?Math.round(e/30*n.days*100)/100:Math.round(8*e*n.days*100)/100})().toLocaleString()]}),a.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"monthly"===s.salary_mode?(0,a.jsxs)(a.Fragment,{children:["è¨ˆç®—å…¬å¼: (æœˆè–ª ",s.base_salary?.toLocaleString()||0," \xf7 30) \xd7"," ",n.days," å¤©"]}):(0,a.jsxs)(a.Fragment,{children:["è¨ˆç®—å…¬å¼: (æ™‚è–ª ",s.base_salary?.toLocaleString()||0," \xd7 8å°æ™‚) \xd7"," ",n.days," å¤©"]})}),(0,a.jsxs)("div",{className:"text-[10px] text-blue-500 mt-1 opacity-80",children:["è–ªè³‡æ¨¡å¼: ","monthly"===s.salary_mode?"æœˆè–ªåˆ¶":"æ™‚è–ªåˆ¶"]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-slate-600 mb-1",children:"å‚™è¨» (é¸å¡«)"}),a.jsx("input",{type:"text",className:"w-full p-2 border rounded",placeholder:"ä¾‹å¦‚ï¼šå“¡å·¥ç”³è«‹çµç®—",value:n.notes,onChange:e=>i({...n,notes:e.target.value})})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 border-t pt-4",children:[a.jsx("button",{onClick:t,className:"px-4 py-2 text-slate-500 hover:bg-slate-100 rounded",children:"å–æ¶ˆ"}),(0,a.jsxs)("button",{onClick:d,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-bold flex items-center gap-2",children:[a.jsx(m.Z,{size:18})," ç¢ºèªçµç®—"]})]})]})})}var eA=s(69489);function eI({isOpen:e,onClose:t,staff:s,onSaved:r}){let[n,i]=(0,l.useState)([]),[d,c]=(0,l.useState)([]),[h,p]=(0,l.useState)(!1),[u,b]=(0,l.useState)(""),[f,g]=(0,l.useState)(""),[j,N]=(0,l.useState)(""),y=(0,l.useMemo)(()=>n.reduce((e,t)=>{let s=Number(t.days??0),a=Number(t.manual_used??0)+Number(t.system_used??0),l=Number(t.manual_settled??0)+Number(t.system_settled??0);return e+(s-a-l)},0),[n]);(0,l.useEffect)(()=>{let t=async()=>{if(e&&s){p(!0);try{let e=await fetch(`/api/leave/stats?action=details&staff_id=${s.staff_id}`),t=await e.json();if(t.error){console.error("Leave history details error:",t.error),alert("è¼‰å…¥ç‰¹ä¼‘å¸³æœ¬å¤±æ•—");return}let a=t.data||{},l=a.history_array||[],r=a.usage_by_year||{},n=a.settled_by_year||{},d=a.settlements||[],o=new Set;l.forEach(e=>{e.year&&o.add(String(e.year))}),Object.keys(r).forEach(e=>o.add(String(e))),Object.keys(n).forEach(e=>o.add(String(e))),d.forEach(e=>{let t=null;e.pay_month?t=new Date(`${e.pay_month}-01T00:00:00`):e.created_at&&(t=new Date(e.created_at)),t&&!Number.isNaN(t.getTime())&&o.add(t.getFullYear().toString())});let x=Array.from(o).map(e=>{let t=l.find(t=>String(t.year)===String(e)),s=Number(t?.days??0),a=Number(r[e]??0),i=Number(n[e]??0);return{year:String(e),days:s,manual_used:0,manual_settled:0,system_used:a,system_settled:i,note:t?.note??""}}).sort((e,t)=>t.year.localeCompare(e.year));i(x),c(d)}catch(e){console.error("Fetch history error:",e),alert("è¼‰å…¥è³‡æ–™å¤±æ•—")}finally{p(!1)}}};t()},[e,s]);let v=async()=>{if(!s)return;let e=n.filter(e=>e.year&&void 0!==e.days&&null!==e.days).map(e=>({year:Number(e.year),days:Number(e.days),note:e.note?.trim()||null}));try{let t=await fetch("/api/staff",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s.staff_id,annual_leave_history:e.length>0?e:null})}),a=await t.json();a.success?(alert("å„²å­˜æˆåŠŸï¼"),r&&r()):alert("å„²å­˜å¤±æ•—: "+a.message)}catch(e){console.error("Save annual leave history error:",e),alert("å„²å­˜å¤±æ•—")}},k=e=>{let t=[...n];t.splice(e,1),i(t)};return e&&s?a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-2xl font-bold flex items-center gap-2",children:[a.jsx(x.Z,{size:24})," ç‰¹ä¼‘æ­·å¹´è©³æƒ…èˆ‡è¨­å®š"]}),a.jsx("p",{className:"text-blue-100 mt-1",children:s.staff_name})]}),a.jsx("button",{onClick:()=>{i([]),c([]),b(""),g(""),N(""),t()},className:"p-2 hover:bg-white/20 rounded-full transition",children:a.jsx(_.Z,{size:24})})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:h?a.jsx("div",{className:"text-center py-12 text-slate-400",children:"è¼‰å…¥ä¸­..."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"bg-teal-50 rounded-xl p-6 border border-teal-200",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsxs)("h4",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[a.jsx(o.Z,{className:"text-teal-600"})," å¹´åº¦ç‰¹ä¼‘å¸³æœ¬"]}),(0,a.jsxs)("div",{className:"text-xs text-teal-700",children:["è¨ˆç®—ä¾æ“šï¼š",a.jsx("span",{className:"font-bold",children:s?.calculation_system==="calendar"?"æ›†å¹´åˆ¶ (ç›®å‰åƒ…å±•ç¤ºï¼Œè©¦ç®—ä»æ¡é€±å¹´åˆ¶)":"é€±å¹´åˆ¶"})]})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,a.jsxs)("div",{className:"text-sm text-teal-800 font-bold",children:["å¸³æœ¬ç¸½å‰©é¤˜ï¼š",(0,a.jsxs)("span",{className:"text-xl ml-1",children:[y.toFixed(1)," å¤©"]})]}),(0,a.jsxs)("button",{type:"button",onClick:()=>{if(!s?.start_date){alert("æ­¤å“¡å·¥å°šæœªè¨­å®šåˆ°è·æ—¥ï¼Œç„¡æ³•è‡ªå‹•è©¦ç®—ç‰¹ä¼‘ã€‚");return}try{let e=new Date(s.start_date);if(Number.isNaN(e.getTime())){alert("åˆ°è·æ—¥æ ¼å¼æœ‰èª¤ï¼Œç„¡æ³•è‡ªå‹•è©¦ç®—ã€‚");return}let t=new Date,a=t.getFullYear(),l=a+1,r=(e,t)=>{let s=new Date(e.getTime());return s.setFullYear(s.getFullYear()+t),s},d=e=>1===e?7:2===e?10:3===e||4===e?14:e>=5&&e<=9?15:e>=10?Math.min(30,15+(e-9)):0,o=[...n],c=(e,t)=>o.some(s=>s.year===e&&Number(s.days??0)===Number(t)),x=((e,t)=>{let s=new Date(e.getTime()),a=s.getMonth()+6;return s.setMonth(a),s})(e,0);if(!Number.isNaN(x.getTime())){let e=x.getFullYear();if(e<=l){let t=String(e);c(t,3)||o.push({year:t,days:3,manual_used:0,manual_settled:0,system_used:0,system_settled:0,note:"æ»¿åŠå¹´ç‰¹ä¼‘ (é€±å¹´åˆ¶)"})}}for(let t=1;t<=50;t++){let s=r(e,t);if(Number.isNaN(s.getTime()))break;let a=s.getFullYear();if(a>l)break;let n=d(t);if(n<=0)continue;let i=String(a);c(i,n)||o.push({year:i,days:n,manual_used:0,manual_settled:0,system_used:0,system_settled:0,note:`æ»¿ ${t} å¹´ç‰¹ä¼‘ (é€±å¹´åˆ¶)`})}o.sort((e,t)=>t.year.localeCompare(e.year)),i(o)}catch(e){console.error("Auto calculate error:",e),alert("è‡ªå‹•è©¦ç®—æ™‚ç™¼ç”ŸéŒ¯èª¤")}},className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full text-xs font-bold bg-white text-teal-700 border border-teal-300 hover:bg-teal-50 transition",children:[a.jsx(eA.Z,{size:14}),"\uD83E\uDE84 ä¾ç…§åˆ°è·æ—¥è‡ªå‹•è©¦ç®—"]})]})]}),a.jsx("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm bg-white rounded-lg overflow-hidden border",children:[a.jsx("thead",{className:"bg-teal-100 text-teal-900 font-bold",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"p-2 text-left",children:"å¹´åº¦"}),a.jsx("th",{className:"p-2 text-right",children:"æ‡‰ä¼‘å¤©æ•¸"}),a.jsx("th",{className:"p-2 text-right",children:"å¯¦éš›å·²ä¼‘"}),a.jsx("th",{className:"p-2 text-right",children:"å·²çµç®—"}),a.jsx("th",{className:"p-2 text-right",children:"å‰©é¤˜"}),a.jsx("th",{className:"p-2 text-center",children:"ç‹€æ…‹"}),a.jsx("th",{className:"p-2 text-left",children:"å‚™è¨»"}),a.jsx("th",{className:"p-2 text-center",children:"æ“ä½œ"})]})}),a.jsx("tbody",{className:"divide-y divide-teal-100",children:n.length>0?n.map((e,t)=>{let s=Number(e.days??0),l=Number(e.manual_used??0)+Number(e.system_used??0),r=Number(e.manual_settled??0)+Number(e.system_settled??0),d=Math.round((s-l-r)*100)/100;return(0,a.jsxs)("tr",{className:"hover:bg-teal-50/60 transition",children:[a.jsx("td",{className:"p-2 font-bold text-slate-800",children:e.year}),a.jsx("td",{className:"p-2 text-right",children:a.jsx("input",{type:"number",value:e.days,min:0,step:.5,className:"w-20 p-1.5 border rounded text-right font-mono",onChange:s=>{let a=Number(s.target.value)||0,l=[...n];l[t]={...e,days:a},i(l)}})}),a.jsx("td",{className:"p-2 text-right font-mono",children:l.toFixed(1)}),a.jsx("td",{className:"p-2 text-right font-mono text-orange-700",children:r.toFixed(1)}),a.jsx("td",{className:"p-2 text-right font-mono font-bold text-green-700",children:d.toFixed(1)}),a.jsx("td",{className:"p-2 text-center",children:d<=0?a.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold bg-emerald-100 text-emerald-700",children:"âœ… å·²çµæ¸…"}):a.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold bg-amber-100 text-amber-700",children:"âš ï¸ æœªçµæ¸…"})}),a.jsx("td",{className:"p-2",children:a.jsx("input",{type:"text",value:e.note??"",onChange:s=>{let a=[...n];a[t]={...e,note:s.target.value},i(a)},className:"w-full p-1.5 border rounded text-xs",placeholder:"å‚™è¨» (é¸å¡«)"})}),a.jsx("td",{className:"p-2 text-center",children:(0,a.jsxs)("button",{onClick:()=>k(t),className:"px-2 py-1 text-xs text-red-500 hover:bg-red-50 rounded flex items-center gap-1 mx-auto",children:[a.jsx(_.Z,{size:14})," åˆªé™¤"]})})]},e.year)}):a.jsx("tr",{children:a.jsx("td",{colSpan:8,className:"p-4 text-center text-slate-400 text-sm",children:"å°šç„¡ç‰¹ä¼‘ç´€éŒ„ï¼Œè«‹å…ˆæ–°å¢å¹´åº¦è¨­å®šã€‚"})})})]})}),(0,a.jsxs)("div",{className:"border-t border-teal-200 pt-4 mt-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-600 mb-1",children:"å¹´åº¦"}),a.jsx("input",{type:"number",value:u,onChange:e=>b(e.target.value),className:"w-full p-2 border rounded bg-white",placeholder:"ä¾‹ï¼š2024",min:"2000",max:"2100"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs font-bold text-slate-600 mb-1",children:"æ‡‰ä¼‘å¤©æ•¸"}),a.jsx("input",{type:"number",value:f,onChange:e=>g(e.target.value),className:"w-full p-2 border rounded bg-white",placeholder:"ä¾‹ï¼š7",min:"0",step:"0.5"})]}),(0,a.jsxs)("div",{className:"md:col-span-1",children:[a.jsx("label",{className:"block text-xs font-bold text-slate-600 mb-1",children:"å‚™è¨»"}),a.jsx("input",{type:"text",value:j,onChange:e=>N(e.target.value),className:"w-full p-2 border rounded bg-white",placeholder:"ä¾‹å¦‚ï¼šä¾å‹åŸºæ³•çµ¦äºˆ"})]}),a.jsx("div",{className:"flex md:justify-end",children:a.jsx("button",{onClick:()=>{let e=u.trim(),t=Number(f);if(!e||!t||t<=0){alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„å¹´ä»½å’Œå¤©æ•¸");return}let s=n.findIndex(t=>t.year===e);if(s>=0){let a=[...n];a[s]={...a[s],year:e,days:t,note:j},i(a)}else{let s=[...n,{year:e,days:t,manual_used:0,manual_settled:0,system_used:0,system_settled:0,note:j}];s.sort((e,t)=>t.year.localeCompare(e.year)),i(s)}b(""),g(""),N("")},className:"w-full md:w-auto px-4 py-2 bg-teal-600 text-white rounded font-bold text-sm hover:bg-teal-700 transition whitespace-nowrap",children:"åŠ å…¥å¹´åº¦"})})]}),(0,a.jsxs)("button",{onClick:v,className:"mt-4 w-full px-4 py-2.5 bg-slate-800 text-white rounded-lg font-bold hover:bg-black transition flex items-center justify-center gap-2",children:[a.jsx(w.Z,{size:18})," å„²å­˜å¹´åº¦è¨­å®š"]})]})]}),(0,a.jsxs)("div",{className:"bg-purple-50 rounded-xl p-6 border border-purple-200",children:[(0,a.jsxs)("h4",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center gap-2",children:[a.jsx(m.Z,{className:"text-purple-600"})," çµç®—èˆ‡èª¿æ•´ç´€éŒ„"]}),a.jsx("div",{className:"overflow-x-auto",children:d.length>0?(0,a.jsxs)("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-white text-slate-600 font-bold",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"p-2 text-left",children:"çµç®—æ—¥æœŸ"}),a.jsx("th",{className:"p-2 text-right",children:"å¤©æ•¸"}),a.jsx("th",{className:"p-2 text-right",children:"é‡‘é¡"}),a.jsx("th",{className:"p-2 text-center",children:"ç™¼æ”¾æœˆä»½"}),a.jsx("th",{className:"p-2 text-center",children:"ç‹€æ…‹"}),a.jsx("th",{className:"p-2 text-left",children:"å‚™è¨»"})]})}),a.jsx("tbody",{className:"divide-y divide-purple-100",children:d.map(e=>(0,a.jsxs)("tr",{className:"bg-white hover:bg-purple-50 transition",children:[a.jsx("td",{className:"p-2 font-mono text-xs text-slate-600",children:e.created_at?new Date(e.created_at).toLocaleDateString("zh-TW"):"-"}),(0,a.jsxs)("td",{className:"p-2 text-right font-bold text-slate-800",children:[e.days," å¤©"]}),(0,a.jsxs)("td",{className:"p-2 text-right font-bold text-green-600",children:["$",e.amount?.toLocaleString()||"0"]}),a.jsx("td",{className:"p-2 text-center font-mono text-xs text-slate-600",children:e.pay_month||"-"}),a.jsx("td",{className:"p-2 text-center",children:a.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${"processed"===e.status?"bg-green-100 text-green-700":"pending"===e.status?"bg-yellow-100 text-yellow-700":"bg-slate-100 text-slate-700"}`,children:"processed"===e.status?"å·²è™•ç†":"pending"===e.status?"å¾…è™•ç†":e.status||"-"})}),a.jsx("td",{className:"p-2 text-xs text-slate-500 max-w-xs truncate",title:e.notes,children:e.notes||"-"})]},e.id))})]}):a.jsx("div",{className:"text-center py-8 text-slate-400 text-sm",children:"å°šç„¡çµç®—ç´€éŒ„"})})]})]})})]})}):null}let eH=()=>{let e=new Date,t=new Date(e.getFullYear(),0,1),s=new Date(e.getFullYear(),11,31),a=e=>e.toISOString().split("T")[0];return{start:a(t),end:a(s)}};function eJ(){let[e,t]=(0,l.useState)("requests"),s=eH(),[r,n]=(0,l.useState)(!1),[i,d]=(0,l.useState)(s.start),[c,x]=(0,l.useState)(s.end),[m,h]=(0,l.useState)("all"),[p,u]=(0,l.useState)("all"),[b,f]=(0,l.useState)([]),[g,j]=(0,l.useState)([]),[N,y]=(0,l.useState)(!1),[_,w]=(0,l.useState)(!1),[k,S]=(0,l.useState)([]),[C,$]=(0,l.useState)(!1),[z,Z]=(0,l.useState)(!1),[T,D]=(0,l.useState)(null),[E,F]=(0,l.useState)(!1),[M,O]=(0,l.useState)(null);(0,l.useEffect)(()=>{P(),"stats"===e&&I()},[e]),(0,l.useEffect)(()=>{"requests"===e&&A()},[r,i,c,m,p,e]);let P=async()=>{try{let e=await fetch("/api/staff"),t=await e.json();t.data&&j(t.data.map(e=>({id:e.id,name:e.name,entity:e.entity})))}catch(e){console.error("Fetch staff error:",e)}},A=async()=>{w(!0);try{let e=new URLSearchParams({useDateFilter:String(r),selectedStaffId:m,statusFilter:p});r&&(e.append("startDate",i),e.append("endDate",c));let t=await fetch(`/api/leave?${e.toString()}`),s=await t.json();s.error?(console.error("Error:",s.error),f([])):f(s.data||[])}catch(e){console.error("Fetch requests error:",e),f([])}finally{w(!1)}},I=async()=>{$(!0);try{let e=await fetch("/api/leave/stats"),t=await e.json();t.error?(console.error("Error:",t.error),S([])):S(t.data||[])}catch(e){console.error("Fetch leave stats error:",e),S([])}finally{$(!1)}},H=async e=>{if(confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†è«‹å‡ç´€éŒ„å—ï¼Ÿ"))try{let t=await fetch(`/api/leave?id=${e}`,{method:"DELETE"}),s=await t.json();s.success?A():alert("åˆªé™¤å¤±æ•—: "+s.message)}catch(e){console.error("Delete error:",e),alert("åˆªé™¤å¤±æ•—")}},J=async e=>{try{let t=g.find(t=>t.id===Number(e.staff_id));if(!t){alert("æ‰¾ä¸åˆ°å“¡å·¥è³‡æ–™");return}let s=await fetch("/api/leave",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({staff_id:Number(e.staff_id),staff_name:t.name,type:e.type,date:e.date,start_time:e.start_time,end_time:e.end_time,hours:Number(e.hours),reason:e.reason,status:"approved"})}),a=await s.json();a.success?(y(!1),A()):alert("æ–°å¢å¤±æ•—: "+a.message)}catch(e){console.error("Submit error:",e),alert("æ–°å¢å¤±æ•—")}},L=async e=>{O(e),F(!0)},Y=async e=>{if(T)try{let t=await fetch("/api/leave/settle",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({staff_id:T.staff_id,days:Number(e.days),pay_month:e.pay_month,notes:e.notes})}),s=await t.json();s.success?(alert("çµç®—ç´€éŒ„å·²å»ºç«‹ï¼"),Z(!1),I()):alert("çµç®—å¤±æ•—: "+s.message)}catch(e){console.error("Settle error:",e),alert("çµç®—å¤±æ•—")}};return(0,a.jsxs)("div",{className:"w-full animate-fade-in p-4",children:[a.jsx("div",{className:"flex flex-wrap justify-between items-center mb-6 bg-white p-4 rounded-xl shadow-sm border gap-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold flex items-center gap-2 text-slate-800 shrink-0",children:[a.jsx(o.Z,{className:"text-orange-500"})," è«‹å‡ç®¡ç†ç³»çµ±"]}),a.jsx("div",{className:"h-8 w-px bg-slate-200 mx-2 hidden md:block"}),(0,a.jsxs)("div",{className:"flex bg-slate-100 p-1 rounded-lg",children:[(0,a.jsxs)("button",{onClick:()=>t("requests"),className:`flex items-center gap-2 px-4 py-2 text-sm font-bold rounded-md transition ${"requests"===e?"bg-white shadow text-blue-700":"text-slate-500 hover:text-slate-700"}`,children:[a.jsx(v.Z,{size:16})," è«‹å‡ç”³è«‹åˆ—è¡¨"]}),(0,a.jsxs)("button",{onClick:()=>t("stats"),className:`flex items-center gap-2 px-4 py-2 text-sm font-bold rounded-md transition ${"stats"===e?"bg-white shadow text-purple-700":"text-slate-500 hover:text-slate-700"}`,children:[a.jsx(eT.Z,{size:16})," ç‰¹ä¼‘çµ±è¨ˆèˆ‡çµç®—"]})]})]})}),"requests"===e&&a.jsx(eE,{requests:b,staffList:g,loading:_,onDelete:H,onAddClick:()=>y(!0),filters:{useDateFilter:r,startDate:i,endDate:c,selectedStaffId:m,statusFilter:p},setFilters:e=>{n(e.useDateFilter),d(e.startDate),x(e.endDate),h(e.selectedStaffId),u(e.statusFilter)}}),"stats"===e&&a.jsx(eF,{stats:k,loading:C,onOpenHistory:L,onOpenSettle:e=>{D(e),Z(!0)},onRefresh:I}),a.jsx(eO,{isOpen:N,onClose:()=>y(!1),staffList:g,onSubmit:J}),a.jsx(eP,{isOpen:z,onClose:()=>Z(!1),staff:T,onSubmit:Y}),E&&M&&a.jsx(eI,{isOpen:E,onClose:()=>{F(!1),O(null)},staff:M,onSaved:I})]})}var eL=s(44155),eY=s(35503),eB=s(21518),eR=s(54255),eq=s(55642),eG=s(12980);let eU={mode:"guarantee",licenseFee:0,guarantee:0,hourlyRate:0,actualHours:0,standardHours:0,workPay:0,adjustment:0,insurance:0,finalBase:0,insurance_labor:0,insurance_health:0},eW={patient_count:0,nhi_points:0,reg_fee_deduction:0,clinic_days:0,transfer_amount:0,self_pay_items:[],extra_items:[],past_base_salary:0,status:"draft"},eV=({doctor:e,onClose:t,onUpdate:s})=>{let[r,n]=(0,l.useState)({...e}),i=async()=>{try{await fetch("/api/staff",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id,doctor_base_mode:r.doctor_base_mode,doctor_license_fee:r.doctor_license_fee,doctor_guarantee_salary:r.doctor_guarantee_salary,doctor_hourly_rate:r.doctor_hourly_rate,doctor_nhi_rate:r.doctor_nhi_rate,doctor_hours_per_shift:r.doctor_hours_per_shift,insurance_labor:r.insurance_labor,insurance_health:r.insurance_health})}),s(),t()}catch(e){console.error("Error updating doctor settings:",e),alert("æ›´æ–°å¤±æ•—: "+e.message)}};return a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-teal-700 text-white p-4 flex justify-between items-center",children:[(0,a.jsxs)("h3",{className:"font-bold flex items-center gap-2",children:[a.jsx(f.Z,{size:18})," åƒæ•¸è¨­å®š"]}),a.jsx("button",{onClick:t,children:a.jsx(_.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"p-6 space-y-4 max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"bg-slate-50 p-3 rounded border",children:[a.jsx("label",{className:"text-xs font-bold text-slate-500 block mb-2",children:"è¨ˆç®—æ¨¡å¼"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>n({...r,doctor_base_mode:"guarantee"}),className:`flex-1 py-1.5 rounded text-sm font-bold border ${"license"!==r.doctor_base_mode?"bg-teal-600 text-white border-teal-600":"bg-white text-slate-500"}`,children:"ä¿åº• +/- æ™‚æ•¸"}),a.jsx("button",{onClick:()=>n({...r,doctor_base_mode:"license"}),className:`flex-1 py-1.5 rounded text-sm font-bold border ${"license"===r.doctor_base_mode?"bg-teal-600 text-white border-teal-600":"bg-white text-slate-500"}`,children:"æ›ç‰Œè²» + æ™‚è–ª"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"col-span-2",children:[a.jsx("label",{className:"text-xs font-bold text-slate-500",children:"license"===r.doctor_base_mode?"æ¯æœˆæ›ç‰Œè²»":"æ¯æœˆä¿éšœè–ª"}),a.jsx("input",{type:"number",value:"license"===r.doctor_base_mode?r.doctor_license_fee:r.doctor_guarantee_salary,onChange:e=>n({...r,["license"===r.doctor_base_mode?"doctor_license_fee":"doctor_guarantee_salary"]:Number(e.target.value)}),className:"w-full border p-2 rounded text-right font-bold text-blue-700"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-xs font-bold text-slate-500",children:"è¨ˆç®—æ™‚è–ª"}),a.jsx("input",{type:"number",value:r.doctor_hourly_rate,onChange:e=>n({...r,doctor_hourly_rate:Number(e.target.value)}),className:"w-full border p-2 rounded text-right"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-xs font-bold text-slate-500",children:"æ¯è¨ºæ¨™æº–æ™‚æ•¸"}),a.jsx("input",{type:"number",value:r.doctor_hours_per_shift,onChange:e=>n({...r,doctor_hours_per_shift:Number(e.target.value)}),className:"w-full border p-2 rounded text-right"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-xs font-bold text-slate-500",children:"å¥ä¿æŠ½æˆç‡"}),a.jsx("input",{type:"number",step:"0.01",value:r.doctor_nhi_rate,onChange:e=>n({...r,doctor_nhi_rate:Number(e.target.value)}),className:"w-full border p-2 rounded text-right"})]})]}),(0,a.jsxs)("div",{className:"border-t pt-4 grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-xs font-bold text-slate-500",children:"å‹ä¿è‡ªä»˜"}),a.jsx("input",{type:"number",value:r.insurance_labor,onChange:e=>n({...r,insurance_labor:Number(e.target.value)}),className:"w-full border p-2 rounded text-right text-red-500"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-xs font-bold text-slate-500",children:"å¥ä¿è‡ªä»˜"}),a.jsx("input",{type:"number",value:r.insurance_health,onChange:e=>n({...r,insurance_health:Number(e.target.value)}),className:"w-full border p-2 rounded text-right text-red-500"})]})]}),a.jsx("button",{onClick:i,className:"w-full bg-teal-600 text-white py-3 rounded-xl font-bold hover:bg-teal-700 mt-4",children:"å„²å­˜è¨­å®š"})]})]})})};function eX(){let[e,t]=(0,l.useState)(new Date().toISOString().slice(0,7)),[s,r]=(0,l.useState)(""),[n,i]=(0,l.useState)([]),[d,o]=(0,l.useState)(null),[x,m]=(0,l.useState)([]),[h,p]=(0,l.useState)(eU),[u,b]=(0,l.useState)(()=>({...eW})),[v,_]=(0,l.useState)(!1),[k,S]=(0,l.useState)(!1),[C,$]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let t=new Date(e);t.setMonth(t.getMonth()-2),r(t.toISOString().slice(0,7))},[e]),(0,l.useEffect)(()=>{Z()},[]);let z=()=>{p({...eU}),b({...eW}),m([])};(0,l.useEffect)(()=>{if(z(),!d||!e||!s)return;let t=n.find(e=>e.id===d);if(!t)return;let a=!1,l=async()=>{try{let l=await fetch(`/api/doctor/ppf?doctor_id=${d}&target_month=${s}`),r=await l.json();if(a)return;let n=0,i=await fetch(`/api/doctor/ppf?doctor_id=${d}&paid_in_month=${s}`),o=await i.json();if(a)return;n=o.data&&o.data.length>0?Number(o.data[0].actual_base_pay)||0:Number(t?.doctor_guarantee_salary)||0;let c=r.data,x=c&&"locked"===c.status;if(x){let e=Number(t.insurance_labor)||0,s=Number(t.insurance_health)||0,a=c.snapshot_mode||"guarantee",l=Number(c.snapshot_guarantee)||0,r=Number(c.snapshot_license_fee)||0,i=Number(c.snapshot_actual_hours)||0,d=Number(c.snapshot_standard_hours)||0,o=Number(c.snapshot_hourly_rate)||0,x="license"===a?Math.round(i*o):Math.round((i-d)*o),h="license"===a?r+x:l+x;b({patient_count:Number(c.patient_count)||0,nhi_points:Number(c.nhi_points)||0,reg_fee_deduction:Number(c.reg_fee_deduction)||0,clinic_days:Number(c.clinic_days)||0,transfer_amount:Number(c.transfer_amount)||0,self_pay_items:Array.isArray(c.self_pay_items)?c.self_pay_items:[],extra_items:Array.isArray(c.extra_items)?c.extra_items:[],past_base_salary:null!=c.base_salary_at_time?Number(c.base_salary_at_time):n,status:"locked"}),p({mode:a,licenseFee:r,guarantee:l,hourlyRate:o,actualHours:i,standardHours:d,workPay:"license"===a?x:0,adjustment:"guarantee"===a?x:0,finalBase:h,insurance_labor:e,insurance_health:s}),m(Array.isArray(c.snapshot_roster)?c.snapshot_roster:[]);return}let h=(e,t)=>(Array.isArray(e)?e:[]).map((e,s)=>({...e,id:e?.id??t+s+Math.random()}));if(c)b({patient_count:Number(c.patient_count)||0,nhi_points:Number(c.nhi_points)||0,reg_fee_deduction:Number(c.reg_fee_deduction)||0,clinic_days:Number(c.clinic_days)||0,transfer_amount:Number(c.transfer_amount)||0,self_pay_items:h(c.self_pay_items||[],Date.now()),extra_items:h(c.extra_items||[],Date.now()+1e6),past_base_salary:null!=c.base_salary_at_time?Number(c.base_salary_at_time):n,status:c.status||"draft"});else{let e=[];t?.doctor_self_pay_template&&Array.isArray(t.doctor_self_pay_template)&&(e=t.doctor_self_pay_template.map((e,t)=>({id:Date.now()+t+Math.random(),name:e.name||"è‡ªè²»",amount:0,rate:e.rate??30}))),b({...eW,self_pay_items:e,past_base_salary:n})}let[u,f]=e.split("-").map(Number),g=await fetch(`/api/roster/doctor?doctor_id=${d}&year=${u}&month=${f}`),j=await g.json();if(a)return;let N=j.data||[];m(N);let y=0;N.forEach(e=>{if(e.start_time&&e.end_time){let[t,s]=e.start_time.split(":").map(Number),[a,l]=e.end_time.split(":").map(Number);y+=Math.max(0,60*a+l-(60*t+s))/60}else y+=Number(t.doctor_hours_per_shift)||3.5});let v=Number(t.insurance_labor)||0,_=Number(t.insurance_health)||0,w=Number(t.doctor_hourly_rate)||0,k=t.doctor_base_mode||"guarantee",S={mode:k,licenseFee:Number(t.doctor_license_fee)||0,guarantee:Number(t.doctor_guarantee_salary)||0,hourlyRate:w,actualHours:y,standardHours:0,workPay:0,adjustment:0,finalBase:0,insurance_labor:v,insurance_health:_};if("license"===k)S.workPay=Math.round(y*w),S.finalBase=S.licenseFee+S.workPay;else{let e=Number(t.doctor_shifts_per_week)||0;S.standardHours=e*(Number(t.doctor_hours_per_shift)||3.5)/7*30,S.adjustment=Math.round((y-S.standardHours)*w),S.finalBase=S.guarantee+S.adjustment}if(a)return;p(S)}catch(e){a||console.error("Doctor salary load error:",e)}};return l(),()=>{a=!0}},[d,e,s,n]);let Z=async()=>{try{let e=await fetch("/api/staff?role=é†«å¸«"),t=await e.json();t.data&&(i(t.data),t.data.length>0&&o(e=>e??t.data[0].id))}catch(e){console.error("Error fetching doctors:",e)}},D=(e,t,s,a)=>{let l=[...u[e]];l[t]={...l[t],[s]:a},b(t=>({...t,[e]:l}))},E=(e,t)=>{b(s=>({...s,[e]:s[e].filter((e,s)=>s!==t)}))},F=e=>{b(t=>({...t,[e]:[...t[e],{id:Date.now(),name:"extra_items"===e?"é …ç›®":"è‡ªè²»",amount:0,rate:"self_pay_items"===e?30:void 0}]}))},M=s=>{let[a,l]=e.split("-").map(Number),r=new Date(a,l-1,1);"prev"===s?r.setMonth(r.getMonth()-1):r.setMonth(r.getMonth()+1);let n=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`;t(n)},O=(()=>{let e=n.find(e=>e.id===d),t=Number(e?.doctor_nhi_rate)||.8,s=u.nhi_points*t-u.reg_fee_deduction,a=u.self_pay_items.reduce((e,t)=>e+Number(t.amount)*(Number(t.rate)/100),0),l=u.extra_items.reduce((e,t)=>e+Number(t.amount),0),r=Math.round(s),i=Math.max(0,r-u.past_base_salary);return{nhiTotal:s,selfPayTotal:a,extraTotal:l,totalPerformance:r,bonus:i,nhiRate:t}})(),P=n.find(e=>e.id===d),A="locked"===u.status,I=(h.finalBase||0)+O.bonus+O.selfPayTotal+O.extraTotal-(h.insurance_labor||0)-(h.insurance_health||0),H=I-u.transfer_amount,J=async t=>{if(!d)return alert("è«‹å…ˆé¸æ“‡é†«å¸«");_(!0);try{let a={snapshot_actual_hours:h.actualHours??0,snapshot_standard_hours:h.standardHours??0,snapshot_hourly_rate:h.hourlyRate??0,snapshot_guarantee:h.guarantee??0,snapshot_license_fee:h.licenseFee??0,snapshot_mode:h.mode??"guarantee",snapshot_roster:Array.isArray(x)?x:[]},l=await fetch("/api/doctor/ppf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({doctor_id:d,target_month:s,patient_count:u.patient_count,nhi_points:u.nhi_points,reg_fee_deduction:u.reg_fee_deduction,clinic_days:u.clinic_days,transfer_amount:u.transfer_amount,actual_base_pay:h.finalBase,self_pay_items:u.self_pay_items,extra_items:u.extra_items,total_performance:O.totalPerformance,base_salary_at_time:u.past_base_salary,final_ppf_bonus:O.bonus,paid_in_month:e,status:t,net_pay:I,cash_amount:H,...a})}),r=await l.json();if(_(!1),r.error)alert("å„²å­˜å¤±æ•—: "+r.error);else{if("locked"===t){let e=u.self_pay_items.map(e=>({name:e.name,rate:e.rate}));await fetch("/api/staff",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:d,doctor_self_pay_template:e})})}b(e=>({...e,status:t})),alert("locked"===t?"âœ… å·²çµç®—ä¸¦å°å­˜ï¼":"\uD83D\uDCBE è‰ç¨¿å·²æš«å­˜")}}catch(e){_(!1),alert("å„²å­˜å¤±æ•—: "+e.message)}};return(0,a.jsxs)("div",{className:"w-full animate-fade-in p-4 pb-24",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6 bg-white p-4 rounded-xl shadow-sm border",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold flex items-center gap-2 text-slate-800",children:[a.jsx(c.Z,{className:"text-teal-600"})," é†«å¸«è–ªè³‡çµç®—"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-slate-50 p-2 rounded-lg border",children:[a.jsx("button",{onClick:()=>M("prev"),className:"p-1.5 hover:bg-slate-200 rounded transition-colors flex items-center justify-center",title:"ä¸Šå€‹æœˆ",children:a.jsx(N.Z,{size:18,className:"text-slate-600"})}),a.jsx("span",{className:"text-sm font-bold text-slate-500",children:"ç™¼è–ªæœˆä»½:"}),a.jsx("input",{type:"month",value:e,onChange:e=>t(e.target.value),className:"bg-transparent font-bold text-slate-700 outline-none min-w-[140px]"}),a.jsx("button",{onClick:()=>M("next"),className:"p-1.5 hover:bg-slate-200 rounded transition-colors flex items-center justify-center",title:"ä¸‹å€‹æœˆ",children:a.jsx(y.Z,{size:18,className:"text-slate-600"})})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 overflow-x-auto pb-4 mb-2 items-center",children:[n.map(e=>a.jsx("button",{onClick:()=>o(e.id),className:`px-4 py-2 rounded-full font-bold whitespace-nowrap transition ${d===e.id?"bg-teal-600 text-white shadow-lg":"bg-white text-slate-500 border hover:bg-slate-50"}`,children:e.name},e.id)),d&&(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"w-px h-6 bg-slate-300 mx-2"}),(0,a.jsxs)("button",{onClick:()=>S(!0),className:"flex items-center gap-1 px-3 py-1.5 rounded-full border border-slate-300 text-slate-600 text-xs font-bold hover:bg-slate-100",children:[a.jsx(f.Z,{size:14})," åƒæ•¸"]}),(0,a.jsxs)("button",{onClick:()=>$(!0),className:`flex items-center gap-1 px-3 py-1.5 rounded-full border text-xs font-bold ${h?"border-blue-300 text-blue-600 hover:bg-blue-50":"border-gray-200 text-gray-300 cursor-not-allowed"}`,children:[a.jsx(eL.Z,{size:14})," è–ªè³‡å–®"]})]})]}),k&&P&&a.jsx(eV,{doctor:P,onClose:()=>S(!1),onUpdate:()=>Z()}),C&&P&&a.jsx(eG.Z,{data:{doctorName:P.name,baseAmount:"license"===h.mode?h.licenseFee:h.guarantee,workAmount:"license"===h.mode?h.workPay:h.adjustment,ppfBonus:O.bonus,extraTotal:O.extraTotal,insLabor:h.insurance_labor||0,insHealth:h.insurance_health||0,netPay:I,hourlyRate:h.hourlyRate,actualHours:h.actualHours,standardHours:h.standardHours,grossBasePay:h.finalBase,transfer_amount:u.transfer_amount,cash_amount:H},roster:x,ppfDetails:{...u,target_month:s,selfPayTotal:O.selfPayTotal,nhiRate:O.nhiRate,base_salary_at_time:u.past_base_salary,totalPerformance:O.totalPerformance},month:e,onClose:()=>$(!1)}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 items-start",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-200 h-fit",children:[(0,a.jsxs)("h3",{className:"font-bold text-lg text-slate-700 mb-4 border-b pb-2 flex justify-between",children:[(0,a.jsxs)("span",{children:["1. ç•¶æœˆä¿éšœè–ª (",e,")"]}),a.jsx("span",{className:"text-xs bg-slate-100 text-slate-500 px-2 py-1 rounded",children:h?.mode==="license"?"æ›ç‰Œè²»æ¨¡å¼":"å›ºå®šä¿éšœæ¨¡å¼"})]}),(0,a.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-slate-500",children:"license"===h.mode?"æ›ç‰Œè²»":"ä¿éšœè–ª"}),(0,a.jsxs)("span",{className:"font-bold text-lg",children:["$",("license"===h.mode?h.licenseFee:h.guarantee).toLocaleString()]})]}),(0,a.jsxs)("div",{className:"bg-slate-50 p-3 rounded space-y-2 border",children:["license"!==h.mode&&(0,a.jsxs)("div",{className:"flex justify-between text-xs text-slate-500",children:[a.jsx("span",{children:"æ¨™æº–å·¥æ™‚"}),(0,a.jsxs)("span",{children:[h.standardHours.toFixed(1)," hr"]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-xs",children:[a.jsx("span",{children:"å¯¦éš›å·¥æ™‚"}),(0,a.jsxs)("span",{className:"font-bold",children:[h.actualHours.toFixed(1)," hr"]})]}),(0,a.jsxs)("div",{className:"flex justify-between border-t border-slate-200 pt-2",children:[a.jsx("span",{className:"text-slate-500",children:"å·¥æ™‚èª¿æ•´/æ™‚è–ª"}),(0,a.jsxs)("span",{className:`font-bold ${"license"===h.mode?"text-green-600":h.adjustment<0?"text-red-500":"text-green-600"}`,children:["$",("license"===h.mode?h.workPay:h.adjustment).toLocaleString()]})]})]}),(0,a.jsxs)("div",{className:"border-t pt-3 flex justify-between items-center",children:[a.jsx("span",{className:"font-bold text-slate-700",children:"ä¿éšœè–ªæ¯›é¡ (A)"}),(0,a.jsxs)("span",{className:"text-2xl font-extrabold text-teal-700",children:["$",h.finalBase.toLocaleString()]})]}),a.jsx("div",{className:"text-xs text-slate-400 text-center",children:"*å‹å¥ä¿å°‡æ–¼ç‰¹æ®Šè²»ç”¨æ¬„ä½çµ±ä¸€æ‰£é™¤"})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:`bg-white rounded-xl shadow-sm border overflow-hidden ${A?"border-gray-300":"border-slate-200"}`,children:[(0,a.jsxs)("div",{className:`p-6 space-y-4 text-sm ${A?"opacity-70 pointer-events-none grayscale bg-gray-50":""}`,children:[(0,a.jsxs)("h3",{className:"font-bold text-lg text-slate-700 border-b pb-2 flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("span",{children:"2. PPF æ¥­ç¸¾çµç®—"}),A?(0,a.jsxs)("span",{className:"bg-gray-600 text-white text-[10px] px-2 py-0.5 rounded flex items-center gap-1",children:[a.jsx(g.Z,{size:10})," å·²å°å­˜"]}):(0,a.jsxs)("span",{className:"bg-blue-100 text-blue-600 text-[10px] px-2 py-0.5 rounded flex items-center gap-1",children:[a.jsx(eY.Z,{size:10})," ç·¨è¼¯ä¸­"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs font-normal",children:[a.jsx("span",{children:"çµç®—:"}),a.jsx("input",{type:"month",value:s,onChange:e=>r(e.target.value),className:"border rounded p-1 bg-slate-50"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 bg-teal-50/50 p-3 rounded border border-teal-100",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-xs font-bold text-slate-500 block mb-1",children:"çœ‹è¨ºäººæ•¸"}),a.jsx("input",{type:"number",value:u.patient_count,onChange:e=>b(t=>({...t,patient_count:Number(e.target.value)})),className:"w-full border p-2 rounded text-right font-bold"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-xs font-bold text-slate-500 block mb-1",children:"å¥ä¿é»æ•¸"}),a.jsx("input",{type:"number",value:u.nhi_points,onChange:e=>b(t=>({...t,nhi_points:Number(e.target.value)})),className:"w-full border p-2 rounded text-right font-bold text-blue-700"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("label",{className:"text-xs font-bold text-slate-500",children:"çœ‹è¨ºå¤©æ•¸:"}),a.jsx("input",{type:"number",value:u.clinic_days,onChange:e=>b(t=>({...t,clinic_days:Number(e.target.value)})),className:"w-20 border-b border-teal-200 text-right font-bold outline-none"}),a.jsx("span",{className:"text-xs text-slate-400",children:"å¤©"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-slate-500 px-1",children:[(0,a.jsxs)("span",{children:["å¥ä¿è¨ºå¯Ÿè²»æŠ½æˆç‡: ",(100*O.nhiRate).toFixed(0),"%"]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-red-400",children:"æ›è™Ÿè²»æ¸›å…æ‰£é™¤é¡:"}),a.jsx("input",{type:"number",value:u.reg_fee_deduction,onChange:e=>b(t=>({...t,reg_fee_deduction:Number(e.target.value)})),className:"w-20 border-b border-red-200 text-right text-red-500 outline-none bg-transparent"})]})]})]}),(0,a.jsxs)("div",{className:"bg-slate-800 text-white p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm opacity-80",children:[a.jsx("span",{children:"å¥ä¿ç¸½ç”¢å€¼"}),(0,a.jsxs)("span",{children:["$",O.totalPerformance.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm opacity-80 items-center",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1",children:["æ‰£é™¤: ",s," å¯¦é ˜ä¿éšœè–ª"]}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx("input",{type:"number",value:u.past_base_salary,onChange:e=>b(t=>({...t,past_base_salary:Number(e.target.value)})),className:"w-24 text-right border-b border-slate-500 bg-transparent rounded px-2 py-0.5 text-white outline-none focus:border-yellow-400 transition"}),a.jsx(eB.Z,{size:12,className:"absolute right-1 top-1.5 text-slate-400 pointer-events-none opacity-50"})]})]}),(0,a.jsxs)("div",{className:"flex justify-between pt-3 border-t border-slate-600 font-bold text-yellow-400 text-lg",children:[a.jsx("span",{children:"PPF è¶…é¡çé‡‘ (B)"}),(0,a.jsxs)("span",{children:["$",O.bonus.toLocaleString()]})]})]})]}),(0,a.jsxs)("div",{className:`bg-white p-6 rounded-xl shadow-sm border border-slate-200 ${A?"opacity-70 pointer-events-none grayscale":""}`,children:[(0,a.jsxs)("h3",{className:"font-bold text-lg text-slate-700 mb-4 border-b pb-2 flex justify-between items-center",children:[a.jsx("span",{children:"3. ç‰¹æ®Šè²»ç”¨ / æ‰£é™¤é¡"}),a.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded",children:"ä¸åƒèˆ‡ PPF æ‰£æŠµ"})]}),(0,a.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center bg-red-50 p-2 rounded border border-red-100 text-xs",children:[(0,a.jsxs)("span",{className:"font-bold text-red-800 flex items-center gap-1",children:[a.jsx(j.Z,{size:12})," å‹ä¿è‡ªä»˜ (å›ºå®š)"]}),(0,a.jsxs)("span",{className:"font-mono font-bold text-red-600",children:["-$",h.insurance_labor.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center bg-red-50 p-2 rounded border border-red-100 text-xs",children:[(0,a.jsxs)("span",{className:"font-bold text-red-800 flex items-center gap-1",children:[a.jsx(j.Z,{size:12})," å¥ä¿è‡ªä»˜ (å›ºå®š)"]}),(0,a.jsxs)("span",{className:"font-mono font-bold text-red-600",children:["-$",h.insurance_health.toLocaleString()]})]})]}),(0,a.jsxs)("div",{className:"border-t pt-4 mb-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("label",{className:"font-bold text-slate-600",children:"è‡ªè²»é …ç›® (å¦è¡Œè¨ˆç®—)"}),(0,a.jsxs)("span",{className:"text-xs text-purple-600 font-bold",children:["ç¸½è¨ˆ: $",O.selfPayTotal.toLocaleString()]})]}),u.self_pay_items.map((e,t)=>(0,a.jsxs)("div",{className:"flex gap-2 mb-2 items-center",children:[a.jsx("input",{value:e.name,onChange:e=>D("self_pay_items",t,"name",e.target.value),className:"w-1/3 border p-1 rounded text-xs",placeholder:"é …ç›®åç¨±"}),a.jsx("input",{type:"number",value:e.amount,onChange:e=>D("self_pay_items",t,"amount",Number(e.target.value)),className:"w-1/4 border p-1 rounded text-xs text-right",placeholder:"é‡‘é¡"}),(0,a.jsxs)("div",{className:"flex items-center gap-1 w-1/4",children:[a.jsx("input",{type:"number",value:e.rate,onChange:e=>D("self_pay_items",t,"rate",Number(e.target.value)),className:"w-full border p-1 rounded text-xs text-center",placeholder:"æŠ½æˆ"}),a.jsx("span",{className:"text-xs",children:"%"})]}),a.jsx("button",{onClick:()=>E("self_pay_items",t),className:"text-red-300 hover:text-red-500",children:a.jsx(T.Z,{size:16})})]},e.id)),a.jsx("button",{onClick:()=>F("self_pay_items"),className:"w-full border border-dashed border-purple-200 text-purple-600 p-1 rounded text-xs hover:bg-purple-50",children:"+ æ–°å¢è‡ªè²»é …ç›®"})]}),u.extra_items.map((e,t)=>(0,a.jsxs)("div",{className:"flex gap-2 mb-2 items-center",children:[a.jsx("input",{value:e.name,onChange:e=>D("extra_items",t,"name",e.target.value),className:"w-2/3 border p-1 rounded text-xs",placeholder:"ä¾‹å¦‚ï¼šè»Šé¦¬è²»"}),a.jsx("input",{type:"number",value:e.amount,onChange:e=>D("extra_items",t,"amount",Number(e.target.value)),className:"w-1/3 border p-1 rounded text-xs text-right",placeholder:"+/-"}),a.jsx("button",{onClick:()=>E("extra_items",t),className:"text-red-300 hover:text-red-500",children:a.jsx(T.Z,{size:16})})]},e.id)),a.jsx("button",{onClick:()=>F("extra_items"),className:"w-full border border-dashed border-purple-200 text-purple-600 p-1 rounded text-xs hover:bg-purple-50",children:"+ æ–°å¢ç‰¹æ®Šè²»ç”¨"})]})]})]}),a.jsx("div",{className:"fixed bottom-0 left-0 w-full bg-white border-t p-4 shadow-[0_-5px_15px_rgba(0,0,0,0.05)] z-40",children:(0,a.jsxs)("div",{className:"max-w-[1600px] mx-auto flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-8",children:[(0,a.jsxs)("div",{children:[a.jsx("span",{className:"block text-xs text-slate-400",children:"æœ¬æœˆå¯¦é ˜ç¸½é¡ (Net Pay)"}),(0,a.jsxs)("span",{className:"text-3xl font-extrabold text-slate-800",children:["$",I.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 bg-slate-100 p-2 rounded-lg border border-slate-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[a.jsx(eR.Z,{size:16,className:"text-slate-500"}),a.jsx("span",{className:"text-xs font-bold text-slate-600",children:"åŒ¯æ¬¾:"}),a.jsx("input",{type:"number",value:u.transfer_amount,onChange:e=>b(t=>({...t,transfer_amount:Number(e.target.value)})),className:"w-24 border-b border-slate-300 bg-transparent text-right font-bold text-slate-800 focus:outline-none focus:border-blue-500",disabled:A})]}),a.jsx("div",{className:"w-px h-4 bg-slate-300"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-bold text-slate-600",children:"ç¾é‡‘:"}),(0,a.jsxs)("span",{className:"font-bold text-green-600",children:["$",H.toLocaleString()]})]})]})]}),a.jsx("div",{className:"flex gap-4",children:A?(0,a.jsxs)("button",{onClick:()=>J("draft"),className:"border border-red-200 text-red-600 px-6 py-3 rounded-xl font-bold flex items-center gap-2 hover:bg-red-50 transition",disabled:v,children:[a.jsx(eq.Z,{size:18})," è§£é™¤å°å­˜"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:()=>J("draft"),className:"border border-blue-200 text-blue-600 px-6 py-3 rounded-xl font-bold flex items-center gap-2 hover:bg-blue-50 transition",disabled:v,children:[a.jsx(w.Z,{size:18})," æš«å­˜è‰ç¨¿"]}),(0,a.jsxs)("button",{onClick:()=>J("locked"),className:"bg-slate-900 hover:bg-black text-white px-8 py-3 rounded-xl font-bold flex items-center gap-2 transition shadow-lg",disabled:v,children:[a.jsx(g.Z,{size:18})," çµç®—ä¸¦å°å­˜"]})]})})]})})]})}let eQ=()=>{let e=new Date;return e.setMonth(e.getMonth()-1),e.toISOString().slice(0,7)};function eK(){let e=eQ(),[t,s]=(0,l.useState)(!1),[r,n]=(0,l.useState)(e),[i,d]=(0,l.useState)(e),[o,c]=(0,l.useState)(e),[x,m]=(0,l.useState)("all"),[h,u]=(0,l.useState)([]),[b,f]=(0,l.useState)("all"),[g,j]=(0,l.useState)([]),[v,_]=(0,l.useState)(!1);(0,l.useEffect)(()=>{w()},[]),(0,l.useEffect)(()=>{k()},[t,r,i,o,x,b]);let w=async()=>{try{let e=await fetch("/api/staff"),t=await e.json();t.data&&u(t.data.map(e=>({id:e.id,name:e.name,role:e.role})))}catch(e){console.error("Fetch staff list error:",e)}},k=async()=>{_(!0);try{let e=new URLSearchParams({useDateFilter:String(t),roleFilter:x,selectedStaffId:b});t?(e.append("startMonth",r),e.append("endMonth",i)):e.append("month",o);let s=await fetch(`/api/report/salary?${e.toString()}`),a=await s.json();a.error?(console.error("Error:",a.error),j([])):j(a.data||[])}catch(e){console.error("Fetch report error:",e),j([])}finally{_(!1)}},S=(e,t="month")=>{let s="month"===t?o:"startMonth"===t?r:i,[a,l]=s.split("-").map(Number),x=new Date(a,l-1,1);"prev"===e?x.setMonth(x.getMonth()-1):x.setMonth(x.getMonth()+1);let m=`${x.getFullYear()}-${String(x.getMonth()+1).padStart(2,"0")}`;"month"===t?c(m):"startMonth"===t?n(m):d(m)},C=e=>{let[t,s]=r.split("-").map(Number),[a,l]=i.split("-").map(Number),o=new Date(t,s-1,1),c=new Date(a,l-1,1);"prev"===e?(o.setMonth(o.getMonth()-1),c.setMonth(c.getMonth()-1)):(o.setMonth(o.getMonth()+1),c.setMonth(c.getMonth()+1));let x=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}`,m=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`;n(x),d(m)},$=g.reduce((e,t)=>e+t.total,0);return(0,a.jsxs)("div",{className:"w-full animate-fade-in p-4",children:[(0,a.jsxs)("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex flex-wrap justify-between items-center gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-slate-800 flex items-center gap-2",children:[a.jsx(p.Z,{className:"text-blue-600"})," äººäº‹æ”¯å‡ºçµ±è¨ˆ"]}),a.jsx("div",{className:"h-8 w-px bg-slate-200 mx-2 hidden md:block"}),(0,a.jsxs)("button",{onClick:()=>s(!t),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border text-sm font-bold transition ${t?"bg-blue-50 border-blue-200 text-blue-700":"bg-slate-50 border-slate-200 text-slate-500"}`,children:[t?a.jsx(V.Z,{size:20,className:"text-blue-600"}):a.jsx(X.Z,{size:20,className:"text-slate-400"})," æœˆä»½ç¯©é¸"]}),t?(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-slate-50 p-1.5 rounded-lg border text-sm animate-fade-in",children:[a.jsx("button",{onClick:()=>C("prev"),className:"p-1 hover:bg-slate-200 rounded transition-colors flex items-center justify-center",title:"å¾€å‰ä¸€å€‹æœˆ",children:a.jsx(N.Z,{size:18,className:"text-slate-600"})}),a.jsx("span",{className:"text-slate-500 pl-1",children:"å€é–“:"}),a.jsx("input",{type:"month",value:r,onChange:e=>n(e.target.value),className:"bg-transparent font-bold text-slate-700 outline-none min-w-[140px]"}),a.jsx("span",{className:"text-slate-400",children:"~"}),a.jsx("input",{type:"month",value:i,onChange:e=>d(e.target.value),className:"bg-transparent font-bold text-slate-700 outline-none min-w-[140px]"}),a.jsx("button",{onClick:()=>C("next"),className:"p-1 hover:bg-slate-200 rounded transition-colors flex items-center justify-center",title:"å¾€å¾Œä¸€å€‹æœˆ",children:a.jsx(y.Z,{size:18,className:"text-slate-600"})})]}):(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-slate-50 p-1.5 rounded-lg border text-sm animate-fade-in",children:[a.jsx("button",{onClick:()=>S("prev"),className:"p-1 hover:bg-slate-200 rounded transition-colors flex items-center justify-center",title:"ä¸Šå€‹æœˆ",children:a.jsx(N.Z,{size:18,className:"text-slate-600"})}),a.jsx("span",{className:"text-slate-500 pl-1",children:"æœˆä»½:"}),a.jsx("input",{type:"month",value:o,onChange:e=>c(e.target.value),className:"bg-transparent font-bold text-slate-700 outline-none min-w-[140px]"}),a.jsx("button",{onClick:()=>S("next"),className:"p-1 hover:bg-slate-200 rounded transition-colors flex items-center justify-center",title:"ä¸‹å€‹æœˆ",children:a.jsx(y.Z,{size:18,className:"text-slate-600"})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-slate-50 p-1.5 rounded-lg border text-sm",children:[a.jsx(eD.Z,{size:16,className:"text-slate-400 ml-2"}),(0,a.jsxs)("select",{value:x,onChange:e=>m(e.target.value),className:"bg-transparent font-bold text-slate-700 outline-none pr-2 border-r mr-2",children:[a.jsx("option",{value:"all",children:"æ‰€æœ‰è·é¡"}),a.jsx("option",{value:"doctor",children:"é†«å¸«"}),a.jsx("option",{value:"staff",children:"å“¡å·¥"})]}),a.jsx(K.Z,{size:16,className:"text-slate-400"}),(0,a.jsxs)("select",{value:b,onChange:e=>f(e.target.value),className:"bg-transparent font-bold text-slate-700 outline-none pr-2",children:[a.jsx("option",{value:"all",children:"æ‰€æœ‰äººå“¡"}),h.filter(e=>"all"===x||("doctor"===x?"é†«å¸«"===e.role:"é†«å¸«"!==e.role)).map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," (",e.role,")"]},e.id))]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"text-right",children:[a.jsx("span",{className:"block text-xs text-slate-400",children:"æœŸé–“ç¸½æ”¯å‡º"}),(0,a.jsxs)("span",{className:"text-2xl font-black text-slate-800",children:["$",$.toLocaleString()]})]}),(0,a.jsxs)("button",{onClick:()=>{if(0===g.length)return alert("ç„¡è³‡æ–™å¯åŒ¯å‡º");let e=g.map(e=>[e.displayType,e.name,e.month,e.total,e.details]),s="\uFEFF"+["è·ç¨±,å§“å,æœˆä»½,å¯¦é ˜ç¸½é¡,å‚™è¨»",...e.map(e=>e.join(","))].join("\n"),a=new Blob([s],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),n=URL.createObjectURL(a);l.setAttribute("href",n),l.setAttribute("download",`äººäº‹æ”¯å‡ºå ±è¡¨_${t?r+"_"+i:o}.csv`),document.body.appendChild(l),l.click(),document.body.removeChild(l)},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2 transition shadow text-sm",children:[a.jsx(p.Z,{size:18})," åŒ¯å‡ºå ±è¡¨"]})]})]}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:(0,a.jsxs)("table",{className:"w-full text-left border-collapse",children:[a.jsx("thead",{className:"bg-slate-50 text-slate-500 font-bold text-sm border-b",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"p-4 w-24",children:"é¡åˆ¥"}),a.jsx("th",{className:"p-4",children:"å§“å"}),a.jsx("th",{className:"p-4",children:"æœˆä»½"}),a.jsx("th",{className:"p-4 text-right",children:"å¯¦é ˜ç¸½é¡ (Net Pay)"}),a.jsx("th",{className:"p-4 text-slate-400",children:"è©³ç´°è³‡è¨Š"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-100 text-sm",children:v?a.jsx("tr",{children:a.jsx("td",{colSpan:5,className:"p-8 text-center text-slate-400",children:"è¼‰å…¥ä¸­..."})}):0===g.length?a.jsx("tr",{children:a.jsx("td",{colSpan:5,className:"p-8 text-center text-slate-400",children:"ç„¡è³‡æ–™ (é†«å¸«éœ€å…ˆåŸ·è¡Œã€Œçµç®—å°å­˜ã€)"})}):g.map((e,t)=>(0,a.jsxs)("tr",{className:"hover:bg-slate-50 transition",children:[a.jsx("td",{className:"p-4",children:a.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${"doctor"===e.type?"bg-teal-100 text-teal-700":"bg-blue-100 text-blue-700"}`,children:e.displayType})}),(0,a.jsxs)("td",{className:"p-4 font-bold text-slate-700 flex items-center gap-2",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-xs text-slate-500",children:e.name?.slice(0,1)}),e.name]}),a.jsx("td",{className:"p-4 font-mono text-slate-600",children:e.month}),(0,a.jsxs)("td",{className:"p-4 text-right font-bold text-slate-900 text-lg",children:["$",e.total.toLocaleString()]}),a.jsx("td",{className:"p-4 text-xs text-slate-400 font-mono",children:e.details})]},t))})]})})]})}var e0=s(81057);let e1=e=>new Date(e).toLocaleString("zh-TW",{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}),e2=e=>new Date(e).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"}),e4={pending:"å¾…å¯©æ ¸",approved:"å·²é€šé",rejected:"å·²é§å›",all:"å…¨éƒ¨"},e5={leave:"è«‹å‡",overtime:"åŠ ç­",anomaly:"ç•°å¸¸"};function e6(){let[e,t]=(0,l.useState)([]),[s,r]=(0,l.useState)(!0),[n,d]=(0,l.useState)("pending"),[c,m]=(0,l.useState)("all");(0,l.useEffect)(()=>{h()},[n,c]);let h=async()=>{r(!0);try{let e=await fetch("/api/admin/tasks"),s=await e.json();if(s.error)console.error("Error:",s.error),t([]);else{let e=s.data||[];"all"!==n&&(e=e.filter(e=>e.status===n)),"all"!==c&&(e=e.filter(e=>e.type===c)),t(e)}}catch(e){console.error("Fetch tasks error:",e),t([])}finally{r(!1)}},p=async(t,s)=>{let a=e.find(e=>e.id===t&&"overtime"===e.type);if(!a)return;let l="approved"===s?"æ ¸å‡†":"é§å›";if(confirm(`ç¢ºå®šè¦${l} ${a.staff_name} çš„åŠ ç­ç”³è«‹å—ï¼Ÿ`))try{let e=await fetch("/api/attendance",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t,overtime_status:s})}),a=await e.json();a.success?(alert(`âœ… åŠ ç­ç”³è«‹å·²${l}`),h()):alert(`âŒ ${l}å¤±æ•—: ${a.message||"æœªçŸ¥éŒ¯èª¤"}`)}catch(e){console.error("Overtime action error:",e),alert(`âŒ ${l}å¤±æ•—: ${e.message}`)}},u=async e=>{if("overtime"===e.type){await p(e.id,"approved");return}let t=e.staff_name||"æœªçŸ¥å“¡å·¥";if(confirm(`ç¢ºå®šè¦æ ¸å‡† ${t} çš„ ${e.type}${e.leave_type?` (${e.leave_type})`:""} ç”³è«‹å—ï¼Ÿ`))try{if("è£œæ‰“å¡"===e.type||e._raw&&"è£œæ‰“å¡"===e._raw.type){let s=e.start_time.split("T")[0],a=e.start_time,l=e.end_time;if("å…¨å¤©"===e.leave_type){new Date(l).getTime(),new Date(a).getTime();let e=await fetch("/api/attendance/punch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"full",staff_name:t,date:s,start_time:a,end_time:l,action:"insert",anomaly_reason:"è£œæ‰“å¡æ ¸å‡†(å…¨å¤©)"})}),r=await e.json();if(!r.success)throw Error(r.message||"æ–°å¢è€ƒå‹¤è¨˜éŒ„å¤±æ•—")}else if("ä¸Šç­"===e.leave_type){let e=await fetch(`/api/attendance/punch?staff_name=${encodeURIComponent(t)}&date=${s}&type=orphan`),l=await e.json();if(l.data){new Date(l.data.clock_out_time).getTime(),new Date(a).getTime();let e=await fetch("/api/attendance/punch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"clock_in",staff_name:t,date:s,start_time:a,action:"update",target_id:l.data.id,anomaly_reason:(l.data.anomaly_reason||"")+", è£œä¸Šç­æ ¸å‡†"})}),r=await e.json();if(!r.success)throw Error(r.message||"æ›´æ–°è€ƒå‹¤è¨˜éŒ„å¤±æ•—")}else{let e=await fetch("/api/attendance/punch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"clock_in",staff_name:t,date:s,start_time:a,action:"insert",anomaly_reason:"è£œä¸Šç­æ ¸å‡†"})}),l=await e.json();if(!l.success)throw Error(l.message||"æ–°å¢è€ƒå‹¤è¨˜éŒ„å¤±æ•—")}}else if("ä¸‹ç­"===e.leave_type){let e=await fetch(`/api/attendance/punch?staff_name=${encodeURIComponent(t)}&date=${s}&type=working`),l=await e.json();if(l.data){let e=await fetch("/api/attendance/punch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"clock_out",staff_name:t,date:s,start_time:l.data.clock_in_time,end_time:a,action:"update",target_id:l.data.id,anomaly_reason:(l.data.anomaly_reason||"")+", è£œä¸‹ç­æ ¸å‡†"})}),r=await e.json();if(!r.success)throw Error(r.message||"æ›´æ–°è€ƒå‹¤è¨˜éŒ„å¤±æ•—")}else{let e=await fetch("/api/attendance/punch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"clock_out",staff_name:t,date:s,start_time:a,end_time:a,action:"insert",anomaly_reason:"å–®ç¨è£œä¸‹ç­(ç­‰å¾…è£œä¸Šç­)"})}),l=await e.json();if(!l.success)throw Error(l.message||"æ–°å¢è€ƒå‹¤è¨˜éŒ„å¤±æ•—")}}}let s=await fetch("/api/leave",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id,status:"approved"})}),a=await s.json();if(!a.success)throw Error(a.message||"æ›´æ–°ç”³è«‹å–®ç‹€æ…‹å¤±æ•—");alert("âœ… å·²æ ¸å‡†ï¼Œä¸¦åŒæ­¥è‡³è€ƒå‹¤ç³»çµ±ï¼"),h()}catch(e){alert("âŒ æ ¸å‡†å¤±æ•—ï¼š"+e.message)}},b=async e=>{if("overtime"===e.type){await p(e.id,"rejected");return}if(confirm("ç¢ºå®šè¦é§å›æ­¤ç”³è«‹å—ï¼Ÿ"))try{let t=await fetch("/api/leave",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id,status:"rejected"})}),s=await t.json();s.success?h():alert("é§å›å¤±æ•—: "+s.message)}catch(e){console.error("Reject error:",e),alert("é§å›å¤±æ•—")}};return(0,a.jsxs)("div",{className:"w-full animate-fade-in p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold text-slate-800 flex items-center gap-3",children:[a.jsx(i.Z,{className:"text-teal-600",size:32})," å¾…è¾¦äº‹é …å¯©æ ¸"]}),a.jsx("p",{className:"text-slate-500 mt-2",children:"è™•ç†å“¡å·¥çš„è«‹å‡ã€åŠ ç­èˆ‡ç•°å¸¸æ‰“å¡ç”³è«‹ã€‚"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[a.jsx("div",{className:"flex bg-white rounded-lg shadow-sm p-1 border border-slate-200",children:["all","leave","overtime","anomaly"].map(e=>a.jsx("button",{onClick:()=>m(e),className:`px-4 py-2 rounded-md text-sm font-bold transition whitespace-nowrap ${c===e?"bg-blue-100 text-blue-800":"text-slate-500 hover:bg-slate-50"}`,children:"all"===e?"å…¨éƒ¨":e5[e]},e))}),a.jsx("div",{className:"flex bg-white rounded-lg shadow-sm p-1 border border-slate-200",children:["pending","approved","rejected","all"].map(e=>a.jsx("button",{onClick:()=>d(e),className:`px-4 py-2 rounded-md text-sm font-bold transition ${n===e?"bg-teal-100 text-teal-800":"text-slate-500 hover:bg-slate-50"}`,children:e4[e]},e))})]})]}),s?a.jsx("div",{className:"text-center py-20 text-slate-400",children:"è¼‰å…¥ä¸­..."}):0===e.length?(0,a.jsxs)("div",{className:"text-center py-20 bg-white rounded-xl border border-dashed border-slate-300",children:[a.jsx(i.Z,{className:"mx-auto text-slate-300 mb-4",size:48}),a.jsx("p",{className:"text-slate-500 font-bold",children:"ç›®å‰æ²’æœ‰æ¡ˆä»¶ \uD83C\uDF89"})]}):a.jsx("div",{className:"grid gap-4",children:e.map(e=>(0,a.jsxs)("div",{className:`bg-white p-6 rounded-xl shadow-sm border-l-4 flex justify-between items-center transition hover:shadow-md ${"pending"===e.status?"border-yellow-400":"approved"===e.status?"border-green-500":"border-red-500"}`,children:[(0,a.jsxs)("div",{className:"flex items-start gap-4 flex-1",children:[a.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center shrink-0 ${"overtime"===e.type?"bg-orange-100":"anomaly"===e.type?"bg-red-100":"bg-purple-100"}`,children:"overtime"===e.type?a.jsx(v.Z,{size:24,className:"text-orange-600"}):"anomaly"===e.type?a.jsx(et.Z,{size:24,className:"text-red-600"}):a.jsx(o.Z,{size:24,className:"text-purple-600"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[a.jsx("span",{className:"text-lg font-bold text-slate-800",children:e.staff_name}),a.jsx("span",{className:`px-2 py-0.5 text-xs rounded font-bold border ${"overtime"===e.type?"bg-orange-100 text-orange-600 border-orange-200":"anomaly"===e.type?"bg-red-100 text-red-600 border-red-200":"bg-purple-100 text-purple-600 border-purple-200"}`,children:e5[e.type]}),"pending"!==e.status&&a.jsx("span",{className:`px-2 py-0.5 text-xs rounded font-bold ${"approved"===e.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:"approved"===e.status?"å·²é€šé":"å·²é§å›"})]}),(0,a.jsxs)("div",{className:"text-slate-500 text-sm space-y-1",children:["overtime"===e.type&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(o.Z,{size:14}),(0,a.jsxs)("span",{className:"font-bold",children:["æ—¥æœŸï¼š",e.date]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(v.Z,{size:14}),(0,a.jsxs)("span",{className:"font-mono",children:["ä¸Šç­ï¼š",e.clock_in_time?e2(e.clock_in_time):"--"," â†’ ","ä¸‹ç­ï¼š",e.clock_out_time?e2(e.clock_out_time):"--"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-orange-600 font-bold",children:[a.jsx(v.Z,{size:14}),(0,a.jsxs)("span",{children:["ç¸½å·¥æ™‚ï¼š",e.work_hours?.toFixed(1)||"0"," å°æ™‚"]}),e.overtime_hours>0&&(0,a.jsxs)("span",{className:"text-orange-700",children:["(åŠ ç­ï¼š",e.overtime_hours.toFixed(1)," å°æ™‚)"]})]})]}),"leave"===e.type&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(v.Z,{size:14}),(0,a.jsxs)("span",{className:"font-mono",children:[e1(e.start_time),e.end_time&&` ~ ${e1(e.end_time)}`]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-slate-700",children:[a.jsx(x.Z,{size:14})," åŸå› ï¼š",e.reason||"ç„¡"]})]}),"anomaly"===e.type&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(o.Z,{size:14}),(0,a.jsxs)("span",{className:"font-bold",children:["æ—¥æœŸï¼š",e.date]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(v.Z,{size:14}),(0,a.jsxs)("span",{className:"font-mono",children:[e.clock_in_time?e2(e.clock_in_time):"--"," â†’ ",e.clock_out_time?e2(e.clock_out_time):"--"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-600",children:[a.jsx(et.Z,{size:14})," ",e.description]})]})]})]})]}),"pending"===e.status&&(0,a.jsxs)("div",{className:"flex gap-2 shrink-0",children:[(0,a.jsxs)("button",{onClick:()=>b(e),className:"px-4 py-2 text-red-600 font-bold hover:bg-red-50 rounded transition flex items-center gap-1",children:[a.jsx(e0.Z,{size:18})," é§å›"]}),(0,a.jsxs)("button",{onClick:()=>u(e),className:"px-6 py-2 bg-teal-600 text-white font-bold rounded shadow hover:bg-teal-500 transition flex items-center gap-2 active:scale-95",children:[a.jsx(i.Z,{size:18})," æ ¸å‡†"]})]})]},`${e.type}-${e.id}`))})]})}var e3=s(90391);function e7(){let[e,t]=(0,l.useState)([]),[s,r]=(0,l.useState)(!0),[n,i]=(0,l.useState)(!1),[d,o]=(0,l.useState)(null),[c,x]=(0,l.useState)({title:"",content:"",is_active:!0});(0,l.useEffect)(()=>{m()},[]);let m=async()=>{try{r(!0);let e=await fetch("/api/announcements"),s=await e.json();s.data&&t(s.data)}catch(e){console.error("Error fetching announcements:",e)}finally{r(!1)}},h=e=>{o(e),x({title:e.title||"",content:e.content||"",is_active:void 0===e.is_active||e.is_active}),i(!0)},p=async e=>{if(confirm("ç¢ºå®šè¦åˆªé™¤é€™å‰‡å…¬å‘Šå—ï¼Ÿ"))try{let t=await fetch(`/api/announcements?id=${e}`,{method:"DELETE"}),s=await t.json();s.success?(alert("å…¬å‘Šå·²åˆªé™¤"),m()):alert("åˆªé™¤å¤±æ•—: "+(s.error||"æœªçŸ¥éŒ¯èª¤"))}catch(e){console.error("Error deleting announcement:",e),alert("åˆªé™¤å¤±æ•—: "+e.message)}},u=async()=>{if(!c.title||!c.content){alert("è«‹å¡«å¯«æ¨™é¡Œå’Œå…§å®¹");return}try{let e=d?"PATCH":"POST",t=d?{id:d.id,...c}:c,s=await fetch("/api/announcements",{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await s.json();a.success?(alert(d?"å…¬å‘Šå·²æ›´æ–°":"å…¬å‘Šå·²å»ºç«‹"),i(!1),m()):alert("æ“ä½œå¤±æ•—: "+(a.error||"æœªçŸ¥éŒ¯èª¤"))}catch(e){console.error("Error saving announcement:",e),alert("æ“ä½œå¤±æ•—: "+e.message)}},f=async e=>{try{let t=await fetch("/api/announcements",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id,is_active:!e.is_active})}),s=await t.json();s.success?m():alert("æ›´æ–°å¤±æ•—: "+(s.error||"æœªçŸ¥éŒ¯èª¤"))}catch(e){console.error("Error toggling announcement:",e),alert("æ›´æ–°å¤±æ•—: "+e.message)}};return s?a.jsx("div",{className:"flex items-center justify-center py-12",children:a.jsx("div",{className:"text-slate-400",children:"è¼‰å…¥ä¸­..."})}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-slate-800 flex items-center gap-2",children:[a.jsx(b.Z,{size:20}),"å…¬å‘Šç®¡ç†"]}),(0,a.jsxs)("button",{onClick:()=>{o(null),x({title:"",content:"",is_active:!0}),i(!0)},className:"px-4 py-2 bg-teal-600 text-white rounded-lg text-sm font-bold flex items-center gap-2 hover:bg-teal-700 transition",children:[a.jsx(z.Z,{size:16}),"æ–°å¢å…¬å‘Š"]})]}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:a.jsx("div",{className:"divide-y divide-slate-200",children:0===e.length?a.jsx("div",{className:"p-8 text-center text-slate-400",children:"å°šç„¡å…¬å‘Šï¼Œé»æ“Šä¸Šæ–¹æŒ‰éˆ•æ–°å¢"}):e.map(e=>a.jsx("div",{className:"p-4 hover:bg-slate-50 transition",children:(0,a.jsxs)("div",{className:"flex justify-between items-start gap-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx("h3",{className:"font-bold text-slate-800",children:e.title}),a.jsx("span",{className:`text-xs px-2 py-0.5 rounded font-bold ${e.is_active?"bg-green-100 text-green-700":"bg-slate-100 text-slate-500"}`,children:e.is_active?"å•Ÿç”¨ä¸­":"å·²ä¸‹æ¶"})]}),a.jsx("p",{className:"text-sm text-slate-600 mb-2 whitespace-pre-wrap",children:e.content}),(0,a.jsxs)("div",{className:"text-xs text-slate-400",children:["å»ºç«‹æ™‚é–“: ",new Date(e.created_at).toLocaleString("zh-TW"),e.updated_at!==e.created_at&&(0,a.jsxs)("span",{className:"ml-2",children:["æ›´æ–°æ™‚é–“: ",new Date(e.updated_at).toLocaleString("zh-TW")]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>f(e),className:`px-3 py-1.5 rounded text-xs font-bold transition ${e.is_active?"bg-slate-100 text-slate-600 hover:bg-slate-200":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:e.is_active?"ä¸‹æ¶":"å•Ÿç”¨"}),a.jsx("button",{onClick:()=>h(e),className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded transition",title:"ç·¨è¼¯",children:a.jsx(e3.Z,{size:16})}),a.jsx("button",{onClick:()=>p(e.id),className:"p-1.5 text-red-600 hover:bg-red-50 rounded transition",title:"åˆªé™¤",children:a.jsx(T.Z,{size:16})})]})]})},e.id))})}),n&&a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"bg-slate-800 text-white p-4 flex justify-between items-center rounded-t-xl",children:[a.jsx("h3",{className:"font-bold text-lg",children:d?"ç·¨è¼¯å…¬å‘Š":"æ–°å¢å…¬å‘Š"}),a.jsx("button",{onClick:()=>i(!1),className:"text-white hover:text-slate-300 transition",children:a.jsx(_.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"p-6 overflow-y-auto space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"text-sm font-bold text-slate-700 mb-1 block",children:["æ¨™é¡Œ ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",value:c.title,onChange:e=>x({...c,title:e.target.value}),className:"w-full border p-2 rounded-lg bg-slate-50 text-sm",placeholder:"è«‹è¼¸å…¥å…¬å‘Šæ¨™é¡Œ"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"text-sm font-bold text-slate-700 mb-1 block",children:["å…§å®¹ ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("textarea",{value:c.content,onChange:e=>x({...c,content:e.target.value}),className:"w-full border p-2 rounded-lg bg-slate-50 text-sm min-h-[200px]",placeholder:"è«‹è¼¸å…¥å…¬å‘Šå…§å®¹"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",id:"is_active",checked:c.is_active,onChange:e=>x({...c,is_active:e.target.checked}),className:"w-4 h-4"}),a.jsx("label",{htmlFor:"is_active",className:"text-sm font-bold text-slate-700",children:"ç«‹å³å•Ÿç”¨"})]})]}),(0,a.jsxs)("div",{className:"p-4 border-t border-slate-200 flex justify-end gap-2",children:[a.jsx("button",{onClick:()=>i(!1),className:"px-4 py-2 border rounded-lg text-sm font-bold text-slate-600 hover:bg-slate-50 transition",children:"å–æ¶ˆ"}),(0,a.jsxs)("button",{onClick:u,className:"px-4 py-2 bg-teal-600 text-white rounded-lg text-sm font-bold flex items-center gap-2 hover:bg-teal-700 transition",children:[a.jsx(w.Z,{size:16}),d?"æ›´æ–°":"å»ºç«‹"]})]})]})})]})}let e8=(0,n.createBrowserClient)(process.env.NEXT_PUBLIC_SUPABASE_URL||"https://ucpkvptnhgbtmghqgbof.supabase.co",process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVjcGt2cHRuaGdidG1naHFnYm9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzNDg5MTAsImV4cCI6MjA4MDkyNDkxMH0.zdLx86ey-QywuGD-S20JJa7ZD6xHFRalAMRN659bbuo");function e9(){let e=(0,r.useRouter)(),[t,s]=(0,l.useState)(null),[n,g]=(0,l.useState)(!0),[j,N]=(0,l.useState)("tasks");(0,l.useEffect)(()=>{let t=async()=>{try{let t=await fetch("/api/auth/check",{method:"GET"});if(t.ok){let a=await t.json();a.authenticated&&a.authLevel?(s(a.authLevel),N("boss"===a.authLevel?"tasks":"staff_roster")):e.push("/login")}else e.push("/login")}catch(t){console.error("Auth check error:",t),e.push("/login")}finally{g(!1)}};t()},[e]);let y=async()=>{if(confirm("ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ"))try{let{error:t}=await e8.auth.signOut();if(t){console.error("Logout error:",t),alert("ç™»å‡ºå¤±æ•—: "+t.message);return}e.refresh(),e.push("/login")}catch(e){console.error("Logout error:",e),alert("ç™»å‡ºå¤±æ•—")}};return n?a.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:a.jsx("div",{className:"text-slate-400",children:"è¼‰å…¥ä¸­..."})}):t?a.jsx("div",{className:"min-h-screen bg-slate-50 p-4 md:p-6 text-slate-800",children:a.jsx("div",{className:"max-w-[1600px] mx-auto",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"mb-6 flex flex-col md:flex-row justify-between items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("h1",{className:"text-2xl font-bold text-slate-900 flex items-center gap-2",children:["è¨ºæ‰€ç®¡ç†ä¸­æ¨ V30.0","manager"===t&&a.jsx("span",{className:"text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded-full",children:"æ’ç­æ¨¡å¼"})]}),"boss"===t&&(0,a.jsxs)("button",{onClick:()=>N("tasks"),className:`px-3 py-1.5 rounded-lg text-xs font-bold flex items-center gap-1.5 transition ${"tasks"===j?"bg-teal-100 text-teal-700 border border-teal-300":"bg-slate-50 text-slate-600 hover:bg-slate-100 border border-transparent"}`,title:"å¾…å¯©æ ¸æ¡ˆä»¶",children:[a.jsx(i.Z,{size:14})," å¾…å¯©æ ¸"]}),(0,a.jsxs)("button",{onClick:y,className:"px-4 py-2 bg-red-50 text-red-600 rounded-lg text-sm font-bold flex items-center gap-2 hover:bg-red-100 transition",title:"ç™»å‡º",children:[a.jsx(d.Z,{size:16})," ç™»å‡º"]})]}),(0,a.jsxs)("div",{className:"flex bg-white p-1 rounded-xl border shadow-sm overflow-x-auto",children:["boss"===t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:()=>N("attendance"),className:`px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 whitespace-nowrap ${"attendance"===j?"bg-blue-100 text-blue-700":"text-slate-500 hover:bg-slate-50"}`,children:[a.jsx(i.Z,{size:16})," è€ƒå‹¤"]}),(0,a.jsxs)("button",{onClick:()=>N("staff_roster"),className:`px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 whitespace-nowrap ${"staff_roster"===j?"bg-purple-100 text-purple-700":"text-slate-500 hover:bg-slate-50"}`,children:[a.jsx(o.Z,{size:16})," å“¡å·¥æ’ç­"]}),(0,a.jsxs)("button",{onClick:()=>N("doctor_roster"),className:`px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 whitespace-nowrap ${"doctor_roster"===j?"bg-teal-100 text-teal-700":"text-slate-500 hover:bg-slate-50"}`,children:[a.jsx(c.Z,{size:16})," é†«å¸«æ’ç­"]}),(0,a.jsxs)("button",{onClick:()=>N("leave"),className:`px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 whitespace-nowrap ${"leave"===j?"bg-orange-100 text-orange-700":"text-slate-500 hover:bg-slate-50"}`,children:[a.jsx(x.Z,{size:16})," è«‹å‡"]}),(0,a.jsxs)("button",{onClick:()=>N("salary"),className:`px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 whitespace-nowrap ${"salary"===j?"bg-green-100 text-green-700":"text-slate-500 hover:bg-slate-50"}`,children:[a.jsx(m.Z,{size:16})," å“¡å·¥è–ªè³‡"]}),(0,a.jsxs)("button",{onClick:()=>N("doctor_salary"),className:`px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 whitespace-nowrap ${"doctor_salary"===j?"bg-teal-100 text-teal-700":"text-slate-500 hover:bg-slate-50"}`,children:[a.jsx(h.Z,{size:16})," é†«å¸«è–ªè³‡"]}),(0,a.jsxs)("button",{onClick:()=>N("salary_report"),className:`px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 whitespace-nowrap ${"salary_report"===j?"bg-indigo-100 text-indigo-700":"text-slate-500 hover:bg-slate-50"}`,children:[a.jsx(p.Z,{size:16})," äººäº‹å ±è¡¨"]}),(0,a.jsxs)("button",{onClick:()=>N("labor_rules"),className:`px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 whitespace-nowrap ${"labor_rules"===j?"bg-slate-800 text-white":"text-slate-500 hover:bg-slate-50"}`,children:[a.jsx(u.Z,{size:16})," æ³•è¦"]}),(0,a.jsxs)("button",{onClick:()=>N("announcements"),className:`px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 whitespace-nowrap ${"announcements"===j?"bg-yellow-100 text-yellow-700":"text-slate-500 hover:bg-slate-50"}`,children:[a.jsx(b.Z,{size:16})," å…¬å‘Š"]}),(0,a.jsxs)("button",{onClick:()=>N("settings"),className:`px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 whitespace-nowrap ${"settings"===j?"bg-gray-200 text-gray-800":"text-slate-500 hover:bg-slate-50"}`,children:[a.jsx(f.Z,{size:16})," è¨­å®š"]})]}),"manager"===t&&(0,a.jsxs)("button",{onClick:()=>N("staff_roster"),className:"px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 whitespace-nowrap bg-purple-100 text-purple-700",children:[a.jsx(o.Z,{size:16})," å“¡å·¥æ’ç­"]})]})]}),(0,a.jsxs)("div",{children:["tasks"===j&&"boss"===t&&a.jsx(e6,{}),"attendance"===j&&"boss"===t&&a.jsx(ea,{}),"staff_roster"===j&&("boss"===t||"manager"===t)&&a.jsx(C,{authLevel:t}),"doctor_roster"===j&&"boss"===t&&a.jsx(q,{}),"labor_rules"===j&&"boss"===t&&a.jsx(W,{}),"salary"===j&&"boss"===t&&a.jsx(eu,{}),"settings"===j&&"boss"===t&&a.jsx(eZ,{}),"leave"===j&&"boss"===t&&a.jsx(eJ,{}),"doctor_salary"===j&&"boss"===t&&a.jsx(eX,{}),"salary_report"===j&&"boss"===t&&a.jsx(eK,{}),"announcements"===j&&"boss"===t&&a.jsx(e7,{})]})]})})}):null}},78781:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>r,default:()=>d});var a=s(17536);let l=(0,a.createProxy)(String.raw`D:\FYC\FYC\clinic_attendence\clinic-attendance\app\admin\page.tsx`),{__esModule:r,$$typeof:n}=l,i=l.default,d=i}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[4650,4530,951,6158,9962,5277,8191,2432,5274,4711,272,374,6203,7213,2405,2980],()=>s(97779));module.exports=a})();